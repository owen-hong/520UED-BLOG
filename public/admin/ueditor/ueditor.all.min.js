(function(){function getListener(e,t,n){var r;return t=t.toLowerCase(),(r=e.__allListeners||n&&(e.__allListeners={}))&&(r[t]||n&&(r[t]=[]))}function getDomNode(e,t,n,r,i,s){var o=r&&e[t],u;!o&&(o=e[n]);while(!o&&(u=(u||e).parentNode)){if(u.tagName=="BODY"||s&&!s(u))return null;o=u[n]}return o&&i&&!i(o)?getDomNode(o,t,n,!1,i):o}UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu,window.UE=baidu.editor={},UE.plugins={},UE.commands={},UE.instants={},UE.I18N={},UE.version="1.2.6.1";var dom=UE.dom={},browser=UE.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:!!window.ActiveXObject,opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"};n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.opera;var r=0;n.ie&&(r=parseFloat(e.match(/msie (\d+)/)[1]),n.ie9Compat=document.documentMode==9,n.ie8=!!document.documentMode,n.ie8Compat=document.documentMode==8,n.ie7Compat=r==7&&!document.documentMode||document.documentMode==7,n.ie6Compat=r<7||n.quirks);if(n.gecko){var i=e.match(/rv:([\d\.]+)/);i&&(i=i[1].split("."),r=i[0]*1e4+(i[1]||0)*100+(i[2]||0)*1)}return/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(r=parseFloat(t.version())),n.webkit&&(r=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=r,n.isCompatible=!n.mobile&&(n.ie&&r>=6||n.gecko&&r>=10801||n.opera&&r>=9.5||n.air&&r>=1||n.webkit&&r>=522||!1),n}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UE.utils={each:function(e,t,n){if(e==null)return;if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e)===!1)return!1}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(n,e[s],s,e)===!1)return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var r in t)if(!n||!e.hasOwnProperty(r))e[r]=t[r];return e},extend2:function(e){var t=arguments;for(var n=1;n<t.length;n++){var r=t[n];for(var i in r)e.hasOwnProperty(i)||(e[i]=r[i])}return e},inherits:function(e,t){var n=e.prototype,r=utils.makeInstance(t.prototype);return utils.extend(r,n,!0),e.prototype=r,r.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var r;return function(){n&&clearTimeout(r),r=setTimeout(e,t)}},indexOf:function(e,t,n){var r=-1;return n=this.isNumber(n)?n:0,this.each(e,function(e,i){if(i>=n&&e===t)return r=i,!1}),r},removeItem:function(e,t){for(var n=0,r=e.length;n<r;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t=0,n,r={};n=e[t++];)r[n.toUpperCase()]=r[n]=1;return r},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":e.cssFloat!=undefined?"cssFloat":e.styleFloat!=undefined?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function t(t,n){try{for(var r=0,i;i=e[r++];)if(i.doc===t&&i.url==(n.src||n.href))return i}catch(s){return null}}var e=[];return function(n,r,i){var s=t(n,r);if(s){s.ready?i&&i():s.funs.push(i);return}e.push({doc:n,url:r.src||r.href,funs:[i]});if(!n.body){var o=[];for(var u in r){if(u=="tag")continue;o.push(u+'="'+r[u]+'"')}n.write("<"+r.tag+" "+o.join(" ")+" ></"+r.tag+">");return}if(r.id&&n.getElementById(r.id))return;var a=n.createElement(r.tag);delete r.tag;for(var u in r)a.setAttribute(u,r[u]);a.onload=a.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){s=t(n,r);if(s.funs.length>0){s.ready=1;for(var e;e=s.funs.pop();)e()}a.onload=a.onreadystatechange=null}},a.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file ueditor.config.js ")},n.getElementsByTagName("head")[0].appendChild(a)}}(),isEmptyObject:function(e){if(e==null)return!0;if(this.isArray(e)||this.isString(e))return e.length===0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(n.length>3)return"";t="#";for(var r=0,i;i=n[r++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=i.length==1?"0"+i:i;t=t.toUpperCase()}return t},optCss:function(e){function i(e,t){if(!e)return"";var n=e.top,r=e.bottom,i=e.left,s=e.right,o="";if(!n||!i||!r||!s)for(var u in e)o+=";"+t+"-"+u+":"+e[u]+";";else o+=";"+t+":"+(n==r&&r==i&&i==s?n:n==r&&i==s?n+" "+i:i==s?n+" "+i+" "+r:n+" "+s+" "+r+" "+i)+";";return o}var t,n,r;return e=e.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(e,r,i,s){if(s.split(" ").length==1)switch(r){case"padding":return!t&&(t={}),t[i]=s,"";case"margin":return!n&&(n={}),n[i]=s,"";case"border":return s=="initial"?"":e}return e}),e+=i(t,"padding")+i(n,"margin"),e.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(e,t){return t?t+";;":";"})},clone:function(e,t){var n;t=t||{};for(var r in e)e.hasOwnProperty(r)&&(n=e[r],typeof n=="object"?(t[r]=utils.isArray(n)?[]:{},utils.clone(e[r],t[r])):t[r]=n);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;e.replace(/([\d.]+)(\w+)/,function(n,r,i){e=r,t=i});switch(t){case"cm":e=parseFloat(e)*25;break;case"pt":e=Math.round(parseFloat(e)*96/72)}return e+(e?"px":"")},domReady:function(){function t(t){t.isReady=!0;for(var n;n=e.pop();n());}var e=[];return function(n,r){r=r||window;var i=r.document;n&&e.push(n),i.readyState==="complete"?t(i):(i.isReady&&t(i),browser.ie?(function(){if(i.isReady)return;try{i.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}t(i)}(),r.attachEvent("onload",function(){t(i)})):(i.addEventListener("DOMContentLoaded",function(){i.removeEventListener("DOMContentLoaded",arguments.callee,!1),t(i)},!1),r.addEventListener("load",function(){t(i)},!1)))}}(),cssRule:browser.ie?function(e,t,n){var r,i;n=n||document,n.indexList?r=n.indexList:r=n.indexList={};var s;if(!r[e]){if(t===undefined)return"";s=n.createStyleSheet("",i=n.styleSheets.length),r[e]=i}else s=n.styleSheets[r[e]];if(t===undefined)return s.cssText;s.cssText=t||""}:function(e,t,n){n=n||document;var r=n.getElementsByTagName("head")[0],i;if(!(i=n.getElementById(e))){if(t===undefined)return"";i=n.createElement("style"),i.id=e,r.appendChild(i)}if(t===undefined)return i.innerHTML;t!==""?i.innerHTML=t:r.removeChild(i)},sort:function(e,t){t=t||function(e,t){return e.localeCompare(t)};for(var n=0,r=e.length;n<r;n++)for(var i=n,s=e.length;i<s;i++)if(t(e[n],e[i])>0){var o=e[n];e[n]=e[i],e[i]=o}return e}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(e){UE.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(" ");for(var n=0,r;r=e[n++];)getListener(this,r,!0).push(t)},removeListener:function(e,t){e=utils.trim(e).split(" ");for(var n=0,r;r=e[n++];)utils.removeItem(getListener(this,r)||[],t)},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t=0,n;n=e[t++];){var r=getListener(this,n),i,s,o;if(r){o=r.length;while(o--){if(!r[o])continue;s=r[o].apply(this,arguments);if(s===!0)return s;s!==undefined&&(i=s)}}if(s=this["on"+n.toLowerCase()])i=s.apply(this,arguments)}return i}};var dtd=dom.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=utils.extend2,n=e({isindex:1,fieldset:1}),r=e({input:1,button:1,select:1,textarea:1,label:1}),i=t(e({a:1}),r),s=t({iframe:1},i),o=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),u=e({ins:1,del:1,script:1,style:1}),a=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),u),f=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),a),l=t(e({p:1}),f),c=t(e({iframe:1}),f,r),h=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),p=t(e({a:0}),c),d=e({tr:1}),v=e({"#":1}),m=t(e({param:1}),h),g=t(e({form:1}),n,s,o,l),y=e({li:1,ol:1,ul:1}),b=e({style:1,script:1}),w=e({base:1,link:1,meta:1,title:1}),E=t(w,b),S=e({head:1,body:1}),x=e({html:1}),T=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),N=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(x,S,w),$block:T,$inline:p,$inlineWithA:t(e({a:1}),p),$body:t(e({script:1,style:1}),T),$cdata:e({script:1,style:1}),$empty:N,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:S,head:E,style:v,script:v,body:g,base:{},link:{},meta:{},title:v,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:g,td:g,br:{},th:g,center:g,kbd:p,button:t(l,o),basefont:{},h5:p,h4:p,samp:p,h6:p,ol:y,h1:p,h3:p,option:v,h2:p,form:t(n,s,o,l),select:e({optgroup:1,option:1}),font:p,ins:p,menu:y,abbr:p,label:p,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:p,tfoot:d,cite:p,li:g,input:{},iframe:g,strong:p,textarea:v,noframes:g,big:p,small:p,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:p,dt:p,sub:p,optgroup:e({option:1}),param:{},bdo:p,"var":p,div:g,object:m,sup:p,dd:g,strike:p,area:{},dir:y,map:t(e({area:1,form:1,p:1}),n,u,o),applet:m,dl:e({dt:1,dd:1}),del:p,isindex:{},fieldset:t(e({legend:1}),h),thead:d,ul:y,acronym:p,b:p,a:t(e({a:1}),c),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),g),caption:p,i:p,u:p,tbody:d,s:p,address:t(s,l),tt:p,legend:p,q:p,pre:t(a,i),p:t(e({a:1}),p),em:p,dfn:p})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(e,t){if(e===t)return 0;var n,r=[e],i=[t];n=e;while(n=n.parentNode){if(n===t)return 10;r.push(n)}n=t;while(n=n.parentNode){if(n===e)return 20;i.push(n)}r.reverse(),i.reverse();if(r[0]!==i[0])return 1;var s=-1;while(s++,r[s]===i[s]);e=r[s],t=i[s];while(e=e.nextSibling)if(e===t)return 4;return 2},getNodeIndex:function(e,t){var n=e,r=0;while(n=n.previousSibling){if(t&&n.nodeType==3){n.nodeType!=n.nextSibling.nodeType&&r++;continue}r++}return r},inDoc:function(e,t){return domUtils.getPosition(e,t)==10},findParent:function(e,t,n){if(e&&!domUtils.isBody(e)){e=n?e:e.parentNode;while(e){if(!t||t(e)||domUtils.isBody(e))return t&&!t(e)&&domUtils.isBody(e)?null:e;e=e.parentNode}}return null},findParentByTagName:function(e,t,n,r){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(e,function(e){return t[e.tagName]&&(!r||!r(e))},n)},findParents:function(e,t,n,r){var i=t&&(n&&n(e)||!n)?[e]:[];while(e=domUtils.findParent(e,n))i.push(e);return r?i:i.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n=e.parentNode,r;if(n){if(t&&e.hasChildNodes())while(r=e.firstChild)n.insertBefore(r,e);n.removeChild(e)}return e},getNextDomNode:function(e,t,n,r){return getDomNode(e,"firstChild","nextSibling",t,n,r)},isBookmarkNode:function(e){return e.nodeType==1&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;var n=[e],r=[t],i=e,s=-1;while(i=i.parentNode){if(i===t)return i;n.push(i)}i=t;while(i=i.parentNode){if(i===e)return i;r.push(i)}n.reverse(),r.reverse();while(s++,n[s]===r[s]);return s==0?null:n[s-1]},clearEmptySibling:function(e,t,n){function r(e,t){var n;while(e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!(new RegExp("[^	\n\r"+domUtils.fillChar+"]")).test(e.nodeValue)))n=e[t],domUtils.remove(e),e=n}!t&&r(e.nextSibling,"nextSibling"),!n&&r(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var r=n.createTextNode("");return domUtils.insertAfter(e,r)}var i=e.splitText(t);if(browser.ie8){var s=n.createTextNode("");domUtils.insertAfter(i,s),domUtils.remove(s)}return i},isWhitespace:function(e){return!(new RegExp("[^ 	\n\r"+domUtils.fillChar+"]")).test(e.nodeValue)},getXY:function(e){var t=0,n=0;while(e.offsetParent)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},on:function(e,t,n){var r=utils.isArray(t)?t:[t],i=r.length;if(i)while(i--){t=r[i];if(e.addEventListener)e.addEventListener(t,n,!1);else{n._d||(n._d={els:[]});var s=t+n.toString(),o=utils.indexOf(n._d.els,e);if(!n._d[s]||o==-1)o==-1&&n._d.els.push(e),n._d[s]||(n._d[s]=function(e){return n.call(e.srcElement,e||window.event)}),e.attachEvent("on"+t,n._d[s])}}e=null},un:function(e,t,n){var r=utils.isArray(t)?t:[t],i=r.length;if(i)while(i--){t=r[i];if(e.removeEventListener)e.removeEventListener(t,n,!1);else{var s=t+n.toString();try{e.detachEvent("on"+t,n._d?n._d[s]:n)}catch(o){}if(n._d&&n._d[s]){var u=utils.indexOf(n._d.els,e);u!=-1&&n._d.els.splice(u,1),n._d.els.length==0&&delete n._d[s]}}}},isSameElement:function(e,t){if(e.tagName!=t.tagName)return!1;var n=e.attributes,r=t.attributes;if(!ie&&n.length!=r.length)return!1;var i,s,o=0,u=0;for(var a=0;i=n[a++];){if(i.nodeName=="style"){i.specified&&o++;if(domUtils.isSameStyle(e,t))continue;return!1}if(ie){if(!i.specified)continue;o++,s=r.getNamedItem(i.nodeName)}else s=t.attributes[i.nodeName];if(!s.specified||i.nodeValue!=s.nodeValue)return!1}if(ie){for(a=0;s=r[a++];)s.specified&&u++;if(o!=u)return!1}return!0},isSameStyle:function(e,t){var n=e.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),r=t.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){n=e.style,r=t.style;if(n.length!=r.length)return!1;for(var i in n){if(/^(\d+|csstext)$/i.test(i))continue;if(n[i]!=r[i])return!1}return!0}if(!n||!r)return n==r;n=n.split(";"),r=r.split(";");if(n.length!=r.length)return!1;for(var s=0,o;o=n[s++];)if(utils.indexOf(r,o)==-1)return!1;return!0},isBlockElm:function(e){return e.nodeType==1&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},isBody:function(e){return e&&e.nodeType==1&&e.tagName.toLowerCase()=="body"},breakParent:function(e,t){var n,r=e,i=e,s,o;do{r=r.parentNode,s?(n=r.cloneNode(!1),n.appendChild(s),s=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(s=r.cloneNode(!1),o=s.cloneNode(!1));while(n=i.previousSibling)s.insertBefore(n,s.firstChild);while(n=i.nextSibling)o.appendChild(n);i=r}while(t!==r);return n=t.parentNode,n.insertBefore(s,t),n.insertBefore(o,t),n.insertBefore(e,o),domUtils.remove(t),e},isEmptyInlineElement:function(e){if(e.nodeType!=1||!dtd.$removeEmpty[e.tagName])return 0;e=e.firstChild;while(e){if(domUtils.isBookmarkNode(e))return 0;if(e.nodeType==1&&!domUtils.isEmptyInlineElement(e)||e.nodeType==3&&!domUtils.isWhitespace(e))return 0;e=e.nextSibling}return 1},trimWhiteTextNode:function(e){function t(t){var n;while((n=e[t])&&n.nodeType==3&&domUtils.isWhitespace(n))e.removeChild(n)}t("firstChild"),t("lastChild")},mergeChild:function(e,t,n){var r=domUtils.getElementsByTagName(e,e.tagName.toLowerCase());for(var i=0,s;s=r[i++];){if(!s.parentNode||domUtils.isBookmarkNode(s))continue;if(s.tagName.toLowerCase()=="span"){if(e===s.parentNode){domUtils.trimWhiteTextNode(e);if(e.childNodes.length==1){e.style.cssText=s.style.cssText+";"+e.style.cssText,domUtils.remove(s,!0);continue}}s.style.cssText=e.style.cssText+";"+s.style.cssText;if(n){var o=n.style;if(o){o=o.split(";");for(var u=0,a;a=o[u++];)s.style[utils.cssStyleToDomStyle(a.split(":")[0])]=a.split(":")[1]}}domUtils.isSameStyle(s,e)&&domUtils.remove(s,!0);continue}domUtils.isSameElement(e,s)&&domUtils.remove(s,!0)}},getElementsByTagName:function(e,t,n){if(n&&utils.isString(n)){var r=n;n=function(e){return domUtils.hasClass(e,r)}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var i=[];for(var s=0,o;o=t[s++];){var u=e.getElementsByTagName(o);for(var a=0,f;f=u[a++];)(!n||n(f))&&i.push(f)}return i},mergeToParent:function(e){var t=e.parentNode;while(t&&dtd.$removeEmpty[t.tagName]){if(t.tagName==e.tagName||t.tagName=="A"){domUtils.trimWhiteTextNode(t);if(t.tagName=="SPAN"&&!domUtils.isSameStyle(t,e)||t.tagName=="A"&&e.tagName=="SPAN"){if(t.childNodes.length>1||t!==e.parentNode){e.style.cssText=t.style.cssText+";"+e.style.cssText,t=t.parentNode;continue}t.style.cssText+=";"+e.style.cssText,t.tagName=="A"&&(t.style.textDecoration="underline")}if(t.tagName!="A"){t===e.parentNode&&domUtils.remove(e,!0);break}}t=t.parentNode}},mergeSibling:function(e,t,n){function r(e,t,n){var r;if((r=n[e])&&!domUtils.isBookmarkNode(r)&&r.nodeType==1&&domUtils.isSameElement(n,r)){while(r.firstChild)t=="firstChild"?n.insertBefore(r.lastChild,n.firstChild):n.appendChild(r.firstChild);domUtils.remove(r)}}!t&&r("previousSibling","firstChild",e),!n&&r("nextSibling","lastChild",e)},unSelectable:ie||browser.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t=0,n;n=e.all[t++];)switch(n.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:n.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n=0,r;r=t[n++];){r=attrFix[r]||r;switch(r){case"className":e[r]="";break;case"style":e.style.cssText="",!browser.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(r)}},createElement:function(e,t,n){return domUtils.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];switch(n){case"class":e.className=r;break;case"style":e.style.cssText=e.style.cssText+";"+r;break;case"innerHTML":e[n]=r;break;case"value":e.value=r;break;default:e.setAttribute(attrFix[n]||n,r)}}return e},getComputedStyle:function(e,t){var n="width height top left";if(n.indexOf(t)>-1)return e["offset"+t.replace(/^\w/,function(e){return e.toUpperCase()})]+"px";e.nodeType==3&&(e=e.parentNode);if(browser.ie&&browser.version<9&&t=="font-size"&&!e.style.fontSize&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]){var r=e.ownerDocument.createElement("span");r.style.cssText="padding:0;border:0;font-family:simsun;",r.innerHTML=".",e.appendChild(r);var i=r.offsetHeight;return e.removeChild(r),r=null,i+"px"}try{var s=domUtils.getStyle(e,t)||(window.getComputedStyle?domUtils.getWindow(e).getComputedStyle(e,"").getPropertyValue(t):(e.currentStyle||e.style)[utils.cssStyleToDomStyle(t)])}catch(o){return""}return utils.transUnitToPx(utils.fixColor(t,s))},removeClasses:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n=0,r,i=e.className;r=t[n++];)i=i.replace(new RegExp("\\b"+r+"\\b"),"");i=utils.trim(i).replace(/[ ]{2,}/g," "),i?e.className=i:domUtils.removeAttributes(e,["class"])},addClass:function(e,t){if(!e)return;t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n=0,r,i=e.className;r=t[n++];)(new RegExp("\\b"+r+"\\b")).test(i)||(e.className+=" "+r)},hasClass:function(e,t){if(utils.isRegExp(t))return t.test(e.className);t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n=0,r,i=e.className;r=t[n++];)if(!(new RegExp("\\b"+r+"\\b","i")).test(i))return!1;return n-1==t.length},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){browser.ie?(t=="color"&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(utils.cssStyleToDomStyle(t)),e.style.cssText||domUtils.removeAttributes(e,["style"])},getStyle:function(e,t){var n=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,n)},setStyle:function(e,t,n){e.style[utils.cssStyleToDomStyle(t)]=n,utils.trim(e.style.cssText)||this.removeAttributes(e,"style")},setStyles:function(e,t){for(var n in t)t.hasOwnProperty(n)&&domUtils.setStyle(e,n,t[n])},removeDirtyAttr:function(e){for(var t=0,n,r=e.getElementsByTagName("*");n=r[t++];)n.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,r=e.firstChild;t=t||function(){return 1};while(r)t(r)&&n++,r=r.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})==0},clearSelectedArr:function(e){var t;while(t=e.pop())domUtils.removeAttributes(t,["class"])},scrollToView:function(e,t,n){var r=function(){var e=t.document,n=e.compatMode=="CSS1Compat";return{width:(n?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(n?e.documentElement.clientHeight:e.body.clientHeight)||0}},i=function(e){if("pageXOffset"in e)return{x:e.pageXOffset||0,y:e.pageYOffset||0};var t=e.document;return{x:t.documentElement.scrollLeft||t.body.scrollLeft||0,y:t.documentElement.scrollTop||t.body.scrollTop||0}},s=r().height,o=s*-1+n;o+=e.offsetHeight||0;var u=domUtils.getXY(e);o+=u.y;var a=i(t).y;(o>a||o<a-s)&&t.scrollTo(0,o+(o<0?-20:20))},isBr:function(e){return e.nodeType==1&&e.tagName=="BR"},isFillChar:function(e,t){return e.nodeType==3&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isStartInblock:function(e){var t=e.cloneRange(),n=0,r=t.startContainer,i;if(r.nodeType==1&&r.childNodes[t.startOffset]){r=r.childNodes[t.startOffset];var s=r.previousSibling;while(s&&domUtils.isFillChar(s))r=s,s=s.previousSibling}this.isFillChar(r,!0)&&t.startOffset==1&&(t.setStartBefore(r),r=t.startContainer);while(r&&domUtils.isFillChar(r))i=r,r=r.previousSibling;i&&(t.setStartBefore(i),r=t.startContainer),r.nodeType==1&&domUtils.isEmptyNode(r)&&t.startOffset==1&&t.setStart(r,0).collapse(!0);while(!t.startOffset){r=t.startContainer;if(domUtils.isBlockElm(r)||domUtils.isBody(r)){n=1;break}var s=t.startContainer.previousSibling,o;if(!s)t.setStartBefore(t.startContainer);else{while(s&&domUtils.isFillChar(s))o=s,s=s.previousSibling;o?t.setStartBefore(o):t.setStartBefore(t.startContainer)}}return n&&!domUtils.isBody(t.startContainer)?1:0},isEmptyBlock:function(e,t){if(e.nodeType!=1)return 0;t=t||new RegExp("[ 	\r\n"+domUtils.fillChar+"]","g");if(e[browser.ie?"innerText":"textContent"].replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(e,t){var n=parseInt(e.style.left)|0,r=parseInt(e.style.top)|0,i=e.getBoundingClientRect(),s=t.left-i.left,o=t.top-i.top;s&&(e.style.left=n+s+"px"),o&&(e.style.top=r+o+"px")},fillNode:function(e,t){var n=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},moveChild:function(e,t,n){while(e.firstChild)n&&t.firstChild?t.insertBefore(e.lastChild,t.firstChild):t.appendChild(e.firstChild)},hasNoAttributes:function(e){return browser.ie?/^<\w+\s*?>/.test(e.outerHTML):e.attributes.length==0},isCustomeNode:function(e){return e.nodeType==1&&e.getAttribute("_ue_custom_node_")},isTagNode:function(e,t){return e.nodeType==1&&(new RegExp("^"+e.tagName+"$","i")).test(t)},filterNodeList:function(e,t,n){var r=[];if(!utils.isFunction(t)){var i=t;t=function(e){return utils.indexOf(utils.isArray(i)?i:i.split(" "),e.tagName.toLowerCase())!=-1}}return utils.each(e,function(e){t(e)&&r.push(e)}),r.length==0?null:r.length==1||!n?r[0]:r},isInNodeEndBoundary:function(e,t){var n=e.startContainer;if(n.nodeType==3&&e.startOffset!=n.nodeValue.length)return 0;if(n.nodeType==1&&e.startOffset!=n.childNodes.length)return 0;while(n!==t){if(n.nextSibling)return 0;n=n.parentNode}return 1},isBoundaryNode:function(e,t){var n;while(!domUtils.isBody(e)){n=e,e=e.parentNode;if(n!==e[t])return!1}return!0}},fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){function r(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function i(e){return!e.collapsed&&e.startContainer.nodeType==1&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function s(e,t,n,i){return t.nodeType==1&&(dtd.$empty[t.tagName]||dtd.$nonChild[t.tagName])&&(n=domUtils.getNodeIndex(t)+(e?0:1),t=t.parentNode),e?(i.startContainer=t,i.startOffset=n,i.endContainer||i.collapse(!0)):(i.endContainer=t,i.endOffset=n,i.startContainer||i.collapse(!1)),r(i),i}function o(e,t){var n=e.startContainer,r=e.endContainer,i=e.startOffset,s=e.endOffset,o=e.document,u=o.createDocumentFragment(),a,f;n.nodeType==1&&(n=n.childNodes[i]||(a=n.appendChild(o.createTextNode("")))),r.nodeType==1&&(r=r.childNodes[s]||(f=r.appendChild(o.createTextNode(""))));if(n===r&&n.nodeType==3)return u.appendChild(o.createTextNode(n.substringData(i,s-i))),t&&(n.deleteData(i,s-i),e.collapse(!0)),u;var l,c,h=u,p=domUtils.findParents(n,!0),d=domUtils.findParents(r,!0);for(var v=0;p[v]==d[v];)v++;for(var m=v,g;g=p[m];m++){l=g.nextSibling,g==n?a||(e.startContainer.nodeType==3?(h.appendChild(o.createTextNode(n.nodeValue.slice(i))),t&&n.deleteData(i,n.nodeValue.length-i)):h.appendChild(t?n:n.cloneNode(!0))):(c=g.cloneNode(!1),h.appendChild(c));while(l){if(l===r||l===d[m])break;g=l.nextSibling,h.appendChild(t?l:l.cloneNode(!0)),l=g}h=c}h=u,p[v]||(h.appendChild(p[v-1].cloneNode(!1)),h=h.firstChild);for(var m=v,y;y=d[m];m++){l=y.previousSibling,y==r?!f&&e.endContainer.nodeType==3&&(h.appendChild(o.createTextNode(r.substringData(0,s))),t&&r.deleteData(0,s)):(c=y.cloneNode(!1),h.appendChild(c));if(m!=v||!p[v])while(l){if(l===n)break;y=l.previousSibling,h.insertBefore(t?l:l.cloneNode(!0),h.firstChild),l=y}h=c}return t&&e.setStartBefore(d[v]?p[v]?d[v]:p[v-1]:d[v-1]).collapse(!0),a&&domUtils.remove(a),f&&domUtils.remove(f),u}function a(e,t){try{if(n&&domUtils.inDoc(n,e))if(!n.nodeValue.replace(fillCharReg,"").length){var r=n.parentNode;domUtils.remove(n);while(r&&domUtils.isEmptyInlineElement(r)&&(browser.safari?!(domUtils.getPosition(r,t)&domUtils.POSITION_CONTAINS):!r.contains(t)))n=r.parentNode,domUtils.remove(r),r=n}else n.nodeValue=n.nodeValue.replace(fillCharReg,"")}catch(i){}}function f(e,t){var n;e=e[t];while(e&&domUtils.isFillChar(e))n=e[t],domUtils.remove(e),e=n}var e=0,t=domUtils.fillChar,n,u=dom.Range=function(e){var t=this;t.startContainer=t.startOffset=t.endContainer=t.endOffset=null,t.document=e,t.collapsed=!0};u.prototype={cloneContents:function(){return this.collapsed?null:o(this,0)},deleteContents:function(){var e;return this.collapsed||o(this,1),browser.webkit&&(e=this.startContainer,e.nodeType==3&&!e.nodeValue.length&&(this.setStartBefore(e).collapse(!0),domUtils.remove(e))),this},extractContents:function(){return this.collapsed?null:o(this,2)},setStart:function(e,t){return s(!0,e,t,this)},setEnd:function(e,t){return s(!1,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return(new u(e.document)).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;return e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(e){function i(e){return e.nodeType==1&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}var t=this,n,r=t.collapsed;while(t.startContainer.nodeType==1&&(n=t.startContainer.childNodes[t.startOffset])&&i(n))t.setStart(n,0);if(r)return t.collapse(!0);if(!e)while(t.endContainer.nodeType==1&&t.endOffset>0&&(n=t.endContainer.childNodes[t.endOffset-1])&&i(n))t.setEnd(n,n.childNodes.length);return t},getCommonAncestor:function(e,t){var n=this,r=n.startContainer,s=n.endContainer;if(r===s){if(e&&i(this)){r=r.childNodes[n.startOffset];if(r.nodeType==1)return r}return t&&r.nodeType==3?r.parentNode:r}return domUtils.getCommonAncestor(r,s)},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,n=this.startOffset,r=this.collapsed,i=this.endContainer;if(t.nodeType==3){if(n==0)this.setStartBefore(t);else if(n>=t.nodeValue.length)this.setStartAfter(t);else{var s=domUtils.split(t,n);t===i?this.setEnd(s,this.endOffset-n):t.parentNode===i&&(this.endOffset+=1),this.setStartBefore(s)}if(r)return this.collapse(!0)}return e||(n=this.endOffset,i=this.endContainer,i.nodeType==3&&(n==0?this.setEndBefore(i):(n<i.nodeValue.length&&domUtils.split(i,n),this.setEndAfter(i)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],r=e[t+"Offset"];n.nodeType==3&&(r?r>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}if(e||!this.collapsed)t(this,"start"),t(this,"end");return this},insertNode:function(e){var t=e,n=1;e.nodeType==11&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var r=this.startContainer,i=this.startOffset,s=r.childNodes[i];return s?r.insertBefore(e,s):r.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(t,n){var r,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(n?"":e++),this.collapsed||(r=i.cloneNode(!0),r.id="_baidu_bookmark_end_"+(n?"":e++)),this.insertNode(i),r&&this.collapse().insertNode(r).setEndBefore(r),this.setStartAfter(i),{start:t?i.id:i,
end:r?t?r.id:r:null,id:t}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,n=e.end&&e.id?this.document.getElementById(e.end):e.end;return this.setStartBefore(t),domUtils.remove(t),n?(this.setEndBefore(n),domUtils.remove(n)):this.collapse(!0),this},enlarge:function(e,t){var n=domUtils.isBody,r,i,s=this.document.createTextNode("");if(e){i=this.startContainer,i.nodeType==1?i.childNodes[this.startOffset]?r=i=i.childNodes[this.startOffset]:(i.appendChild(s),r=i=s):r=i;for(;;){if(domUtils.isBlockElm(i)){i=r;while((r=i.previousSibling)&&!domUtils.isBlockElm(r))i=r;this.setStartBefore(i);break}r=i,i=i.parentNode}i=this.endContainer,i.nodeType==1?((r=i.childNodes[this.endOffset])?i.insertBefore(s,r):i.appendChild(s),r=i=s):r=i;for(;;){if(domUtils.isBlockElm(i)){i=r;while((r=i.nextSibling)&&!domUtils.isBlockElm(r))i=r;this.setEndAfter(i);break}r=i,i=i.parentNode}s.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(s)}if(!this.collapsed){while(this.startOffset==0){if(t&&t(this.startContainer))break;if(n(this.startContainer))break;this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(t&&t(this.endContainer))break;if(n(this.endContainer))break;this.setEndAfter(this.endContainer)}}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setStartAfter(this.startContainer);while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(e,t,n){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(e){return e.nodeType==1&&domUtils.isBlockElm(e)}).adjustmentBoundary();var r=this.createBookmark(),i=r.end,s=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},o=domUtils.getNextDomNode(r.start,!1,s),u,a,f=this.cloneRange();while(o&&domUtils.getPosition(o,i)&domUtils.POSITION_PRECEDING)if(o.nodeType==3||dtd[e][o.tagName]){f.setStartBefore(o),u=o;while(u&&(u.nodeType==3||dtd[e][u.tagName])&&u!==i)a=u,u=domUtils.getNextDomNode(u,u.nodeType==1,null,function(t){return dtd[e][t.tagName]});var l=f.setEndAfter(a).extractContents(),c;if(n&&n.length>0){var h,p;p=h=n[0].cloneNode(!1);for(var d=1,v;v=n[d++];)h.appendChild(v.cloneNode(!1)),h=h.firstChild;c=h}else c=f.document.createElement(e);t&&domUtils.setAttributes(c,t),c.appendChild(l),f.insertNode(n?p:c);var m;e=="span"&&t.style&&/text\-decoration/.test(t.style)&&(m=domUtils.findParentByTagName(c,"a",!0))?(domUtils.setAttributes(m,t),domUtils.remove(c,!0),c=m):(domUtils.mergeSibling(c),domUtils.clearEmptySibling(c)),domUtils.mergeChild(c,t),o=domUtils.getNextDomNode(c,!1,s),domUtils.mergeToParent(c);if(u===i)break}else o=domUtils.getNextDomNode(o,!0,s);return this.moveToBookmark(r)},removeInlineStyle:function(e){if(this.collapsed)return this;e=utils.isArray(e)?e:[e],this.shrinkBoundary().adjustmentBoundary();var t=this.startContainer,n=this.endContainer;for(;;){if(t.nodeType==1){if(utils.indexOf(e,t.tagName.toLowerCase())>-1)break;if(t.tagName.toLowerCase()=="body"){t=null;break}}t=t.parentNode}for(;;){if(n.nodeType==1){if(utils.indexOf(e,n.tagName.toLowerCase())>-1)break;if(n.tagName.toLowerCase()=="body"){n=null;break}}n=n.parentNode}var r=this.createBookmark(),i,s;t&&(s=this.cloneRange().setEndBefore(r.start).setStartBefore(t),i=s.extractContents(),s.insertNode(i),domUtils.clearEmptySibling(t,!0),t.parentNode.insertBefore(r.start,t)),n&&(s=this.cloneRange().setStartAfter(r.end).setEndAfter(n),i=s.extractContents(),s.insertNode(i),domUtils.clearEmptySibling(n,!1,!0),n.parentNode.insertBefore(r.end,n.nextSibling));var o=domUtils.getNextDomNode(r.start,!1,function(e){return e.nodeType==1}),u;while(o&&o!==r.end)u=domUtils.getNextDomNode(o,!0,function(e){return e.nodeType==1}),utils.indexOf(e,o.tagName.toLowerCase())>-1&&domUtils.remove(o,!0),o=u;return this.moveToBookmark(r)},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(i(t)){var n=t.startContainer.childNodes[t.startOffset];n&&n.nodeType==1&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(e=n)}}return e},select:browser.ie?function(e,r){var i;this.collapsed||this.shrinkBoundary();var s=this.getClosedNode();if(s&&!r){try{i=this.document.body.createControlRange(),i.addElement(s),i.select()}catch(o){}return this}var u=this.createBookmark(),l=u.start,c;i=this.document.body.createTextRange(),i.moveToElementText(l),i.moveStart("character",1);if(!this.collapsed){var h=this.document.body.createTextRange();c=u.end,h.moveToElementText(c),i.setEndPoint("EndToEnd",h)}else if(!e&&this.startContainer.nodeType!=3){var p=this.document.createTextNode(t),d=this.document.createElement("span");d.appendChild(this.document.createTextNode(t)),l.parentNode.insertBefore(d,l),l.parentNode.insertBefore(p,l),a(this.document,p),n=p,f(d,"previousSibling"),f(l,"nextSibling"),i.moveStart("character",-1),i.collapse(!0)}this.moveToBookmark(u),d&&domUtils.remove(d);try{i.select()}catch(o){}return this}:function(e){function r(e){function t(t,n,r){t.nodeType==3&&t.nodeValue.length<n&&(e[r+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var i=domUtils.getWindow(this.document),s=i.getSelection(),o;browser.gecko?this.document.body.focus():i.focus();if(s){s.removeAllRanges();if(this.collapsed&&!e){var u=this.startContainer,l=u;u.nodeType==1&&(l=u.childNodes[this.startOffset]),(u.nodeType!=3||!this.startOffset)&&(l?!l.previousSibling||l.previousSibling.nodeType!=3:!u.lastChild||u.lastChild.nodeType!=3)&&(o=this.document.createTextNode(t),this.insertNode(o),a(this.document,o),f(o,"previousSibling"),f(o,"nextSibling"),n=o,this.setStart(o,browser.webkit?1:0).collapse(!0))}var c=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var l=this.startContainer.childNodes[this.startOffset];if(!l)l=this.startContainer.lastChild,l&&domUtils.isBr(l)&&this.setStartBefore(l).collapse(!0);else{while(l&&domUtils.isBlockElm(l)){if(l.nodeType!=1||!l.childNodes[0])break;l=l.childNodes[0]}l&&this.setStartBefore(l).collapse(!0)}}r(this),c.setStart(this.startContainer,this.startOffset),c.setEnd(this.endContainer,this.endOffset),s.addRange(c)}return this},scrollToView:function(e,t){e=e?window:domUtils.getWindow(this.document);var n=this,r=n.document.createElement("span");return r.innerHTML="&nbsp;",n.cloneRange().insertNode(r),domUtils.scrollToView(r,e,t),domUtils.remove(r),n},inFillChar:function(){var e=this.startContainer;return this.collapsed&&e.nodeType==3&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length?!0:!1},createAddress:function(e,t){function i(e){var n=e?r.startContainer:r.endContainer,i=domUtils.findParents(n,!0,function(e){return!domUtils.isBody(e)}),s=[];for(var o=0,u;u=i[o++];)s.push(domUtils.getNodeIndex(u,t));var a=0;if(t)if(n.nodeType==3){var f=n.previousSibling;while(f&&f.nodeType==3)a+=f.nodeValue.replace(fillCharReg,"").length,f=f.previousSibling;a+=e?r.startOffset:r.endOffset}else{n=n.childNodes[e?r.startOffset:r.endOffset];if(n)a=domUtils.getNodeIndex(n,t);else{n=e?r.startContainer:r.endContainer;var l=n.firstChild;while(l){if(domUtils.isFillChar(l)){l=l.nextSibling;continue}a++;if(l.nodeType==3)while(l&&l.nodeType==3)l=l.nextSibling;else l=l.nextSibling}}}else a=e?domUtils.isFillChar(n)?0:r.startOffset:r.endOffset;return a<0&&(a=0),s.push(a),s}var n={},r=this;return n.startAddress=i(!0),e||(n.endAddress=r.collapsed?[].concat(n.startAddress):i()),n},moveToAddress:function(e,t){function r(e,t){var r=n.document.body,i,s;for(var o=0,u,a=e.length;o<a;o++){u=e[o],i=r,r=r.childNodes[u];if(!r){s=u;break}}t?r?n.setStartBefore(r):n.setStart(i,s):r?n.setEndBefore(r):n.setEnd(i,s)}var n=this;return r(e.startAddress,!0),!t&&e.endAddress&&r(e.endAddress),n},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},traversal:function(e,t){if(this.collapsed)return this;var n=this.createBookmark(),r=n.end,i=domUtils.getNextDomNode(n.start,!1,t);while(i&&i!==r&&domUtils.getPosition(i,r)&domUtils.POSITION_PRECEDING){var s=domUtils.getNextDomNode(i,!1,t);e(i),i=s}return this.moveToBookmark(n)}}})(),function(){function e(e,t){var n=domUtils.getNodeIndex;e=e.duplicate(),e.collapse(t);var r=e.parentElement();if(!r.hasChildNodes())return{container:r,offset:0};var i=r.children,s,o=e.duplicate(),u=0,a=i.length-1,f=-1,l;while(u<=a){f=Math.floor((u+a)/2),s=i[f],o.moveToElementText(s);var c=o.compareEndPoints("StartToStart",e);if(c>0)a=f-1;else{if(!(c<0))return{container:r,offset:n(s)};u=f+1}}if(f==-1){o.moveToElementText(r),o.setEndPoint("StartToStart",e),l=o.text.replace(/(\r\n|\r)/g,"\n").length,i=r.childNodes;if(!l)return s=i[i.length-1],{container:s,offset:s.nodeValue.length};var h=i.length;while(l>0)l-=i[--h].nodeValue.length;return{container:i[h],offset:-l}}o.collapse(c>0),o.setEndPoint(c>0?"StartToStart":"EndToStart",e),l=o.text.replace(/(\r\n|\r)/g,"\n").length;if(!l)return dtd.$empty[s.tagName]||dtd.$nonChild[s.tagName]?{container:r,offset:n(s)+(c>0?0:1)}:{container:s,offset:c>0?0:s.childNodes.length};while(l>0)try{var p=s;s=s[c>0?"previousSibling":"nextSibling"],l-=s.nodeValue.length}catch(d){return{container:r,offset:n(p)}}return{container:s,offset:c>0?-l:s.nodeValue.length+l}}function t(t,n){if(t.item)n.selectNode(t.item(0));else{var r=e(t,!0);n.setStart(r.container,r.offset),t.compareEndPoints("StartToEnd",t)!=0&&(r=e(t,!1),n.setEnd(r.container,r.offset))}return n}function n(e){var t;try{t=e.getNative().createRange()}catch(n){return null}var r=t.item?t.item(0):t.parentElement();return(r.ownerDocument||r)===e.document?t:null}var r=dom.Selection=function(e){var t=this,r;t.document=e,ie&&(r=domUtils.getWindow(e).frameElement,domUtils.on(r,"beforedeactivate",function(){t._bakIERange=t.getIERange()}),domUtils.on(r,"activate",function(){try{!n(t)&&t._bakIERange&&t._bakIERange.select()}catch(e){}t._bakIERange=null})),r=e=null};r.prototype={getNative:function(){var e=this.document;try{return e?ie&&browser.ie<9?e.selection:domUtils.getWindow(e).getSelection():null}catch(t){return null}},getIERange:function(){var e=n(this);return!e&&this._bakIERange?this._bakIERange:e},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?domUtils.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{return browser.ie&&n(this)||!browser.ie&&this.getNative().rangeCount?!0:!1}catch(e){return!1}},getRange:function(){function n(t){var n=e.document.body.firstChild,r=t.collapsed;while(n&&n.firstChild)t.setStart(n,0),n=n.firstChild;t.startContainer||t.setStart(e.document.body,0),r&&t.collapse(!0)}var e=this;if(e._cachedRange!=null)return this._cachedRange;var r=new baidu.editor.dom.Range(e.document);if(ie&&browser.ie<9){var i=e.getIERange();if(i)try{t(i,r)}catch(s){n(r)}else n(r)}else{var o=e.getNative();if(o&&o.rangeCount){var u=o.getRangeAt(0),a=o.getRangeAt(o.rangeCount-1);r.setStart(u.startContainer,u.startOffset).setEnd(a.endContainer,a.endOffset),r.collapsed&&domUtils.isBody(r.startContainer)&&!r.startOffset&&n(r)}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;n(r)}}return this._bakRange=r},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e=ie?this.getIERange():this.getRange(),t,n,r,i;if(ie){if(!e)return this.document.body.firstChild;if(e.item)return e.item(0);t=e.duplicate(),t.text.length>0&&t.moveStart("character",1),t.collapse(1),n=t.parentElement(),i=r=e.parentElement();while(r=r.parentNode)if(r==n){n=i;break}}else{e.shrinkBoundary(),n=e.startContainer,n.nodeType==1&&n.hasChildNodes()&&(n=n.childNodes[Math.min(n.childNodes.length-1,e.startOffset)]);if(n.nodeType==3)return n.parentNode}return n},getText:function(){var e,t;return this.isFocus()&&(e=this.getNative())?(t=browser.ie?e.createRange():e.getRangeAt(0),browser.ie?t.text:t.toString()):""},clearRange:function(){this.getNative()[browser.ie?"empty":"removeAllRanges"]()}}}(),function(){function n(e,t){var n;if(t.textarea)if(utils.isString(t.textarea)){for(var r=0,i,s=domUtils.getElementsByTagName(e,"textarea");i=s[r++];)if(i.id=="ueditor_textarea_"+t.options.textarea){n=i;break}}else n=t.textarea;n||(e.appendChild(n=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"ueditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=n),n.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function r(e){for(var t in UE.plugins)UE.plugins[t].call(e);e.langIsReady=!0,e.fireEvent("langReady")}function i(e){for(var t in e)return t}var e=0,t,s=UE.Editor=function(t){var n=this;n.uid=e++,EventBase.call(n),n.commands={},n.options=utils.extend(utils.clone(t||{}),UEDITOR_CONFIG,!0),n.shortcutkeys={},n.inputRules=[],n.outputRules=[],n.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,iframeCssUrl:n.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",customDomain:!1,lang:"zh-cn",langPath:n.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:n.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1,autoSyncData:!0}),utils.isEmptyObject(UE.I18N)?utils.loadFile(document,{src:n.options.langPath+n.options.lang+"/"+n.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){r(n)}):(n.options.lang=i(UE.I18N),r(n)),UE.instants["ueditorInstant"+n.uid]=n};s.prototype={ready:function(e){var t=this;e&&(t.isReady?e.apply(t):t.addListener("ready",e))},setOpt:function(e,t){var n={};utils.isString(e)?n[e]=t:n=e,utils.extend(this.options,n,!0)},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode,n=e.textarea;n?n.style.display="":(n=document.createElement("textarea"),t.parentNode.insertBefore(n,t)),n.style.width=e.iframe.offsetWidth+"px",n.style.height=e.iframe.offsetHeight+"px",n.value=e.getContent(),n.id=e.key,t.innerHTML="",domUtils.remove(t);var r=e.key;for(var i in e)e.hasOwnProperty(i)&&delete this[i];UE.delEditor(r)},render:function(e){var t=this,n=t.options,r=function(t){return parseInt(domUtils.getComputedStyle(e,t))};utils.isString(e)&&(e=document.getElementById(e));if(e){n.initialFrameWidth?n.minFrameWidth=n.initialFrameWidth:n.minFrameWidth=n.initialFrameWidth=e.offsetWidth,n.initialFrameHeight?n.minFrameHeight=n.initialFrameHeight:n.initialFrameHeight=n.minFrameHeight=e.offsetHeight,e.style.width=/%$/.test(n.initialFrameWidth)?"100%":n.initialFrameWidth-r("padding-left")-r("padding-right")+"px",e.style.height=/%$/.test(n.initialFrameHeight)?"100%":n.initialFrameHeight-r("padding-top")-r("padding-bottom")+"px",e.style.zIndex=n.zIndex;var i=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head>"+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:5px 0;}</style>"+(n.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(n.iframeCssUrl)+"'/>":"")+(n.initialStyle?"<style>"+n.initialStyle+"</style>":"")+"</head><body class='view' ></body>"+"<script type='text/javascript' "+(ie?"defer='defer'":"")+" id='_initialScript'>"+"setTimeout(function(){window.parent.UE.instants['ueditorInstant"+t.uid+"']._setup(document);},0);"+"var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);</script></html>";e.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+t.uid,width:"100%",height:"100%",frameborder:"0",src:"javascript:void(function(){document.open();"+(n.customDomain&&document.domain!=location.hostname?'document.domain="'+document.domain+'";':"")+'document.write("'+i+'");document.close();}())'})),e.style.overflow="hidden",setTimeout(function(){/%$/.test(n.initialFrameWidth)&&(n.minFrameWidth=n.initialFrameWidth=e.offsetWidth,e.style.width=n.initialFrameWidth+"px"),/%$/.test(n.initialFrameHeight)&&(n.minFrameHeight=n.initialFrameHeight=e.offsetHeight,e.style.height=n.initialFrameHeight+"px")})}},_setup:function(e){var t=this,r=t.options;ie?(e.body.disabled=!0,e.body.contentEditable=!0,e.body.disabled=!1):e.body.contentEditable=!0,e.body.spellcheck=!1,t.document=e,t.window=e.defaultView||e.parentWindow,t.iframe=t.window.frameElement,t.body=e.body,t.selection=new dom.Selection(e);var i;browser.gecko&&(i=this.selection.getNative())&&i.removeAllRanges(),this._initEvents();for(var s=this.iframe.parentNode;!domUtils.isBody(s);s=s.parentNode)if(s.tagName=="FORM"){t.form=s,t.options.autoSyncData?domUtils.on(t.window,"blur",function(){n(s,t)}):domUtils.on(s,"submit",function(){n(this,t)});break}if(r.initialContent)if(r.autoClearinitialContent){var o=t.execCommand;t.execCommand=function(){return t.fireEvent("firstBeforeExecCommand"),o.apply(t,arguments)},this._setDefaultContent(r.initialContent)}else this.setContent(r.initialContent,!1,!0);domUtils.isEmptyNode(t.body)&&(t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),r.focus&&setTimeout(function(){t.focus(t.options.focusInEnd),!t.options.autoClearinitialContent&&t._selectionChange()},0),t.container||(t.container=this.iframe.parentNode),r.fullscreen&&t.ui&&t.ui.setFullScreen(!0);try{t.document.execCommand("2D-position",!1,!1)}catch(u){}try{t.document.execCommand("enableInlineTableEditing",!1,!1)}catch(u){}try{t.document.execCommand("enableObjectResizing",!1,!1)}catch(u){}t._bindshortcutKeys(),t.isReady=1,t.fireEvent("ready"),r.onready&&r.onready.call(t),browser.ie||domUtils.on(t.window,["blur","focus"],function(e){if(e.type=="blur"){t._bakRange=t.selection.getRange();try{t._bakNativeRange=t.selection.getNative().getRangeAt(0),t.selection.getNative().removeAllRanges()}catch(e){t._bakNativeRange=null}}else try{t._bakRange&&t._bakRange.select()}catch(e){}}),browser.gecko&&browser.version<=10902&&(t.body.contentEditable=!1,setTimeout(function(){t.body.contentEditable=!0},100),setInterval(function(){t.body.style.height=t.iframe.offsetHeight-20+"px"},100)),!r.isShow&&t.setHide(),r.readonly&&t.setDisabled()},sync:function(e){var t=this,r=e?document.getElementById(e):domUtils.findParent(t.iframe.parentNode,function(e){return e.tagName=="FORM"},!0);r&&n(r,t)},setHeight:function(e,t){e!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=e+"px"),!t&&(this.options.minFrameHeight=this.options.initialFrameHeight=e),this.body.style.height=e+"px"},addshortcutkey:function(e,t){var n={};t?n[e]=t:n=e,utils.extend(this.shortcutkeys,n)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which;for(var s in t){var o=t[s].split(",");for(var u=0,a;a=o[u++];){a=a.split(":");var f=a[0],l=a[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(f.toLowerCase())||/^(\d+)$/.test(f))if((RegExp.$1=="ctrl"?r.ctrlKey||r.metaKey:0)&&(RegExp.$2!=""?r[RegExp.$2.slice(1)+"Key"]:1)&&i==RegExp.$3||i==RegExp.$1)e.queryCommandState(s,l)!=-1&&e.execCommand(s,l),domUtils.preventDefault(r)}}})},getContent:function(e,t,n,r,i){var s=this;e&&utils.isFunction(e)&&(t=e,e="");if(t?!t():!this.hasContents())return"";s.fireEvent("beforegetcontent");var o=UE.htmlparser(s.body.innerHTML,r);return s.filterOutputRule(o),s.fireEvent("aftergetcontent",e),o.toHtml(i)},getAllHtml:function(){var e=this,t=[],n="";e.fireEvent("getAllHtml",t);if(browser.ie&&browser.version>8){var r="";utils.each(e.document.styleSheets,function(e){r+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),utils.each(e.document.getElementsByTagName("script"),function(e){r+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(r||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return dtd.$block[n]?"\n":t?t:""}),t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(e,t,r){function o(e){return e.tagName=="DIV"&&e.getAttribute("cdata_tag")}var i=this;i.fireEvent("beforesetcontent",e);var s=UE.htmlparser(e);i.filterInputRule(s),e=s.toHtml(),i.body.innerHTML=(t?i.body.innerHTML:"")+e;if(i.options.enterTag=="p"){var u=this.body.firstChild,a;if(!u||u.nodeType==1&&(dtd.$cdata[u.tagName]||o(u)||domUtils.isCustomeNode(u))&&u===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else{var f=i.document.createElement("p");while(u){while(u&&(u.nodeType==3||u.nodeType==1&&dtd.p[u.tagName]&&!dtd.$cdata[u.tagName]))a=u.nextSibling,f.appendChild(u),u=a;if(f.firstChild){if(!u){i.body.appendChild(f);break}u.parentNode.insertBefore(f,u),f=i.document.createElement("p")}u=u.nextSibling}}}i.fireEvent("aftersetcontent"),i.fireEvent("contentchange"),!r&&i._selectionChange(),i._bakRange=i._bakIERange=i._bakNativeRange=null;var l;browser.gecko&&(l=this.selection.getNative())&&l.removeAllRanges(),i.options.autoSyncData&&i.form&&n(i.form,i)},focus:function(e){try{var t=this,n=t.selection.getRange();e?n.setStartAtLast(t.body.lastChild).setCursor(!1,!0):n.select(!0),this.fireEvent("focus")}catch(r){}},_initEvents:function(){var e=this,t=e.document,n=e.window;e._proxyDomEvent=utils.bind(e._proxyDomEvent,e),domUtils.on(t,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],e._proxyDomEvent),domUtils.on(n,["focus","blur"],e._proxyDomEvent),domUtils.on(t,["mouseup","keydown"],function(t){if(t.type=="keydown"&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey))return;if(t.button==2)return;e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,n){var r=this,i=!1,s,o;if(browser.ie&&browser.version<9&&n&&n.type=="mouseup"){var u=this.selection.getRange();u.collapsed||(i=!0,s=n.clientX,o=n.clientY)}clearTimeout(t),t=setTimeout(function(){if(!r.selection.getNative())return;var e;if(i&&r.selection.getNative().type=="None"){e=r.document.body.createTextRange();try{e.moveToPoint(s,o)}catch(t){e=null}}var u;e&&(u=r.selection.getIERange,r.selection.getIERange=function(){return e}),r.selection.cache(),u&&(r.selection.getIERange=u),r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!n),r.fireEvent("afterselectionchange"),r.selection.clear())},e||50)},_callCmdFn:function(e,t){var n=t[0].toLowerCase(),r,i;r=this.commands[n]||UE.commands[n],i=r&&r[e];if((!r||!i)&&e=="queryCommandState")return 0;if(i)return i.apply(this,t)},execCommand:function(e){e=e.toLowerCase();var t=this,n,r=t.commands[e]||UE.commands[e];return!r||!r.execCommand?null:(!r.notNeedUndo&&!t.__hasEnterExecCommand?(t.__hasEnterExecCommand=!0,t.queryCommandState.apply(t,arguments)!=-1&&(t.fireEvent("beforeexeccommand",e),n=this._callCmdFn("execCommand",arguments),!t._ignoreContentChange&&t.fireEvent("contentchange"),t.fireEvent("afterexeccommand",e)),t.__hasEnterExecCommand=!1):(n=this._callCmdFn("execCommand",arguments),!t._ignoreContentChange&&t.fireEvent("contentchange")),!t._ignoreContentChange&&t._selectionChange(),n)},queryCommandState:function(e){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(e){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(e){if(e)for(var t=0,n;n=e[t++];)if(this.document.getElementsByTagName(n).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;e=["div"];for(t=0;n=e[t++];){var r=domUtils.getElementsByTagName(this.document,n);for(var i=0,s;s=r[i++];)if(domUtils.isCustomeNode(s))return!0}return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var e=this,t;if(e.body.contentEditable=="false"){e.body.contentEditable=!0,t=e.selection.getRange();try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(n){t.setStartAtFirst(e.body).collapse(!0)}t.select(!0),e.bkqueryCommandState&&(e.queryCommandState=e.bkqueryCommandState,delete e.bkqueryCommandState),e.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(e){var t=this;e=e?utils.isArray(e)?e:[e]:[],t.body.contentEditable=="true"&&(t.lastBk||(t.lastBk=t.selection.getRange().createBookmark(!0)),t.body.contentEditable=!1,t.bkqueryCommandState=t.queryCommandState,t.queryCommandState=function(n){return utils.indexOf(e,n)!=-1?t.bkqueryCommandState.apply(t,arguments):-1},t.fireEvent("selectionchange"))},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){var n=this;n.body.innerHTML='<p id="initContent">'+t+"</p>",n.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,t=e.selection.getRange();if(e.container.style.display=="none"){try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(n){t.setStartAtFirst(e.body).collapse(!0)}setTimeout(function(){t.select(!0)},100),e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;e.lastBk||(e.lastBk=e.selection.getRange().createBookmark(!0)),e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UE.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n=0,r;r=e[n++];){t=t[r];if(!t)break}return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]),n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var r=0,i;i=t[r++];)n+=this.document.getElementsByTagName(i).length}return n},addInputRule:function(e){this.inputRules.push(e)},filterInputRule:function(e){for(var t=0,n;n=this.inputRules[t++];)n.call(this,e)},addOutputRule:function(e){this.outputRules.push(e)},filterOutputRule:function(e){for(var t=0,n;n=this.outputRules[t++];)n.call(this,e)}},utils.inherits(s,EventBase)}(),UE.ajax=function(){function r(e){var t=[];for(var n in e){if(n=="method"||n=="timeout"||n=="async")continue;(typeof e[n]).toLowerCase()!="function"&&(typeof e[n]).toLowerCase()!="object"&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}return t.join("&")}var e="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP"),e="ActiveXObject('Msxml2.XMLHTTP')"}catch(t){try{new ActiveXObject("Microsoft.XMLHTTP"),e="ActiveXObject('Microsoft.XMLHTTP')"}catch(t){}}var n=new Function("return new "+e);return{request:function(e,t){var i=n(),s=!1,o={method:"POST",timeout:5e3,async:!0,data:{},onsuccess:function(){},onerror:function(){}};typeof e=="object"&&(t=e,e=t.url);if(!i||!e)return;var u=t?utils.extend(o,t):o,a=r(u);utils.isEmptyObject(u.data)||(a+=(a?"&":"")+r(u.data));var f=setTimeout(function(){i.readyState!=4&&(s=!0,i.abort(),clearTimeout(f))},u.timeout),l=u.method.toUpperCase(),c=e+(e.indexOf("?")==-1?"?":"&")+(l=="POST"?"":a+"&noCache="+ +(new Date));i.open(l,c,u.async),i.onreadystatechange=function(){i.readyState==4&&(!s&&i.status==200?u.onsuccess(i):u.onerror(i))},l=="POST"?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(a)):i.send(null)}}}();var filterWord=UE.filterWord=function(){function e(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig.test(e)}function t(e){return e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)}),e}function n(e){return e.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera)return"";try{var n=e.match(/width:([ \d.]*p[tx])/i)[1],r=e.match(/height:([ \d.]*p[tx])/i)[1],i=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(n)+'" height="'+t(r)+'" src="'+i+'" />'}catch(s){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(e,t,n,r){return t=="class"&&r=="MsoListParagraph"?e:""}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,n,r,i){var s=[],o=i.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var u=0,a;a=o[u];u++){var f,l,c=a.split(":");if(c.length==2){f=c[0].toLowerCase(),l=c[1].toLowerCase();if(/^(background)\w*/.test(f)&&l.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(f)&&/^0\w+$/.test(l))continue;switch(f){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(n)||(s[u]=f.replace(/^mso-|-alt$/g,"")+":"+t(l));continue;case"horiz-align":s[u]="text-align:"+l;continue;case"vert-align":s[u]="vertical-align:"+l;continue;case"font-color":case"mso-foreground":s[u]="color:"+l;continue;case"mso-background":case"mso-highlight":s[u]="background:"+l;continue;case"mso-default-height":s[u]="min-height:"+t(l);continue;case"mso-default-width":s[u]="min-width:"+t(l);continue;case"mso-padding-between-alt":s[u]="border-collapse:separate;border-spacing:"+t(l);continue;case"text-line-through":if(l=="single"||l=="double")s[u]="text-decoration:line-through";continue;case"mso-zero-height":l=="yes"&&(s[u]="display:none");continue;case"background":break;case"margin":if(!/[1-9]/.test(l))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(f)||/text\-indent|padding|margin/.test(f)&&/\-[\d.]+/.test(l))continue;s[u]=f+":"+c[1]}}return n+(s.length?' style="'+s.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)})}return function(t){return e(t)?n(t):t}}();(function(){function r(e,t,r){return e.push(n),t+(r?1:-1)}function i(e,n){for(var r=0;r<n;r++)e.push(t)}function s(e,t,n,f){switch(e.type){case"root":for(var l=0,c;c=e.children[l++];)n&&c.type=="element"&&!dtd.$inlineWithA[c.tagName]&&l>1&&(r(t,f,!0),i(t,f)),s(c,t,n,f);break;case"text":o(e,t);break;case"element":u(e,t,n,f);break;case"comment":a(e,t,n)}return t}function o(e,t){t.push(e.parentNode.tagName=="pre"?e.data:e.data.replace(/[ ]{2}/g," &nbsp;"))}function u(e,t,n,o){var u="";if(e.attrs){u=[];var a=e.attrs;for(var f in a)u.push(f+(a[f]!==undefined?'="'+utils.unhtml(a[f])+'"':""));u=u.join(" ")}t.push("<"+e.tagName+(u?" "+u:"")+(dtd.$empty[e.tagName]?"/":"")+">"),n&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"&&e.children&&e.children.length&&(o=r(t,o,!0),i(t,o));if(e.children&&e.children.length)for(var l=0,c;c=e.children[l++];)n&&c.type=="element"&&!dtd.$inlineWithA[c.tagName]&&l>1&&(r(t,o),i(t,o)),s(c,t,n,o);dtd.$empty[e.tagName]||(n&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"&&e.children&&e.children.length&&(o=r(t,o),i(t,o)),t.push("</"+e.tagName+">"))}function a(e,t){t.push("<!--"+e.data+"-->")}function f(e,t){var n;if(e.type=="element"&&
e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var r=0,i;i=e.children[r++];)if(n=f(i,t))return n}function l(e,t,n){e.type=="element"&&e.tagName==t&&n.push(e);if(e.children&&e.children.length)for(var r=0,i;i=e.children[r++];)l(i,t,n)}function c(e,t){if(e.children&&e.children.length)for(var n=0,r;r=e.children[n];)c(r,t),r.parentNode&&(r.children&&r.children.length&&t(r),r.parentNode&&n++);else t(e)}var e=UE.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},t="    ",n="\n";e.createElement=function(t){return/[<>]/.test(t)?UE.htmlparser(t).children[0]:new e({type:"element",children:[],tagName:t})},e.createText=function(e){return new UE.uNode({type:"text",data:utils.unhtml(e||"")})},e.prototype={toHtml:function(e){var t=[];return s(this,t,e,0),t.join("")},innerHTML:function(e){if(this.type!="element"||dtd.$empty[this.tagName])return this;if(utils.isString(e)){if(this.children)for(var t=0,n;n=this.children[t++];)n.parentNode=null;this.children=[];var r=UE.htmlparser(e);for(var t=0,n;n=r.children[t++];)this.children.push(n),n.parentNode=this;return this}var r=new UE.uNode({type:"root",children:this.children});return r.toHtml()},innerText:function(t){if(this.type!="element"||dtd.$empty[this.tagName])return this;if(t){if(this.children)for(var n=0,r;r=this.children[n++];)r.parentNode=null;return this.children=[],this.appendChild(e.createText(t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return this.type=="element"?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t];t++)if(n===this)return t==0?null:e.children[t-1]},nextSibling:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t++];)if(n===this)return e.children[t]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if(this.type=="root"||this.type=="element"&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t=0,n;n=this.children[t];t++)if(n===e){this.children.splice(t,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n=0,r;r=this.children[n];n++)if(r===t)return this.children.splice(n+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n=0,r;r=this.children[n];n++)if(r===e){this.children.splice(n,1),r.parentNode=null;if(t&&r.children&&r.children.length)for(var i=0,s;s=r.children[i];i++)this.children.splice(n+i,0,s),s.parentNode=this;return r}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e){delete this.attrs;return}this.attrs||(this.attrs={});if(utils.isObject(e))for(var n in e)e[n]?this.attrs[n.toLowerCase()]=e[n]:delete this.attrs[n];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e]},getIndex:function(){var e=this.parentNode;for(var t=0,n;n=e.children[t];t++)if(n===this)return t;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n=0,r;r=this.children[n++];)if(t=f(r,e))return t},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],n=this;return utils.each(e,function(e){if(n.children&&n.children.length)for(var r=0,i;i=n.children[r++];)l(i,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");if(!t)return"";var n=new RegExp(e+":([^;]+)","i"),r=t.match(n);return r&&r[0]?r[1]:""},setStyle:function(e,t){function n(e,t){var n=new RegExp(e+":([^;]+;?)","gi");r=r.replace(n,""),t&&(r=e+":"+utils.unhtml(t)+";"+r)}var r=this.getAttr("style");r||(r="");if(utils.isObject(e))for(var i in e)n(i,e[i]);else n(e,t);this.setAttr("style",utils.trim(r))},traversal:function(e){return this.children&&this.children.length&&c(this,e),this}}})();var htmlparser=UE.htmlparser=function(e,t){function a(e,t){if(u[e.tagName]){var n=s.createElement(u[e.tagName]);e.appendChild(n),n.appendChild(s.createText(t)),e=n}else e.appendChild(s.createText(t))}function f(e,t,n){var i;if(i=o[t]){var u=e,a;while(u.type!="root"){if(utils.isArray(i)?utils.indexOf(i,u.tagName)!=-1:i==u.tagName){e=u,a=!0;break}u=u.parentNode}a||(e=f(e,utils.isArray(i)?i[0]:i))}var l=new s({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(n){var c={},h;while(h=r.exec(n))c[h[1].toLowerCase()]=utils.unhtml(h[2]||h[3]||h[4]);l.attrs=c}return e.children.push(l),dtd.$empty[t]?e:l}function l(e,t){e.children.push(new s({type:"comment",data:t,parentNode:e}))}var n=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,r=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,i={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),""),t||(e=e.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,n){return n&&i[n.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));var s=UE.uNode,o={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},u={ol:"li",ul:"li"},c,h=0,p=0,d=new s({type:"root",children:[]}),v=d;while(c=n.exec(e)){h=c.index;try{h>p&&a(v,e.slice(p,h));if(c[3])v=f(v,c[3].toLowerCase(),c[4]);else if(c[1]){if(v.type!="root"){var m=v;while(v.type=="element"&&v.tagName!=c[1].toLowerCase()){v=v.parentNode;if(v.type=="root")throw v=m,"break"}v=v.parentNode}}else c[2]&&l(v,c[2])}catch(g){}p=n.lastIndex}return p<e.length&&a(v,e.slice(p)),d},filterNode=UE.filterNode=function(){function e(t,n){switch(t.type){case"text":break;case"element":var r;if(r=n[t.tagName])if(r==="-")t.parentNode.removeChild(t);else if(utils.isFunction(r)){var i=t.parentNode,s=t.getIndex();r(t);if(t.parentNode){if(t.children)for(var o=0,u;u=t.children[o];)e(u,n),u.parentNode&&o++}else for(var o=s,u;u=i.children[o];)e(u,n),u.parentNode&&o++}else{var a=r.$;if(a&&t.attrs){var f={},l;for(var c in a){l=t.getAttr(c);if(c=="style"&&utils.isArray(a[c])){var h=[];utils.each(a[c],function(e){var n;(n=t.getStyle(e))&&h.push(e+":"+n)}),l=h.join(";")}l&&(f[c]=l)}t.attrs=f}if(t.children)for(var o=0,u;u=t.children[o];)e(u,n),u.parentNode&&o++}else if(dtd.$cdata[t.tagName])t.parentNode.removeChild(t);else{var i=t.parentNode,s=t.getIndex();t.parentNode.removeChild(t,!0);for(var o=s,u;u=i.children[o];)e(u,n),u.parentNode&&o++}break;case"comment":t.parentNode.removeChild(t)}}return function(t,n){if(utils.isEmptyObject(n))return t;var r;(r=n["-"])&&utils.each(r.split(" "),function(e){n[e]="-"});for(var i=0,s;s=t.children[i];)e(s,n),s.parentNode&&i++;return t}}();UE.plugins.defaultfilter=function(){var e=this;e.setOpt("allowDivTransToP",!0),e.addInputRule(function(t){var n=this.options.allowDivTransToP,r;t.traversal(function(t){if(t.type=="element"){if(!dtd.$cdata[t.tagName]&&e.options.autoClearEmptyNode&&dtd.$inline[t.tagName]&&!dtd.$empty[t.tagName]&&(!t.attrs||utils.isEmptyObject(t.attrs))){t.firstChild()?t.tagName=="span"&&(!t.attrs||utils.isEmptyObject(t.attrs))&&t.parentNode.removeChild(t,!0):t.parentNode.removeChild(t);return}switch(t.tagName){case"style":case"script":t.setAttr({cdata_tag:t.tagName,cdata_data:encodeURIComponent(t.innerText()||"")}),t.tagName="div",t.removeChild(t.firstChild());break;case"a":(r=t.getAttr("href"))&&t.setAttr("_href",r);break;case"img":if(r=t.getAttr("src"))if(/^data:/.test(r)){t.parentNode.removeChild(t);break}t.setAttr("_src",t.getAttr("src"));break;case"span":browser.webkit&&(r=t.getStyle("white-space"))&&/nowrap|normal/.test(r)&&(t.setStyle("white-space",""),e.options.autoClearEmptyNode&&utils.isEmptyObject(t.attrs)&&t.parentNode.removeChild(t,!0));break;case"p":if(r=t.getAttr("align"))t.setAttr("align"),t.setStyle("text-align",r);t.firstChild()||t.innerHTML(browser.ie?"&nbsp;":"<br/>");break;case"div":if(t.getAttr("cdata_tag"))break;r=t.getAttr("class");if(r&&/^line number\d+/.test(r))break;if(!n)break;var i,s=UE.uNode.createElement("p");while(i=t.firstChild())i.type=="text"||!UE.dom.dtd.$block[i.tagName]?s.appendChild(i):s.firstChild()?(t.parentNode.insertBefore(s,t),s=UE.uNode.createElement("p")):t.parentNode.insertBefore(i,t);s.firstChild()&&t.parentNode.insertBefore(s,t),t.parentNode.removeChild(t);break;case"dl":t.tagName="ul";break;case"dt":case"dd":t.tagName="li";break;case"li":var o=t.getAttr("class");(!o||!/list\-/.test(o))&&t.setAttr();var u=t.getNodesByTagName("ol ul");UE.utils.each(u,function(e){t.parentNode.insertAfter(e,t)});break;case"td":case"th":case"caption":(!t.children||!t.children.length)&&t.appendChild(browser.ie?UE.uNode.createText(" "):UE.uNode.createElement("br"))}}t.type=="comment"&&t.parentNode.removeChild(t)})}),e.addOutputRule(function(t){var n;t.traversal(function(t){if(t.type=="element"){if(e.options.autoClearEmptyNode&&dtd.$inline[t.tagName]&&!dtd.$empty[t.tagName]&&(!t.attrs||utils.isEmptyObject(t.attrs))){t.firstChild()?t.tagName=="span"&&(!t.attrs||utils.isEmptyObject(t.attrs))&&t.parentNode.removeChild(t,!0):t.parentNode.removeChild(t);return}switch(t.tagName){case"div":if(n=t.getAttr("cdata_tag"))t.tagName=n,t.appendChild(UE.uNode.createText(t.getAttr("cdata_data"))),t.setAttr({cdata_tag:"",cdata_data:""});break;case"a":(n=t.getAttr("_href"))&&t.setAttr({href:n,_href:""});break;case"img":(n=t.getAttr("_src"))&&t.setAttr({src:t.getAttr("_src"),_src:""})}}})})},UE.commands.inserthtml={execCommand:function(e,t,n){var r=this,i,s;if(!t)return;if(r.fireEvent("beforeinserthtml",t)===!0)return;i=r.selection.getRange(),s=i.document.createElement("div"),s.style.display="inline";if(!n){var o=UE.htmlparser(t);r.options.filterRules&&UE.filterNode(o,r.options.filterRules),r.filterInputRule(o),t=o.toHtml()}s.innerHTML=utils.trim(t);if(!i.collapsed){var u=i.startContainer;domUtils.isFillChar(u)&&i.setStartBefore(u),u=i.endContainer,domUtils.isFillChar(u)&&i.setEndAfter(u),i.txtToElmBoundary(),i.endContainer&&i.endContainer.nodeType==1&&(u=i.endContainer.childNodes[i.endOffset],u&&domUtils.isBr(u)&&i.setEndAfter(u)),i.startOffset==0&&(u=i.startContainer,domUtils.isBoundaryNode(u,"firstChild")&&(u=i.endContainer,i.endOffset==(u.nodeType==3?u.nodeValue.length:u.childNodes.length)&&domUtils.isBoundaryNode(u,"lastChild")&&(r.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",i.setStart(r.body.firstChild,0).collapse(!0)))),!i.collapsed&&i.deleteContents();if(i.startContainer.nodeType==1){var a=i.startContainer.childNodes[i.startOffset],f;if(a&&domUtils.isBlockElm(a)&&(f=a.previousSibling)&&domUtils.isBlockElm(f)){i.setEnd(f,f.childNodes.length).collapse();while(a.firstChild)f.appendChild(a.firstChild);domUtils.remove(a)}}}var a,l,f,c,h=0,p;i.inFillChar()&&(a=i.startContainer,domUtils.isFillChar(a)?(i.setStartBefore(a).collapse(!0),domUtils.remove(a)):domUtils.isFillChar(a,!0)&&(a.nodeValue=a.nodeValue.replace(fillCharReg,""),i.startOffset--,i.collapsed&&i.collapse(!0)));var d=domUtils.findParentByTagName(i.startContainer,"li",!0);if(d){var v,m;while(a=s.firstChild){while(a&&(a.nodeType==3||!domUtils.isBlockElm(a)||a.tagName=="HR"))v=a.nextSibling,i.insertNode(a).collapse(),m=a,a=v;if(a)if(/^(ol|ul)$/i.test(a.tagName)){while(a.firstChild)m=a.firstChild,domUtils.insertAfter(d,a.firstChild),d=d.nextSibling;domUtils.remove(a)}else{var g;v=a.nextSibling,g=r.document.createElement("li"),domUtils.insertAfter(d,g),g.appendChild(a),m=a,a=v,d=g}}d=domUtils.findParentByTagName(i.startContainer,"li",!0),domUtils.isEmptyBlock(d)&&domUtils.remove(d),m&&i.setStartAfter(m).collapse(!0).select(!0)}else{while(a=s.firstChild){if(h){var y=r.document.createElement("p");while(a&&(a.nodeType==3||!dtd.$block[a.tagName]))p=a.nextSibling,y.appendChild(a),a=p;y.firstChild&&(a=y)}i.insertNode(a),p=a.nextSibling;if(!h&&a.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(a)){l=domUtils.findParent(a,function(e){return domUtils.isBlockElm(e)});if(l&&l.tagName.toLowerCase()!="body"&&(!dtd[l.tagName][a.nodeName]||a.parentNode!==l)){if(!dtd[l.tagName][a.nodeName])f=l;else{c=a.parentNode;while(c!==l)f=c,c=c.parentNode}domUtils.breakParent(a,f||c);var f=a.previousSibling;domUtils.trimWhiteTextNode(f),f.childNodes.length||domUtils.remove(f),!browser.ie&&(v=a.nextSibling)&&domUtils.isBlockElm(v)&&v.lastChild&&!domUtils.isBr(v.lastChild)&&v.appendChild(r.document.createElement("br")),h=1}}var v=a.nextSibling;if(!s.firstChild&&v&&domUtils.isBlockElm(v)){i.setStart(v,0).collapse(!0);break}i.setEndAfter(a).collapse()}a=i.startContainer,p&&domUtils.isBr(p)&&domUtils.remove(p);if(domUtils.isBlockElm(a)&&domUtils.isEmptyNode(a))if(p=a.nextSibling)domUtils.remove(a),p.nodeType==1&&dtd.$block[p.tagName]&&i.setStart(p,0).collapse(!0).shrinkBoundary();else try{a.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(b){i.setStartBefore(a),domUtils.remove(a)}try{i.select(!0)}catch(b){}}setTimeout(function(){i=r.selection.getRange(),i.scrollToView(r.autoHeightEnabled,r.autoHeightEnabled?domUtils.getXY(r.iframe).y:0),r.fireEvent("afterinserthtml")},200)}},UE.plugins.autotypeset=function(){function o(e,t){if(!e||e.nodeType==3)return 0;if(domUtils.isBr(e))return 1;if(e&&e.parentNode&&i[e.tagName.toLowerCase()])return s&&s.contains(e)||e.getAttribute("pagebreak")?0:t?!domUtils.isEmptyBlock(e):domUtils.isEmptyBlock(e,new RegExp("[\\s"+domUtils.fillChar+"]","g"))}function u(e){e.style.cssText||(domUtils.removeAttributes(e,["style"]),e.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(e)&&domUtils.remove(e,!0))}function a(e,i){var a=this,f;if(i){if(!t.pasteFilter)return;f=a.document.createElement("div"),f.innerHTML=i.html}else f=a.document.body;var l=domUtils.getElementsByTagName(f,"*");for(var c=0,h;h=l[c++];){if(a.fireEvent("excludeNodeinautotype",h)===!0)continue;t.clearFontSize&&h.style.fontSize&&(domUtils.removeStyle(h,"font-size"),u(h)),t.clearFontFamily&&h.style.fontFamily&&(domUtils.removeStyle(h,"font-family"),u(h));if(o(h)){if(t.mergeEmptyline){var p=h.nextSibling,d,v=domUtils.isBr(h);while(o(p)){d=p,p=d.nextSibling;if(v&&(!p||p&&!domUtils.isBr(p)))break;domUtils.remove(d)}}if(t.removeEmptyline&&domUtils.inDoc(h,f)&&!r[h.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(h)){p=h.nextSibling;if(p&&!domUtils.isBr(p))continue}domUtils.remove(h);continue}}o(h,!0)&&h.tagName!="SPAN"&&(t.indent&&(h.style.textIndent=t.indentValue),t.textAlign&&(h.style.textAlign=t.textAlign));if(t.removeClass&&h.className&&!n[h.className.toLowerCase()]){if(s&&s.contains(h))continue;domUtils.removeAttributes(h,["class"])}if(t.imageBlockLine&&h.tagName.toLowerCase()=="img"&&!h.getAttribute("emotion"))if(i){var m=h;switch(t.imageBlockLine){case"left":case"right":case"none":var g=m.parentNode,d,y,p;while(dtd.$inline[g.tagName]||g.tagName=="A")g=g.parentNode;d=g;if(d.tagName=="P"&&domUtils.getStyle(d,"text-align")=="center"&&!domUtils.isBody(d)&&domUtils.getChildCount(d,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1){y=d.previousSibling,p=d.nextSibling;if(y&&p&&y.nodeType==1&&p.nodeType==1&&y.tagName==p.tagName&&domUtils.isBlockElm(y)){y.appendChild(d.firstChild);while(p.firstChild)y.appendChild(p.firstChild);domUtils.remove(d),domUtils.remove(p)}else domUtils.setStyle(d,"text-align","")}domUtils.setStyle(m,"float",t.imageBlockLine);break;case"center":if(a.queryCommandValue("imagefloat")!="center"){g=m.parentNode,domUtils.setStyle(m,"float","none"),d=m;while(g&&domUtils.getChildCount(g,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1&&(dtd.$inline[g.tagName]||g.tagName=="A"))d=g,g=g.parentNode;var b=a.document.createElement("p");domUtils.setAttributes(b,{style:"text-align:center"}),d.parentNode.insertBefore(b,d),b.appendChild(d),domUtils.setStyle(d,"float","")}}}else{var w=a.selection.getRange();w.selectNode(h).select(),a.execCommand("imagefloat",t.imageBlockLine)}t.removeEmptyNode&&t.removeTagNames[h.tagName.toLowerCase()]&&domUtils.hasNoAttributes(h)&&domUtils.isEmptyBlock(h)&&domUtils.remove(h)}i&&(i.html=f.innerHTML)}this.setOpt({autotypeset:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,textAlign:"left",imageBlockLine:"center",pasteFilter:!1,clearFontSize:!1,clearFontFamily:!1,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:!1,indentValue:"2em"}});var e=this,t=e.options.autotypeset,n={selectTdClass:1,pagebreak:1,anchorclass:1},r={li:1},i={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1},s;if(!t)return;t.pasteFilter&&e.addListener("beforepaste",a),e.commands.autotypeset={execCommand:function(){e.removeListener("beforepaste",a),t.pasteFilter&&e.addListener("beforepaste",a),a.call(e)}}},UE.plugins.autosubmit=function(){var e=this;e.commands.autosubmit={execCommand:function(){var e=this,t=domUtils.findParentByTagName(e.iframe,"form",!1);if(t){if(e.fireEvent("beforesubmit")===!1)return;e.sync(),t.submit()}}},e.addshortcutkey({autosubmit:"ctrl+13"})},UE.plugins.background=function(){var e=this;e.addListener("getAllHtml",function(t,n){var r=this.body,i=domUtils.getComputedStyle(r,"background-image"),s="";i.indexOf(e.options.imagePath)>0?s=i.substring(i.indexOf(e.options.imagePath),i.length-1).replace(/"|\(|\)/ig,""):s=i!="none"?i.replace(/url\("?|"?\)/ig,""):"";var o='<style type="text/css">body{',u={"background-color":domUtils.getComputedStyle(r,"background-color")||"#ffffff","background-image":s?"url("+s+")":"","background-repeat":domUtils.getComputedStyle(r,"background-repeat")||"","background-position":browser.ie?domUtils.getComputedStyle(r,"background-position-x")+" "+domUtils.getComputedStyle(r,"background-position-y"):domUtils.getComputedStyle(r,"background-position"),height:domUtils.getComputedStyle(r,"height")};for(var a in u)u.hasOwnProperty(a)&&(o+=a+":"+u[a]+";");o+="}</style> ",n.push(o)})},UE.commands.imagefloat={execCommand:function(e,t){var n=this,r=n.selection.getRange();if(!r.collapsed){var i=r.getClosedNode();if(i&&i.tagName=="IMG")switch(t){case"left":case"right":case"none":var s=i.parentNode,o,u,a;while(dtd.$inline[s.tagName]||s.tagName=="A")s=s.parentNode;o=s;if(o.tagName=="P"&&domUtils.getStyle(o,"text-align")=="center"){if(!domUtils.isBody(o)&&domUtils.getChildCount(o,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1){u=o.previousSibling,a=o.nextSibling;if(u&&a&&u.nodeType==1&&a.nodeType==1&&u.tagName==a.tagName&&domUtils.isBlockElm(u)){u.appendChild(o.firstChild);while(a.firstChild)u.appendChild(a.firstChild);domUtils.remove(o),domUtils.remove(a)}else domUtils.setStyle(o,"text-align","")}r.selectNode(i).select()}domUtils.setStyle(i,"float",t=="none"?"":t),t=="none"&&domUtils.removeAttributes(i,"align");break;case"center":if(n.queryCommandValue("imagefloat")!="center"){s=i.parentNode,domUtils.setStyle(i,"float",""),domUtils.removeAttributes(i,"align"),o=i;while(s&&domUtils.getChildCount(s,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1&&(dtd.$inline[s.tagName]||s.tagName=="A"))o=s,s=s.parentNode;r.setStartBefore(o).setCursor(!1),s=n.document.createElement("div"),s.appendChild(o),domUtils.setStyle(o,"float",""),n.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+s.innerHTML+"</p>"),o=n.document.getElementById("_img_parent_tmp"),o.removeAttribute("id"),o=o.firstChild,r.selectNode(o).select(),a=o.parentNode.nextSibling,a&&domUtils.isEmptyNode(a)&&domUtils.remove(a)}}}},queryCommandValue:function(){var e=this.selection.getRange(),t,n;return e.collapsed?"none":(t=e.getClosedNode(),t&&t.nodeType==1&&t.tagName=="IMG"?(n=t.getAttribute("align")||domUtils.getComputedStyle(t,"float"),n=="none"&&(n=domUtils.getComputedStyle(t.parentNode,"text-align")=="center"?"center":n),{left:1,right:1,center:1}[n]?n:"none"):"none")},queryCommandState:function(){var e=this.selection.getRange(),t;return e.collapsed?-1:(t=e.getClosedNode(),t&&t.nodeType==1&&t.tagName=="IMG"?0:-1)}},UE.commands.insertimage={execCommand:function(e,t){t=utils.isArray(t)?t:[t];if(!t.length)return;var n=this,r=n.selection.getRange(),i=r.getClosedNode();if(i&&/img/i.test(i.tagName)&&i.className!="edui-faked-video"&&!i.getAttribute("word_img")){var s=t.shift(),o=s.floatStyle;delete s.floatStyle,domUtils.setAttributes(i,s),n.execCommand("imagefloat",o),t.length>0&&(r.setStartAfter(i).setCursor(!1,!0),n.execCommand("insertimage",t))}else{var u=[],a="",f;f=t[0];if(t.length==1)a='<img src="'+f.src+'" '+(f._src?' _src="'+f._src+'" ':"")+(f.width?'width="'+f.width+'" ':"")+(f.height?' height="'+f.height+'" ':"")+(f["floatStyle"]=="left"||f["floatStyle"]=="right"?' style="float:'+f.floatStyle+';"':"")+(f.title&&f.title!=""?' title="'+f.title+'"':"")+(f.border&&f.border!="0"?' border="'+f.border+'"':"")+(f.alt&&f.alt!=""?' alt="'+f.alt+'"':"")+(f.hspace&&f.hspace!="0"?' hspace = "'+f.hspace+'"':"")+(f.vspace&&f.vspace!="0"?' vspace = "'+f.vspace+'"':"")+"/>",f["floatStyle"]=="center"&&(a='<p style="text-align: center">'+a+"</p>"),u.push(a);else for(var l=0;f=t[l++];)a="<p "+(f["floatStyle"]=="center"?'style="text-align: center" ':"")+'><img src="'+f.src+'" '+(f.width?'width="'+f.width+'" ':"")+(f._src?' _src="'+f._src+'" ':"")+(f.height?' height="'+f.height+'" ':"")+' style="'+(f.floatStyle&&f["floatStyle"]!="center"?"float:"+f.floatStyle+";":"")+(f.border||"")+'" '+(f.title?' title="'+f.title+'"':"")+" /></p>",u.push(a);n.execCommand("insertHtml",u.join(""))}}},UE.plugins.justify=function(){var e=this,t=domUtils.isBlockElm,n={left:1,right:1,center:1,justify:1},r=function(e,n){var r=e.createBookmark(),i=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)};e.enlarge(!0);var s=e.createBookmark(),o=domUtils.getNextDomNode(s.start,!1,i),u=e.cloneRange(),a;while(o&&!(domUtils.getPosition(o,s.end)&domUtils.POSITION_FOLLOWING))if(o.nodeType==3||!t(o)){u.setStartBefore(o);while(o&&o!==s.end&&!t(o))a=o,o=domUtils.getNextDomNode(o,!1,null,function(e){return!t(e)});u.setEndAfter(a);var f=u.getCommonAncestor();if(!domUtils.isBody(f)&&t(f))domUtils.setStyles(f,utils.isString(n)?{"text-align":n}:n),o=f;else{var l=e.document.createElement("p");domUtils.setStyles(l,utils.isString(n)?{"text-align":n}:n);var c=u.extractContents();l.appendChild(c),u.insertNode(l),o=l}o=domUtils.getNextDomNode(o,!1,i)}else o=domUtils.getNextDomNode(o,!0,i);return e.moveToBookmark(s).moveToBookmark(r)};UE.commands.justify={execCommand:function(e,t){var n=this.selection.getRange(),i;return n.collapsed&&(i=this.document.createTextNode("p"),n.insertNode(i)),r(n,t),i&&(n.setStartBefore(i).collapse(!0),domUtils.remove(i)),n.select(),!0},queryCommandValue:function(){var e=this.selection.getStart(),t=domUtils.getComputedStyle(e,"text-align");return n[t]?t:"left"},queryCommandState:function(){var e=this.selection.getStart(),t=e&&domUtils.findParentByTagName(e,["td","th","caption"],!0);return t?-1:0}}},UE.plugins.font=function(){function i(e){var t;while(t=e.parentNode){if(t.tagName!="SPAN"||domUtils.getChildCount(t,function(e){return!domUtils.isBookmarkNode(e)&&!domUtils.isBr(e)})!=1)break;t.style.cssText+=e.style.cssText,domUtils.remove(e,!0),e=t}}function s(e,t,n){if(r[t]){e.adjustmentBoundary();if(!e.collapsed&&e.startContainer.nodeType==1){var i=e.startContainer.childNodes[e.startOffset];if(i&&domUtils.isTagNode(i,"span")){var s=e.createBookmark();utils.each(domUtils.getElementsByTagName(i,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(t=="backcolor"&&domUtils.getComputedStyle(e,"background-color").toLowerCase()===n)return;domUtils.removeStyle(e,r[t]),e.style.cssText.replace(/^\s+$/,"").length==0&&domUtils.remove(e,!0)}),e.moveToBookmark(s)}}}}function o(e,t,n){var r=e.collapsed,o=e.createBookmark(),u;if(r){u=o.start.parentNode;while(dtd.$inline[u.tagName])u=u.parentNode}else u=domUtils.getCommonAncestor(o.start,o.end);utils.each(domUtils.getElementsByTagName(u,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(/\s*border\s*:\s*none;?\s*/i.test(e.style.cssText)){/^\s*border\s*:\s*none;?\s*$/.test(e.style.cssText)?domUtils.remove(e,!0):domUtils.removeStyle(e,"border");return}/border/i.test(e.style.cssText)&&e.parentNode.tagName=="SPAN"&&/border/i.test(e.parentNode.style.cssText)&&(e.style.cssText=e.style.cssText.replace(/border[^:]*:[^;]+;?/gi,""));if(t!="fontborder"||n!="none"){var r=e.nextSibling;while(r&&r.nodeType==1&&r.tagName=="SPAN"){if(domUtils.isBookmarkNode(r)&&t=="fontborder"){e.appendChild(r),r=e.nextSibling;continue}r.style.cssText==e.style.cssText&&(domUtils.moveChild(r,e),domUtils.remove(r));if(e.nextSibling===r)break;r=e.nextSibling}}i(e);if(browser.ie&&browser.version>8){var s=domUtils.findParent(e,function(e){return e.tagName=="SPAN"&&/background-color/.test(e.style.cssText)});s&&!/background-color/.test(e.style.cssText)&&(e.style.backgroundColor=s.style.backgroundColor)}}),e.moveToBookmark(o),s(e,t,n)}var e=this,t={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},n={underline:1,strikethrough:1,fontborder:1},r={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]}),e.addInputRule(function(e){utils.each(e.getNodesByTagName("u s del font strike"),function(e){if(e.tagName=="font"){var t=[];for(var n in e.attrs)switch(n){case"size":t.push("font-size:"+e.attrs[n]+"px");break;case"color":t.push("color:"+e.attrs[n]);break;case"face":t.push("font-family:"+e.attrs[n]);break;case"style":t.push(e.attrs[n])}e.attrs={style:t.join(";")}}else{var r=e.tagName=="u"?"underline":"line-through";e.attrs={style:(e.getAttr("style")||"")+"text-decoration:"+r+";"}}e.tagName="span"})});for(var u in t)(function(e,t){UE.commands[e]={execCommand:function(r,i){i=i||(this.queryCommandState(r)?"none":r=="underline"?"underline":r=="fontborder"?"1px solid #000":"line-through");var s=this,u=this.selection.getRange(),a;if(i=="default")u.collapsed&&(a=s.document.createTextNode("font"),u.insertNode(a).select()),s.execCommand("removeFormat","span,a",t),a&&(u.setStartBefore(a).collapse(!0),domUtils.remove(a)),o(u,r,i),u.select();else if(!u.collapsed)n[e]&&s.queryCommandValue(e)&&s.execCommand("removeFormat","span,a",t),u=s.selection.getRange(),u.applyInlineStyle("span",{style:t+":"+i}),o(u,r,i),u.select();else{var f=domUtils.findParentByTagName(u.startContainer,"span",!0);a=s.document.createTextNode("font");if(f&&!f.children.length&&!f[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length)u.insertNode(a),n[e]&&(u.selectNode(a).select(),s.execCommand("removeFormat","span,a",t,null),f=domUtils.findParentByTagName(a,"span",!0),u.setStartBefore(a)),f&&(f.style.cssText+=";"+t+":"+i),u.collapse(!0).select();else{u.insertNode(a),u.selectNode(a).select(),f=u.document.createElement("span");if(n[e]){if(domUtils.findParentByTagName(a,"a",!0)){u.setStartBefore(a).setCursor(),domUtils.remove(a);return}s.execCommand("removeFormat","span,a",t)}f.style.cssText=t+":"+i,a.parentNode.insertBefore(f,a);if(!browser.ie||browser.ie&&browser.version==9){var l=f.parentNode;while(!domUtils.isBlockElm(l))l.tagName=="SPAN"&&(f.style.cssText=l.style.cssText+";"+f.style.cssText),l=l.parentNode}opera?setTimeout(function(){u.setStart(f,0).collapse(!0),o(u,r,i),u.select()}):(u.setStart(f,0).collapse(!0),o(u,r,i),u.select())}domUtils.remove(a)}return!0},queryCommandValue:function(e){var n=this.selection.getStart();if(e=="underline"||e=="strikethrough"){var r=n,i;while(r&&!domUtils.isBlockElm(r)&&!domUtils.isBody(r)){if(r.nodeType==1){i=domUtils.getComputedStyle(r,t);if(i!="none")return i}r=r.parentNode}return"none"}if(e=="fontborder"){var s=n,o;while(s&&dtd.$inline[s.tagName]){if(o=domUtils.getComputedStyle(s,"border"))if(/1px/.test(o)&&/solid/.test(o))return o;s=s.parentNode}return""}if(e=="FontSize"){var u=domUtils.getComputedStyle(n,t),s=/^([\d\.]+)(\w+)$/.exec(u);return s?Math.floor(s[1])+s[2]:u}return domUtils.getComputedStyle(n,t)},queryCommandState:function(e){if(!n[e])return 0;var t=this.queryCommandValue(e);return e=="fontborder"?/1px/.test(t)&&/solid/.test(t):t==(e=="underline"?"underline":"line-through")}}})(u,t[u])},UE.plugins.link=function(){function e(e){var t=e.startContainer,n=e.endContainer;(t=domUtils.findParentByTagName(t,"a",!0))&&e.setStartBefore(t),(n=domUtils.findParentByTagName(n,"a",!0))&&e.setEndAfter(n)}function t(t,n,r){var i=t.cloneRange(),s=r.queryCommandValue("link");e(t=t.adjustmentBoundary());var o=t.startContainer;o.nodeType==1&&s&&(o=o.childNodes[t.startOffset],o&&o.nodeType==1&&o.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(o[browser.ie?"innerText":"textContent"])&&(o[browser.ie?"innerText":"textContent"]=utils.html(n.textValue||n.href)));if(!i.collapsed||s)t.removeInlineStyle("a"),i=t.cloneRange();if(i.collapsed){var u=t.document.createElement("a"),a="";n.textValue?(a=utils.html(n.textValue),delete n.textValue):a=utils.html(n.href),domUtils.setAttributes(u,n),o=domUtils.findParentByTagName(i.startContainer,"a",!0),o&&domUtils.isInNodeEndBoundary(i,o)&&t.setStartAfter(o).collapse(!0),u[browser.ie?"innerText":"textContent"]=a,t.insertNode(u).selectNode(u)}else t.applyInlineStyle("a",n)}UE.commands.unlink={execCommand:function(){var t=this.selection.getRange(),n;if(t.collapsed&&!domUtils.findParentByTagName(t.startContainer,"a",!0))return;n=t.createBookmark(),e(t),t.removeInlineStyle("a").moveToBookmark(n).select()},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}},UE.commands.link={execCommand:function(e,n){var r;n._href&&(n._href=utils.unhtml(n._href,/[<">]/g)),n.href&&(n.href=utils.unhtml(n.href,/[<">]/g)),n.textValue&&(n.textValue=utils.unhtml(n.textValue,/[<">]/g)),t(r=this.selection.getRange(),n,this),r.collapse().select(!0)},queryCommandValue:function(){var e=this.selection.getRange(),t;if(!e.collapsed){e.shrinkBoundary();var n=e.startContainer.nodeType==3||!e.startContainer.childNodes[e.startOffset]?e.startContainer:e.startContainer.childNodes[e.startOffset],r=e.endContainer.nodeType==3||e.endOffset==0?e.endContainer:e.endContainer.childNodes[e.endOffset-1],i=e.getCommonAncestor();t=domUtils.findParentByTagName(i,"a",!0);if(!t&&i.nodeType==1){var s=i.getElementsByTagName("a"),o,u;for(var a=0,f;f=s[a++];){o=domUtils.getPosition(f,n),u=domUtils.getPosition(f,r);if((o&domUtils.POSITION_FOLLOWING||o&domUtils.POSITION_CONTAINS)&&(u&domUtils.POSITION_PRECEDING||u&domUtils.POSITION_CONTAINS)){t=f;break}}}return t}t=e.startContainer,t=t.nodeType==1?t:t.parentNode;if(t&&(t=domUtils.findParentByTagName(t,"a",!0))&&!domUtils.isInNodeEndBoundary(e,t))return t},queryCommandState:function(){var e=this.selection.getRange().getClosedNode(),t=e&&e.className=="edui-faked-video";return t?-1:0}}},UE.plugins.insertframe=function(){function t(){e._iframe&&delete e._iframe}var e=this;e.addListener("selectionchange",function(){t()})},UE.commands.scrawl={queryCommandState:function(){return browser.ie&&browser.version<=8?-1:0}},UE.plugins.removeformat=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),e.commands.removeformat={execCommand:function(e,t,n,r,i){function h(e){if(e.nodeType==3||e.tagName.toLowerCase()!="span")return 0;if(browser.ie){var t=e.attributes;if(t.length){for(var n=0,r=t.length;n<r;n++)if(t[n].specified)return 0;return 1}}return!e.attributes.length}function p(e){var t=e.createBookmark();e.collapsed&&e.enlarge(!0);if(!i){var r=domUtils.findParentByTagName(e.startContainer
,"a",!0);r&&e.setStartBefore(r),r=domUtils.findParentByTagName(e.endContainer,"a",!0),r&&e.setEndAfter(r)}a=e.createBookmark(),d=a.start;while((l=d.parentNode)&&!domUtils.isBlockElm(l))domUtils.breakParent(d,l),domUtils.clearEmptySibling(d);if(a.end){d=a.end;while((l=d.parentNode)&&!domUtils.isBlockElm(l))domUtils.breakParent(d,l),domUtils.clearEmptySibling(d);var u=domUtils.getNextDomNode(a.start,!1,c),f;while(u){if(u==a.end)break;f=domUtils.getNextDomNode(u,!0,c),!dtd.$empty[u.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(u)&&(s.test(u.tagName)?n?(domUtils.removeStyle(u,n),h(u)&&n!="text-decoration"&&domUtils.remove(u,!0)):domUtils.remove(u,!0):!dtd.$tableContent[u.tagName]&&!dtd.$list[u.tagName]&&(domUtils.removeAttributes(u,o),h(u)&&domUtils.remove(u,!0))),u=f}}var p=a.start.parentNode;domUtils.isBlockElm(p)&&!dtd.$tableContent[p.tagName]&&!dtd.$list[p.tagName]&&domUtils.removeAttributes(p,o),p=a.end.parentNode,a.end&&domUtils.isBlockElm(p)&&!dtd.$tableContent[p.tagName]&&!dtd.$list[p.tagName]&&domUtils.removeAttributes(p,o),e.moveToBookmark(a).moveToBookmark(t);var d=e.startContainer,v,m=e.collapsed;while(d.nodeType==1&&domUtils.isEmptyNode(d)&&dtd.$removeEmpty[d.tagName])v=d.parentNode,e.setStartBefore(d),e.startContainer===e.endContainer&&e.endOffset--,domUtils.remove(d),d=v;if(!m){d=e.endContainer;while(d.nodeType==1&&domUtils.isEmptyNode(d)&&dtd.$removeEmpty[d.tagName])v=d.parentNode,e.setEndBefore(d),domUtils.remove(d),d=v}}var s=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),o=n?[]:(r||this.options.removeFormatAttributes).split(","),u=new dom.Range(this.document),a,f,l,c=function(e){return e.nodeType==1};u=this.selection.getRange(),p(u),u.select()}}},UE.plugins.blockquote=function(){function t(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),"blockquote")}var e=this;e.commands.blockquote={execCommand:function(e,n){var r=this.selection.getRange(),i=t(this),s=dtd.blockquote,o=r.createBookmark();if(i){var u=r.startContainer,a=domUtils.isBlockElm(u)?u:domUtils.findParent(u,function(e){return domUtils.isBlockElm(e)}),f=r.endContainer,l=domUtils.isBlockElm(f)?f:domUtils.findParent(f,function(e){return domUtils.isBlockElm(e)});a=domUtils.findParentByTagName(a,"li",!0)||a,l=domUtils.findParentByTagName(l,"li",!0)||l,a.tagName=="LI"||a.tagName=="TD"||a===i||domUtils.isBody(a)?domUtils.remove(i,!0):domUtils.breakParent(a,i),a!==l&&(i=domUtils.findParentByTagName(l,"blockquote"),i&&(l.tagName=="LI"||l.tagName=="TD"||domUtils.isBody(l)?i.parentNode&&domUtils.remove(i,!0):domUtils.breakParent(l,i)));var c=domUtils.getElementsByTagName(this.document,"blockquote");for(var h=0,p;p=c[h++];)p.childNodes.length?domUtils.getPosition(p,a)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(p,l)&domUtils.POSITION_PRECEDING&&domUtils.remove(p,!0):domUtils.remove(p)}else{var d=r.cloneRange(),v=d.startContainer.nodeType==1?d.startContainer:d.startContainer.parentNode,m=v,g=1;for(;;){if(domUtils.isBody(v)){m!==v?r.collapsed?(d.selectNode(m),g=0):d.setStartBefore(m):d.setStart(v,0);break}if(!s[v.tagName]){r.collapsed?d.selectNode(m):d.setStartBefore(m);break}m=v,v=v.parentNode}if(g){m=v=v=d.endContainer.nodeType==1?d.endContainer:d.endContainer.parentNode;for(;;){if(domUtils.isBody(v)){m!==v?d.setEndAfter(m):d.setEnd(v,v.childNodes.length);break}if(!s[v.tagName]){d.setEndAfter(m);break}m=v,v=v.parentNode}}v=r.document.createElement("blockquote"),domUtils.setAttributes(v,n),v.appendChild(d.extractContents()),d.insertNode(v);var y=domUtils.getElementsByTagName(v,"blockquote");for(var h=0,b;b=y[h++];)b.parentNode&&domUtils.remove(b,!0)}r.moveToBookmark(o).select()},queryCommandState:function(){return t(this)?1:0}}},UE.commands.touppercase=UE.commands.tolowercase={execCommand:function(e){var t=this,n=t.selection.getRange();if(n.collapsed)return n;var r=n.createBookmark(),i=r.end,s=function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)},o=domUtils.getNextDomNode(r.start,!1,s);while(o&&domUtils.getPosition(o,i)&domUtils.POSITION_PRECEDING){o.nodeType==3&&(o.nodeValue=o.nodeValue[e=="touppercase"?"toUpperCase":"toLowerCase"]()),o=domUtils.getNextDomNode(o,!0,s);if(o===i)break}n.moveToBookmark(r).select()}},UE.commands.indent={execCommand:function(){var e=this,t=e.queryCommandState("indent")?"0em":e.options.indentValue||"2em";e.execCommand("Paragraph","p",{style:"text-indent:"+t})},queryCommandState:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e&&e.style.textIndent&&parseInt(e.style.textIndent)?1:0}},UE.commands.print={execCommand:function(){this.window.print()},notNeedUndo:1},UE.commands.preview={execCommand:function(){var e=window.open("","_blank",""),t=e.document;t.open(),t.write('<html><head><script src="'+this.options.UEDITOR_HOME_URL+'ueditor.parse.js"></script><script>'+"setTimeout(function(){uParse('div',{"+"    'highlightJsUrl':'"+this.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCore.js',"+"    'highlightCssUrl':'"+this.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCoreDefault.css'"+"})},300)"+"</script></head><body><div>"+this.getContent(null,null,!0)+"</div></body></html>"),t.close()},notNeedUndo:1},UE.plugins.selectall=function(){var e=this;e.commands.selectall={execCommand:function(){var e=this,t=e.body,n=e.selection.getRange();n.selectNodeContents(t),domUtils.isEmptyBlock(t)&&(browser.opera&&t.firstChild&&t.firstChild.nodeType==1&&n.setStartAtFirst(t.firstChild),n.collapse(!0)),n.select(!0)},notNeedUndo:1},e.addshortcutkey({selectAll:"ctrl+65"})},UE.plugins.paragraph=function(){var e=this,t=domUtils.isBlockElm,n=["TD","LI","PRE"],r=function(e,r,i,s){var o=e.createBookmark(),u=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},a;e.enlarge(!0);var f=e.createBookmark(),l=domUtils.getNextDomNode(f.start,!1,u),c=e.cloneRange(),h;while(l&&!(domUtils.getPosition(l,f.end)&domUtils.POSITION_FOLLOWING))if(l.nodeType==3||!t(l)){c.setStartBefore(l);while(l&&l!==f.end&&!t(l))h=l,l=domUtils.getNextDomNode(l,!1,null,function(e){return!t(e)});c.setEndAfter(h),a=e.document.createElement(r),i&&(domUtils.setAttributes(a,i),s&&s=="customstyle"&&i.style&&(a.style.cssText=i.style)),a.appendChild(c.extractContents()),domUtils.isEmptyNode(a)&&domUtils.fillChar(e.document,a),c.insertNode(a);var p=a.parentNode;if(t(p)&&!domUtils.isBody(a.parentNode)&&utils.indexOf(n,p.tagName)==-1){if(!s||s!="customstyle")p.getAttribute("dir")&&a.setAttribute("dir",p.getAttribute("dir")),p.style.cssText&&(a.style.cssText=p.style.cssText+";"+a.style.cssText),p.style.textAlign&&!a.style.textAlign&&(a.style.textAlign=p.style.textAlign),p.style.textIndent&&!a.style.textIndent&&(a.style.textIndent=p.style.textIndent),p.style.padding&&!a.style.padding&&(a.style.padding=p.style.padding);i&&/h\d/i.test(p.tagName)&&!/h\d/i.test(a.tagName)?(domUtils.setAttributes(p,i),s&&s=="customstyle"&&i.style&&(p.style.cssText=i.style),domUtils.remove(a,!0),a=p):domUtils.remove(a.parentNode,!0)}utils.indexOf(n,p.tagName)!=-1?l=p:l=a,l=domUtils.getNextDomNode(l,!1,u)}else l=domUtils.getNextDomNode(l,!0,u);return e.moveToBookmark(f).moveToBookmark(o)};e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),e.commands.paragraph={execCommand:function(e,t,n,i){var s=this.selection.getRange();if(s.collapsed){var o=this.document.createTextNode("p");s.insertNode(o);if(browser.ie){var u=o.previousSibling;u&&domUtils.isWhitespace(u)&&domUtils.remove(u),u=o.nextSibling,u&&domUtils.isWhitespace(u)&&domUtils.remove(u)}}s=r(s,t,n,i),o&&(s.setStartBefore(o).collapse(!0),pN=o.parentNode,domUtils.remove(o),domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)&&domUtils.fillNode(this.document,pN));if(browser.gecko&&s.collapsed&&s.startContainer.nodeType==1){var a=s.startContainer.childNodes[s.startOffset];a&&a.nodeType==1&&a.tagName.toLowerCase()==t&&s.setStart(a,0).collapse(!0)}return s.select(),!0},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e?e.tagName.toLowerCase():""}}},function(){var e=domUtils.isBlockElm,t=function(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),function(e){return e.getAttribute("dir")})},n=function(n,r,i){var s,o=function(e){return e.nodeType==1?!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},u=t(r);if(u&&n.collapsed)return u.setAttribute("dir",i),n;s=n.createBookmark(),n.enlarge(!0);var a=n.createBookmark(),f=domUtils.getNextDomNode(a.start,!1,o),l=n.cloneRange(),c;while(f&&!(domUtils.getPosition(f,a.end)&domUtils.POSITION_FOLLOWING))if(f.nodeType==3||!e(f)){l.setStartBefore(f);while(f&&f!==a.end&&!e(f))c=f,f=domUtils.getNextDomNode(f,!1,null,function(t){return!e(t)});l.setEndAfter(c);var h=l.getCommonAncestor();if(!domUtils.isBody(h)&&e(h))h.setAttribute("dir",i),f=h;else{var p=n.document.createElement("p");p.setAttribute("dir",i);var d=l.extractContents();p.appendChild(d),l.insertNode(p),f=p}f=domUtils.getNextDomNode(f,!1,o)}else f=domUtils.getNextDomNode(f,!0,o);return n.moveToBookmark(a).moveToBookmark(s)};UE.commands.directionality={execCommand:function(e,t){var r=this.selection.getRange();if(r.collapsed){var i=this.document.createTextNode("d");r.insertNode(i)}return n(r,this,t),i&&(r.setStartBefore(i).collapse(!0),domUtils.remove(i)),r.select(),!0},queryCommandValue:function(){var e=t(this);return e?e.getAttribute("dir"):"ltr"}}}(),UE.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(e){var t=this;if(t.queryCommandState(e)!==-1){t.execCommand("insertHtml","<hr>");var n=t.selection.getRange(),r=n.startContainer;if(r.nodeType==1&&!r.childNodes[n.startOffset]){var i;(i=r.childNodes[n.startOffset-1])&&i.nodeType==1&&i.tagName=="HR"&&(t.options.enterTag=="p"?(i=t.document.createElement("p"),n.insertNode(i),n.setStart(i,0).setCursor()):(i=t.document.createElement("br"),n.insertNode(i),n.setStartBefore(i).setCursor()))}return!0}},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}},e.addListener("delkeydown",function(e,t){var n=this.selection.getRange();n.txtToElmBoundary(!0);if(domUtils.isStartInblock(n)){var r=n.startContainer,i=r.previousSibling;if(i&&domUtils.isTagNode(i,"hr"))return domUtils.remove(i),n.select(),domUtils.preventDefault(t),!0}})},UE.commands.time=UE.commands.date={execCommand:function(e){var t=new Date;this.execCommand("insertHtml",e=="time"?t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds()):t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate()))}},UE.plugins.rowspacing=function(){var e=this;e.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]}),e.commands.rowspacing={execCommand:function(e,t,n){return this.execCommand("paragraph","p",{style:"margin-"+n+":"+t+"px"}),!0},queryCommandValue:function(e,t){var n=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return domUtils.isBlockElm(e)}),r;return n?(r=domUtils.getComputedStyle(n,"margin-"+t).replace(/[^\d]/g,""),r?r:0):0}}},UE.plugins.lineheight=function(){var e=this;e.setOpt({lineheight:["1","1.5","1.75","2","3","4","5"]}),e.commands.lineheight={execCommand:function(e,t){return this.execCommand("paragraph","p",{style:"line-height:"+(t=="1"?"normal":t+"em")}),!0},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return domUtils.isBlockElm(e)});if(e){var t=domUtils.getComputedStyle(e,"line-height");return t=="normal"?1:t.replace(/[^\d.]*/ig,"")}}}},UE.plugins.insertcode=function(){var e=this;e.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",e.document)}),e.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"}),e.commands.insertcode={execCommand:function(e,t){var n=this,r=n.selection.getRange(),i=domUtils.findParentByTagName(r.startContainer,"pre",!0);if(i)i.className="lang-"+t+"; toolbar:false;";else{var s="";if(r.collapsed)s=browser.ie?browser.version>8?"":"&nbsp;":"<br/>";else{var o=r.extractContents(),u=n.document.createElement("div");u.appendChild(o),utils.each(UE.filterNode(UE.htmlparser(u.innerHTML.replace(/[\r\t]/g,"")),n.options.filterTxtRules).children,function(e){if(browser.ie&&browser.version>8)e.type=="element"?e.tagName=="br"?s+="\n":dtd.$empty[e.tagName]||(utils.each(e.children,function(t){t.type=="element"?t.tagName=="br"?s+="\n":dtd.$empty[e.tagName]||(s+=t.innerText()):s+=t.data}),/\n$/.test(s)||(s+="\n")):s+=e.data+"\n",!e.nextSibling()&&/\n$/.test(s)&&(s=s.replace(/\n$/,""));else if(browser.ie)e.type=="element"?e.tagName=="br"?s+="<br>":dtd.$empty[e.tagName]||(utils.each(e.children,function(t){t.type=="element"?t.tagName=="br"?s+="<br>":dtd.$empty[e.tagName]||(s+=t.innerText()):s+=t.data}),/br>$/.test(s)||(s+="<br>")):s+=e.data+"<br>",!e.nextSibling()&&/<br>$/.test(s)&&(s=s.replace(/<br>$/,""));else{s+=e.type=="element"?dtd.$empty[e.tagName]?"":e.innerText():e.data;if(!/br\/?\s*>$/.test(s)){if(!e.nextSibling())return;s+="<br>"}}})}n.execCommand("inserthtml",'<pre id="coder"class="lang-'+t+' toolbar:false">'+s+"</pre>",!0),i=n.document.getElementById("coder"),domUtils.removeAttributes(i,"id");var a=i.previousSibling;a&&(a.nodeType==3&&a.nodeValue.length==1&&browser.ie&&browser.version==6||domUtils.isEmptyBlock(a))&&domUtils.remove(a);var r=n.selection.getRange();domUtils.isEmptyBlock(i)?r.setStart(i,0).setCursor(!1,!0):r.selectNodeContents(i).select()}},queryCommandValue:function(){var e=this.selection.getStartElementPath(),t="";return utils.each(e,function(e){if(e.nodeName=="PRE"){var n=e.className.match(/lang-([^;]+)/);return t=n&&n[1]?n[1]:"",!1}}),t}},e.addInputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(e){var t=e.getNodesByTagName("br");if(t.length){browser.ie&&browser.version>8&&utils.each(t,function(e){var t=UE.uNode.createText("\n");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)});return}if(browser.ie&&browser.version>8)return;var n=e.innerText().split(/\n/);e.innerHTML(""),utils.each(n,function(t){t.length&&e.appendChild(UE.uNode.createText(t)),e.appendChild(UE.uNode.createElement("br"))})})}),e.addOutputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(e){var t="";utils.each(e.children,function(e){e.type=="text"?t+=e.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,""):e.tagName=="br"?t+="\n":t+=dtd.$empty[e.tagName]?e.innerText():""}),e.innerText(t.replace(/(&nbsp;|\n)+$/,""))})}),e.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,highlightcode:1,insertcode:1,inserthtml:1,selectall:1};var t=e.queryCommandState;e.queryCommandState=function(e){var t=this;return!t.notNeedCodeQuery[e.toLowerCase()]&&t.selection&&t.queryCommandValue("insertcode")?-1:UE.Editor.prototype.queryCommandState.apply(this,arguments)},e.addListener("beforeenterkeydown",function(){var t=e.selection.getRange(),n=domUtils.findParentByTagName(t.startContainer,"pre",!0);if(n){e.fireEvent("saveScene"),t.collapsed||t.deleteContents();if(!browser.ie){var r=e.document.createElement("br"),n;t.insertNode(r).setStartAfter(r).collapse(!0);var i=r.nextSibling;i?t.setStartAfter(r):t.insertNode(r.cloneNode(!1)),n=r.previousSibling;var s;while(n){s=n,n=n.previousSibling;if(!n||n.nodeName=="BR"){n=s;break}}if(n){var o="";while(n&&n.nodeName!="BR"&&(new RegExp("^[\\s"+domUtils.fillChar+"]*$")).test(n.nodeValue))o+=n.nodeValue,n=n.nextSibling;if(n.nodeName!="BR"){var u=n.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));u&&u[1]&&(o+=u[1])}o&&(o=e.document.createTextNode(o),t.insertNode(o).setStartAfter(o))}t.collapse(!0).select(!0)}else if(browser.version>8){var a=e.document.createTextNode("\n"),f=t.startContainer;if(t.startOffset==0){var l=f.previousSibling;if(l){t.insertNode(a);var c=e.document.createTextNode(" ");t.setStartAfter(a).insertNode(c).setStart(c,0).collapse(!0).select(!0)}}else{t.insertNode(a).setStartAfter(a);var c=e.document.createTextNode(" ");f=t.startContainer.childNodes[t.startOffset],f&&!/^\n/.test(f.nodeValue)&&t.setStartBefore(a),t.insertNode(c).setStart(c,0).collapse(!0).select(!0)}}else{var r=e.document.createElement("br");t.insertNode(r),t.insertNode(e.document.createTextNode(domUtils.fillChar)),t.setStartAfter(r),n=r.previousSibling;var s;while(n){s=n,n=n.previousSibling;if(!n||n.nodeName=="BR"){n=s;break}}if(n){var o="";while(n&&n.nodeName!="BR"&&(new RegExp("^[ "+domUtils.fillChar+"]*$")).test(n.nodeValue))o+=n.nodeValue,n=n.nextSibling;if(n.nodeName!="BR"){var u=n.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));u&&u[1]&&(o+=u[1])}o=e.document.createTextNode(o),t.insertNode(o).setStartAfter(o)}t.collapse(!0).select()}return e.fireEvent("saveScene"),!0}}),e.addListener("tabkeydown",function(t,n){var r=e.selection.getRange(),i=domUtils.findParentByTagName(r.startContainer,"pre",!0);if(i){e.fireEvent("saveScene");if(!n.shiftKey)if(!r.collapsed){var s=r.createBookmark(),o=s.start.previousSibling;while(o){if(i.firstChild===o&&!domUtils.isBr(o)){i.insertBefore(e.document.createTextNode("    "),o);break}if(domUtils.isBr(o)){i.insertBefore(e.document.createTextNode("    "),o.nextSibling);break}o=o.previousSibling}var u=s.end;o=s.start.nextSibling,i.firstChild===s.start&&i.insertBefore(e.document.createTextNode("    "),o.nextSibling);while(o&&o!==u){if(domUtils.isBr(o)&&o.nextSibling){if(o.nextSibling===u)break;i.insertBefore(e.document.createTextNode("    "),o.nextSibling)}o=o.nextSibling}r.moveToBookmark(s).select()}else{var a=e.document.createTextNode("    ");r.insertNode(a).setStartAfter(a).collapse(!0).select(!0)}return e.fireEvent("saveScene"),!0}}),e.addListener("beforeinserthtml",function(e,t){var n=this,r=n.selection.getRange(),i=domUtils.findParentByTagName(r.startContainer,"pre",!0);if(i){r.collapsed||r.deleteContents();var s="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(t),n.options.filterTxtRules).children,function(e){e.type=="element"?e.tagName=="br"?s+="\n":dtd.$empty[e.tagName]||(utils.each(e.children,function(t){t.type=="element"?t.tagName=="br"?s+="\n":dtd.$empty[e.tagName]||(s+=t.innerText()):s+=t.data}),/\n$/.test(s)||(s+="\n")):s+=e.data+"\n",!e.nextSibling()&&/\n$/.test(s)&&(s=s.replace(/\n$/,""))});var o=n.document.createTextNode(utils.html(s.replace(/&nbsp;/g," ")));r.insertNode(o).selectNode(o).select()}else{var u=n.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(t),n.options.filterTxtRules).children,function(e){e.type=="element"?e.tagName=="br"?u.appendChild(n.document.createElement("br")):dtd.$empty[e.tagName]||(utils.each(e.children,function(t){t.type=="element"?t.tagName=="br"?u.appendChild(n.document.createElement("br")):dtd.$empty[e.tagName]||u.appendChild(n.document.createTextNode(utils.html(t.innerText().replace(/&nbsp;/g," ")))):u.appendChild(n.document.createTextNode(utils.html(t.data.replace(/&nbsp;/g," "))))}),u.lastChild.nodeName!="BR"&&u.appendChild(n.document.createElement("br"))):u.appendChild(n.document.createTextNode(utils.html(e.data.replace(/&nbsp;/g," ")))),!e.nextSibling()&&u.lastChild.nodeName=="BR"&&u.removeChild(u.lastChild)}),r.insertNode(u).select()}return!0}}),e.addListener("keydown",function(e,t){var n=this,r=t.keyCode||t.which;if(r==40){var i=n.selection.getRange(),s,o=i.startContainer;if(i.collapsed&&(s=domUtils.findParentByTagName(i.startContainer,"pre",!0))&&!s.nextSibling){var u=s.lastChild;while(u&&u.nodeName=="BR")u=u.previousSibling;if(u===o||i.startContainer===s&&i.startOffset==s.childNodes.length)n.execCommand("insertparagraph"),domUtils.preventDefault(t)}}}),e.addListener("delkeydown",function(t,n){var r=this.selection.getRange();r.txtToElmBoundary(!0);var i=r.startContainer;if(domUtils.isTagNode(i,"pre")&&r.collapsed&&domUtils.isStartInblock(r)){var s=e.document.createElement("p");return domUtils.fillNode(e.document,s),i.parentNode.insertBefore(s,i),domUtils.remove(i),r.setStart(s,0).setCursor(!1,!0),domUtils.preventDefault(n),!0}})},UE.commands.cleardoc={execCommand:function(e){var t=this,n=t.options.enterTag,r=t.selection.getRange();n=="br"?(t.body.innerHTML="<br/>",r.setStart(t.body,0).setCursor()):(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",r.setStart(t.body.firstChild,0).setCursor(!1,!0)),setTimeout(function(){t.fireEvent("clearDoc")},0)}},UE.plugins.anchor=function(){var e=this;e.ready(function(){utils.cssRule("anchor",".anchorclass{background: url('"+e.options.UEDITOR_HOME_URL+"themes/default/images/anchor.gif') no-repeat scroll left center transparent;border: 1px dotted #0000FF;cursor: auto;display: inline-block;height: 16px;width: 15px;}",e.document)}),e.addOutputRule(function(e){utils.each(e.getNodesByTagName("img"),function(e){var t;if(t=e.getAttr("anchorname"))e.tagName="a",e.setAttr({anchorname:"",name:t,"class":""})})}),e.addInputRule(function(e){utils.each(e.getNodesByTagName("a"),function(e){var t;(t=e.getAttr("name"))&&!e.getAttr("href")&&(e.tagName="img",e.setAttr({anchorname:e.getAttr("name"),"class":"anchorclass"}),e.setAttr("name"))})}),e.commands.anchor={execCommand:function(e,t){var n=this.selection.getRange(),r=n.getClosedNode();if(r&&r.getAttribute("anchorname"))t?r.setAttribute("anchorname",t):(n.setStartBefore(r).setCursor(),domUtils.remove(r));else if(t){var i=this.document.createElement("img");n.collapse(!0),domUtils.setAttributes(i,{anchorname:t,"class":"anchorclass"}),n.insertNode(i).setStartAfter(i).setCursor(!1,!0)}}}},UE.plugins.wordcount=function(){var e=this;e.addListener("contentchange",function(){e.fireEvent("wordcount")});var t;e.addListener("ready",function(){var e=this;domUtils.on(e.body,"keyup",function(n){var r=n.keyCode||n.which,i={16:1,18:1,20:1,37:1,38:1,39:1,40:1};if(r in i)return;clearTimeout(t),t=setTimeout(function(){e.fireEvent("wordcount")},200)})})},UE.plugins.pagebreak=function(){function n(t){if(domUtils.isEmptyBlock(t)){var n=t.firstChild,r;while(n&&n.nodeType==1&&domUtils.isEmptyBlock(n))r=n,n=n.firstChild;!r&&(r=t),domUtils.fillNode(e.document,r)}}function r(e){return e&&e.nodeType==1&&e.tagName=="HR"&&e.className=="pagebreak"}var e=this,t=["td"];e.setOpt("pageBreakTag","_ueditor_page_break_tag_"),e.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",e.document)}),e.addInputRule(function(t){t.traversal(function(t){if(t.type=="text"&&t.data==e.options.pageBreakTag){var n=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t)}})}),e.addOutputRule(function(t){utils.each(t.getNodesByTagName("hr"),function(t){if(t.getAttr("class")=="pagebreak"){var n=UE.uNode.createText(e.options.pageBreakTag);t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t)}})}),e.commands.pagebreak={execCommand:function(){var i=e.selection.getRange(),s=e.document.createElement("hr");domUtils.setAttributes(s,{"class":"pagebreak",noshade:"noshade",size:"5"}),domUtils.unSelectable(s);var o=domUtils.findParentByTagName(i.startContainer,t,!0),u=[],a;if(o)switch(o.tagName){case"TD":a=o.parentNode;if(!a.previousSibling){var f=domUtils.findParentByTagName(a,"table");f.parentNode.insertBefore(s,f),u=domUtils.findParents(s,!0)}else a.parentNode.insertBefore(s,a),u=domUtils.findParents(s);a=u[1],s!==a&&domUtils.breakParent(s,a),e.fireEvent("afteradjusttable",e.document)}else{if(!i.collapsed){i.deleteContents();var l=i.startContainer;while(!domUtils.isBody(l)&&domUtils.isBlockElm(l)&&domUtils.isEmptyNode(l))i.setStartBefore(l).collapse(!0),domUtils.remove(l),l=i.startContainer}i.insertNode(s);var a=s.parentNode,c;while(!domUtils.isBody(a))domUtils.breakParent(s,a),c=s.nextSibling,c&&domUtils.isEmptyBlock(c)&&domUtils.remove(c),a=s.parentNode;c=s.nextSibling;var h=s.previousSibling;r(h)?domUtils.remove(h):h&&n(h);if(!c){var p=e.document.createElement("p");s.parentNode.appendChild(p),domUtils.fillNode(e.document,p),i.setStart(p,0).collapse(!0)}else r(c)?domUtils.remove(c):n(c),i.setEndAfter(s).collapse(!1);i.select(!0)}}}},UE.plugins.wordimage=function(){var e=this,t;e.addInputRule(function(t){utils.each(t.getNodesByTagName("img"),function(t){var n=t.attrs,r=parseInt(n.width)<128||parseInt(n.height)<43,i=e.options,s=i.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";n._src&&n._src.indexOf("file:///")!==-1&&t.setAttr({width:n.width,height:n.height,alt:n.alt,word_img:n._src,src:s,_src:s,style:"background:url("+(r?i.themePath+i.theme+"/images/word.gif":i.langPath+i.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd"})})}),e.commands.wordimage={execCommand:function(){t=domUtils.getElementsByTagName(e.document.body,"img");var n=[];for(var r=0,i;i=t[r++];){var s=i.getAttribute("word_img");s&&n.push(s)}t.length&&(this.word_img=n)},queryCommandState:function(){t=domUtils.getElementsByTagName(e.document.body,"img");for(var n=0,r;r=t[n++];)if(r.getAttribute("word_img"))return 1;return-1}}},UE.plugins.dragdrop=function(){var e=this;e.ready(function(){domUtils.on(this.body,"dragend",function(){var t=e.selection.getRange(),n=t.getClosedNode()||e.selection.getStart();if(n&&n.tagName=="IMG"){var r=n.previousSibling,i;while(i=n.nextSibling){if(i.nodeType!=1||i.tagName!="SPAN"||!!i.firstChild)break;domUtils.remove(i)}(r&&r.nodeType==1&&!domUtils.isEmptyBlock(r)||!r)&&(!i||i&&!domUtils.isEmptyBlock(i))&&(r&&r.tagName=="P"&&!domUtils.isEmptyBlock(r)?(r.appendChild(n),domUtils.moveChild(i,r),domUtils.remove(i)):i&&i.tagName=="P"&&!domUtils.isEmptyBlock(i)&&i.insertBefore(n,i.firstChild),r&&r.tagName=="P"&&domUtils.isEmptyBlock(r)&&domUtils.remove(r),i&&i.tagName=="P"&&domUtils.isEmptyBlock(i)&&domUtils.remove(i),t.selectNode(n).select(),e.fireEvent("saveScene"))}})}),e.addListener("keyup",function(t,n){var r=n.keyCode||n.which;if(r==13){var i=e.selection.getRange(),s;(s=domUtils.findParentByTagName(i.startContainer,"p",!0))&&domUtils.getComputedStyle(s,"text-align")=="center"&&domUtils.removeStyle(s,"text-align")}})},UE.plugins.undo=function(){function u(e,t){if(e.length!=t.length)return 0;for(var n=0,r=e.length;n<r;n++)if(e[n]!=t[n])return 0;return 1}function a(e,t){return e.collapsed!=t.collapsed?0:!u(e.startAddress,t.startAddress)||!u(e.endAddress,t.endAddress)?0:1}function f(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0)return this.restore(0)}this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1)return this.restore(this.index)}this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],n=UE.htmlparser(t.content.replace(i,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(n),e.options.autoClearEmptyNode=o,e.document.body.innerHTML=n.toHtml(),e.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){domUtils.isEmptyNode(t)&&domUtils.fillNode(e.document,t)});try{var r=(new dom.Range(e.document)).moveToAddress(t.address);r.select(s[r.startContainer.nodeName.toLowerCase()])}catch(u){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange(),n=t.createAddress(!1,!0);e.fireEvent("beforegetscene");var r=UE.htmlparser(e.body.innerHTML);e.options.autoClearEmptyNode=!1,e.filterOutputRule(r),e.options.autoClearEmptyNode=o;var i=r.toHtml();return e.fireEvent("aftergetscene"),{address:n,content:i}},this.save=function(t,r){clearTimeout(e);var i=this.getScene(r),s=this.list[this.index];if(s&&s.content==i.content&&(t?1:a(s.address,i.address)))return;this.list=this.list.slice(0,this.index+1),this.list.push(i),this.list.length>n&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update()},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){h=0,p=null}}function l(){this.undoManger.save()}var e,t=this,n=t.options.maxUndoCount||20,r=t.options.maxInputCount||20,i=new RegExp(domUtils.fillChar+"|</hr>","gi"),s={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},o=t.options.autoClearEmptyNode;t.undoManger=new f,t.undoManger.editor=t,t.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),t.addListener("beforeexeccommand",l),t.addListener("afterexeccommand",l),t.addListener("reset",function(e,t){t||this.undoManger.reset()}),t.commands.redo=t.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+(e.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var c={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,p,d=!1;t.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){d=!0}),domUtils.on(this.body,"compositionend",function(){d=!1})}),t.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var v=!0;t.addListener("keydown",function(t,n){var i=this,s=n.keyCode||n.which;if(!c[s]&&!n.ctrlKey&&!n.metaKey&&!n.shiftKey&&!n.altKey){if(d)return;if(!i.selection.getRange().collapsed){i.undoManger.save(!1,!0),v=!1;return}i.undoManger.list.length==0&&i.undoManger.save(!0),clearTimeout(e);function o(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")}e=setTimeout(function(){if(d){var e=setInterval(function(){d||(o(i),clearInterval(e))},300);return}o(i)},200),p=s,h++,h>=r&&o(i)}}),t.addListener("keyup",function(e,t){var n=t.keyCode||t.which;if(!c[n]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(d)return;v||(this.undoManger.save(!1,!0),v=!0)}})},UE.plugins.paste=function(){function e(e){var t=this.document;if(t.getElementById("baidu_pastebin"))return;var n=this.selection.getRange(),r=n.createBookmark(),i=t.createElement("div");i.id="baidu_pastebin",browser.webkit&&i.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar)),t.body.appendChild(i),r.start.style.display="",i.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(r.start).y+"px",n.selectNodeContents(i).select(!0),setTimeout(function(){if(browser.webkit)for(var s=0,o=t.querySelectorAll("#baidu_pastebin"),u;u=o[s++];){if(!domUtils.isEmptyNode(u)){i=u;break}domUtils.remove(u)}try{i.parentNode.removeChild(i)}catch(a){}n.moveToBookmark(r).select(!0),e(i)},0)}function s(e){var s;if(e.firstChild){var o=domUtils.getElementsByTagName(e,"span");for(var u=0,a;a=o[u++];)(a.id=="_baidu_cut_start"||a.id=="_baidu_cut_end")&&domUtils.remove(a);if(browser.webkit){var f=e.querySelectorAll("div br");for(var u=0,l;l=f[u++];){var c=l.parentNode;c.tagName=="DIV"&&c.childNodes.length==1&&(c.innerHTML="<p><br/></p>",domUtils.remove(c))}var h=e.querySelectorAll("#baidu_pastebin");for(var u=0,p;p=h[u++];){var d=t.document.createElement("p");p.parentNode.insertBefore(d,p);while(p.firstChild)d.appendChild(p.firstChild);domUtils.remove(p)}var v=e.querySelectorAll("meta");for(var u=0,m;m=v[u++];)domUtils.remove(m);var f=e.querySelectorAll("br");for(u=0;m=f[u++];)/^apple-/i.test(m.className)&&domUtils.remove(m)}if(browser.gecko){var g=e.querySelectorAll("[_moz_dirty]");for(u=0;m=g[u++];)m.removeAttribute("_moz_dirty")}if(!browser.ie){var y=e.querySelectorAll("span.Apple-style-span");for(var u=0,m;m=y[u++];)domUtils.remove(m,!0)}s=e.innerHTML,s=UE.filterWord(s);var b=UE.htmlparser(s);t.options.filterRules&&UE.filterNode(b,t.options.filterRules),t.filterInputRule(b);if(browser.webkit){var w=b.lastChild();w&&w.type=="element"&&w.tagName=="br"&&b.removeChild(w),utils.each(t.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e)})}s={html:b.toHtml()},t.fireEvent("beforepaste",s,b);if(!s.html)return;b=UE.htmlparser(s.html,!0),t.queryCommandState("pasteplain")===1?t.execCommand("insertHtml"
,UE.filterNode(b,t.options.filterTxtRules).toHtml(),!0):(UE.filterNode(b,t.options.filterTxtRules),n=b.toHtml(),r=s.html,i=t.selection.getRange().createAddress(!0),t.execCommand("insertHtml",r,!0)),t.fireEvent("afterpaste",s)}}var t=this,n,r,i;t.addListener("pasteTransfer",function(e,s){if(i&&n&&r&&n!=r){var o=t.selection.getRange();o.moveToAddress(i,!0);if(!o.collapsed){while(!domUtils.isBody(o.startContainer)){var u=o.startContainer;if(u.nodeType==1){u=u.childNodes[o.startOffset];if(!u){o.setStartBefore(o.startContainer);continue}var a=u.previousSibling;a&&a.nodeType==3&&(new RegExp("^[\n\r	 "+domUtils.fillChar+"]*$")).test(a.nodeValue)&&o.setStartBefore(a)}if(o.startOffset!=0)break;o.setStartBefore(o.startContainer)}while(!domUtils.isBody(o.endContainer)){var f=o.endContainer;if(f.nodeType==1){f=f.childNodes[o.endOffset];if(!f){o.setEndAfter(o.endContainer);continue}var l=f.nextSibling;l&&l.nodeType==3&&(new RegExp("^[\n\r	"+domUtils.fillChar+"]*$")).test(l.nodeValue)&&o.setEndAfter(l)}if(o.endOffset!=o.endContainer[o.endContainer.nodeType==3?"nodeValue":"childNodes"].length)break;o.setEndAfter(o.endContainer)}}o.deleteContents(),o.select(!0),t.__hasEnterExecCommand=!0;var c=r;s===2?c=c.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(e,t,n,r){return n=n.toLowerCase(),{img:1}[n]?e:(r=r.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(e,t,n){return{src:1,href:1,name:1}[t.toLowerCase()]?t+"="+n+" ":""}),{span:1,div:1}[n]?"":"<"+t+n+" "+utils.trim(r)+">")}):s&&(c=n),t.execCommand("inserthtml",c,!0),t.__hasEnterExecCommand=!1;var h=t.selection.getRange();while(!domUtils.isBody(h.startContainer)&&!h.startOffset&&h.startContainer[h.startContainer.nodeType==3?"nodeValue":"childNodes"].length)h.setStartBefore(h.startContainer);var p=h.createAddress(!0);i.endAddress=p.startAddress}}),t.addListener("ready",function(){domUtils.on(t.body,"cut",function(){var e=t.selection.getRange();!e.collapsed&&t.undoManger&&t.undoManger.save()}),domUtils.on(t.body,browser.ie||browser.opera?"keydown":"paste",function(n){if((browser.ie||browser.opera)&&(!n.ctrlKey&&!n.metaKey||n.keyCode!="86"))return;e.call(t,function(e){s(e)})})})},UE.plugins.list=function(){function r(e){var t=[];for(var n in e)t.push(n);return t}function u(e){var t=e.className;return domUtils.hasClass(e,/custom_/)?t.match(/custom_(\w+)/)[1]:domUtils.getStyle(e,"list-style-type")}function a(e,t){utils.each(domUtils.getElementsByTagName(e,"ol ul"),function(r){if(!domUtils.inDoc(r,e))return;var s=r.parentNode;if(s.tagName==r.tagName){var o=u(r)||(r.tagName=="OL"?"decimal":"disc"),a=u(s)||(s.tagName=="OL"?"decimal":"disc");if(o==a){var c=utils.indexOf(i[r.tagName],o);c=c+1==i[r.tagName].length?0:c+1,l(r,i[r.tagName][c])}}var h=0,p=2;if(domUtils.hasClass(r,/custom_/)){if(!/[ou]l/i.test(s.tagName)||!domUtils.hasClass(s,/custom_/))p=1}else/[ou]l/i.test(s.tagName)&&domUtils.hasClass(s,/custom_/)&&(p=3);var d=domUtils.getStyle(r,"list-style-type");d&&(r.style.cssText="list-style-type:"+d),r.className=utils.trim(r.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+p,utils.each(domUtils.getElementsByTagName(r,"li"),function(e){e.style.cssText&&(e.style.cssText="");if(!e.firstChild){domUtils.remove(e);return}if(e.parentNode!==r)return;h++;if(domUtils.hasClass(r,/custom_/)){var t=1,i=u(r);if(r.tagName=="OL"){if(i)switch(i){case"cn":case"cn1":case"cn2":h>10&&(h%10==0||h>10&&h<20)?t=2:h>20&&(t=3);break;case"num2":h>9&&(t=2)}e.className="list-"+n[i]+h+" "+"list-"+i+"-paddingleft-"+t}else e.className="list-"+n[i]+" "+"list-"+i+"-paddingleft"}else e.className=e.className.replace(/list-[\w\-]+/gi,"");var s=e.getAttribute("class");s!==null&&!s.replace(/\s/g,"")&&domUtils.removeAttributes(e,"class")}),!t&&f(r,r.tagName.toLowerCase(),u(r)||domUtils.getStyle(r,"list-style-type"),!0)})}function f(e,t,n,r){var i=e.nextSibling;i&&i.nodeType==1&&i.tagName.toLowerCase()==t&&(u(i)||domUtils.getStyle(i,"list-style-type")||(t=="ol"?"decimal":"disc"))==n&&(domUtils.moveChild(i,e),i.childNodes.length==0&&domUtils.remove(i)),i&&domUtils.isFillChar(i)&&domUtils.remove(i);var s=e.previousSibling;s&&s.nodeType==1&&s.tagName.toLowerCase()==t&&(u(s)||domUtils.getStyle(s,"list-style-type")||(t=="ol"?"decimal":"disc"))==n&&domUtils.moveChild(e,s),s&&domUtils.isFillChar(s)&&domUtils.remove(s),!r&&domUtils.isEmptyBlock(e)&&domUtils.remove(e),u(e)&&a(e.ownerDocument,!0)}function l(e,t){n[t]&&(e.className="custom_"+t);try{domUtils.setStyle(e,"list-style-type",t)}catch(r){}}function c(e){var t=e.previousSibling;t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t),t=e.nextSibling,t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t)}function h(e){while(e&&!domUtils.isBody(e)){if(e.nodeName=="TABLE")return null;if(e.nodeName=="LI")return e;e=e.parentNode}}var e=this,t={TD:1,PRE:1,BLOCKQUOTE:1},n={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};e.setOpt({insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1});var i={OL:r(e.options.insertorderedlist),UL:r(e.options.insertunorderedlist)},s=e.options.listiconpath;for(var o in n)!e.options.insertorderedlist.hasOwnProperty(o)&&!e.options.insertunorderedlist.hasOwnProperty(o)&&delete n[o];e.ready(function(){var t=[];for(var r in n){if(r=="dash"||r=="dot")t.push("li.list-"+n[r]+"{background-image:url("+s+n[r]+".gif)}"),t.push("ul.custom_"+r+"{list-style:none;}ul.custom_"+r+" li{background-position:0 3px;background-repeat:no-repeat}");else{for(var i=0;i<99;i++)t.push("li.list-"+n[r]+i+"{background-image:url("+s+"list-"+n[r]+i+".gif)}");t.push("ol.custom_"+r+"{list-style:none;}ol.custom_"+r+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(r){case"cn":t.push("li.list-"+r+"-paddingleft-1{padding-left:25px}"),t.push("li.list-"+r+"-paddingleft-2{padding-left:40px}"),t.push("li.list-"+r+"-paddingleft-3{padding-left:55px}");break;case"cn1":t.push("li.list-"+r+"-paddingleft-1{padding-left:30px}"),t.push("li.list-"+r+"-paddingleft-2{padding-left:40px}"),t.push("li.list-"+r+"-paddingleft-3{padding-left:55px}");break;case"cn2":t.push("li.list-"+r+"-paddingleft-1{padding-left:40px}"),t.push("li.list-"+r+"-paddingleft-2{padding-left:55px}"),t.push("li.list-"+r+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":t.push("li.list-"+r+"-paddingleft-1{padding-left:25px}");break;case"num2":t.push("li.list-"+r+"-paddingleft-1{padding-left:35px}"),t.push("li.list-"+r+"-paddingleft-2{padding-left:40px}");break;case"dash":t.push("li.list-"+r+"-paddingleft{padding-left:35px}");break;case"dot":t.push("li.list-"+r+"-paddingleft{padding-left:20px}")}}t.push(".list-paddingleft-1{padding-left:0}"),t.push(".list-paddingleft-2{padding-left:"+e.options.listDefaultPaddingLeft+"px}"),t.push(".list-paddingleft-3{padding-left:"+e.options.listDefaultPaddingLeft*2+"px}"),utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+t.join("\n"),e.document)}),e.ready(function(){domUtils.on(e.body,"cut",function(){setTimeout(function(){var t=e.selection.getRange(),n;if(!t.collapsed&&(n=domUtils.findParentByTagName(t.startContainer,"li",!0))&&!n.nextSibling&&domUtils.isEmptyBlock(n)){var r=n.parentNode,i;if(i=r.previousSibling)domUtils.remove(r),t.setStartAtLast(i).collapse(!0),t.select(!0);else if(i=r.nextSibling)domUtils.remove(r),t.setStartAtFirst(i).collapse(!0),t.select(!0);else{var s=e.document.createElement("p");domUtils.fillNode(e.document,s),r.parentNode.insertBefore(s,r),domUtils.remove(r),t.setStart(s,0).collapse(!0),t.select(!0)}}})})}),e.addListener("beforepaste",function(e,t){var r=this,s=r.selection.getRange(),o,a=UE.htmlparser(t.html,!0);if(o=domUtils.findParentByTagName(s.startContainer,"li",!0)){var f=o.parentNode,l=f.tagName=="OL"?"ul":"ol";utils.each(a.getNodesByTagName(l),function(t){t.tagName=f.tagName,t.setAttr();if(t.parentNode===a)e=u(f)||(f.tagName=="OL"?"decimal":"disc");else{var r=t.parentNode.getAttr("class");r&&/custom_/.test(r)?e=r.match(/custom_(\w+)/)[1]:e=t.parentNode.getStyle("list-style-type"),e||(e=f.tagName=="OL"?"decimal":"disc")}var s=utils.indexOf(i[f.tagName],e);t.parentNode!==a&&(s=s+1==i[f.tagName].length?0:s+1);var o=i[f.tagName][s];n[o]?t.setAttr("class","custom_"+o):t.setStyle("list-style-type",o)})}t.html=a.toHtml()}),e.addInputRule(function(t){function s(e,t){var n=t.firstChild();if(n&&n.type=="element"&&n.tagName=="span"&&/Wingdings|Symbol/.test(n.getStyle("font-family"))){for(var s in i)if(i[s]==n.data)return s;return"disc"}for(var s in r)if(r[s].test(e))return s}utils.each(t.getNodesByTagName("li"),function(e){var t=UE.uNode.createElement("p");for(var n=0,r;r=e.children[n];)r.type=="text"||dtd.p[r.tagName]?t.appendChild(r):t.firstChild()?(e.insertBefore(t,r),t=UE.uNode.createElement("p"),n+=2):n++;(t.firstChild()&&!t.parentNode||!e.firstChild())&&e.appendChild(t),t.firstChild()||t.innerHTML(browser.ie?"&nbsp;":"<br/>");var i=e.firstChild(),s=i.lastChild();s&&s.type=="text"&&/^\s*$/.test(s.data)&&i.removeChild(s)});var r={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},i={square:"n"};utils.each(t.getNodesByTagName("p"),function(t){function i(e,t,n){if(e.tagName=="ol")if(browser.ie){var i=t.firstChild();i.type=="element"&&i.tagName=="span"&&r[n].test(i.innerText())&&t.removeChild(i)}else t.innerHTML(t.innerHTML().replace(r[n],""));else t.removeChild(t.firstChild());var s=UE.uNode.createElement("li");s.appendChild(t),e.appendChild(s)}if(t.getAttr("class")!="MsoListParagraph")return;t.setStyle("margin",""),t.setStyle("margin-left",""),t.setAttr("class","");var o=t,u,a=t;if(t.parentNode.tagName!="li"&&(u=s(t.innerText(),t))){var f=UE.uNode.createElement(e.options.insertorderedlist.hasOwnProperty(u)?"ol":"ul");n[u]?f.setAttr("class","custom_"+u):f.setStyle("list-style-type",u);while(t&&t.parentNode.tagName!="li"&&s(t.innerText(),t))o=t.nextSibling(),o||t.parentNode.insertBefore(f,t),i(f,t,u),t=o;!f.parentNode&&t&&t.parentNode&&t.parentNode.insertBefore(f,t)}var l=a.firstChild();l&&l.type=="element"&&l.tagName=="span"&&/^\s*(&nbsp;)+\s*$/.test(l.innerText())&&l.parentNode.removeChild(l)})}),e.addListener("contentchange",function(){a(e.document)}),e.addListener("keydown",function(t,n){function r(){n.preventDefault?n.preventDefault():n.returnValue=!1,e.fireEvent("contentchange"),e.undoManger&&e.undoManger.save()}function i(e,t){while(e&&!domUtils.isBody(e)){if(t(e))return null;if(e.nodeType==1&&/[ou]l/i.test(e.tagName))return e;e=e.parentNode}return null}var s=n.keyCode||n.which;if(s==13&&!n.shiftKey){var o=e.selection.getRange(),u=domUtils.findParent(o.startContainer,function(e){return domUtils.isBlockElm(e)},!0),a=domUtils.findParentByTagName(o.startContainer,"li",!0);if(u&&u.tagName!="PRE"&&!a){var f=u.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");/^\s*1\s*\.[^\d]/.test(f)&&(u.innerHTML=f.replace(/^\s*1\s*\./,""),o.setStartAtLast(u).collapse(!0).select(),e.__hasEnterExecCommand=!0,e.execCommand("insertorderedlist"),e.__hasEnterExecCommand=!1)}var l=e.selection.getRange(),h=i(l.startContainer,function(e){return e.tagName=="TABLE"}),p=l.collapsed?h:i(l.endContainer,function(e){return e.tagName=="TABLE"});if(h&&p&&h===p){if(!l.collapsed){h=domUtils.findParentByTagName(l.startContainer,"li",!0),p=domUtils.findParentByTagName(l.endContainer,"li",!0);if(!h||!p||h!==p){var d=l.cloneRange(),v=d.collapse(!1).createBookmark();l.deleteContents(),d.moveToBookmark(v);var a=domUtils.findParentByTagName(d.startContainer,"li",!0);c(a),d.select(),r();return}l.deleteContents(),a=domUtils.findParentByTagName(l.startContainer,"li",!0);if(a&&domUtils.isEmptyBlock(a)){E=a.previousSibling,next=a.nextSibling,y=e.document.createElement("p"),domUtils.fillNode(e.document,y),m=a.parentNode,E&&next?(l.setStart(next,0).collapse(!0).select(!0),domUtils.remove(a)):(!E&&!next||!E?m.parentNode.insertBefore(y,m):a.parentNode.parentNode.insertBefore(y,m.nextSibling),domUtils.remove(a),m.firstChild||domUtils.remove(m),l.setStart(y,0).setCursor()),r();return}}a=domUtils.findParentByTagName(l.startContainer,"li",!0);if(a){if(domUtils.isEmptyBlock(a)){v=l.createBookmark();var m=a.parentNode;a!==m.lastChild?(domUtils.breakParent(a,m),c(a)):(m.parentNode.insertBefore(a,m.nextSibling),domUtils.isEmptyNode(m)&&domUtils.remove(m));if(!dtd.$list[a.parentNode.tagName])if(!domUtils.isBlockElm(a.firstChild)){y=e.document.createElement("p"),a.parentNode.insertBefore(y,a);while(a.firstChild)y.appendChild(a.firstChild);domUtils.remove(a)}else domUtils.remove(a,!0);l.moveToBookmark(v).select()}else{var g=a.firstChild;if(!g||!domUtils.isBlockElm(g)){var y=e.document.createElement("p");!a.firstChild&&domUtils.fillNode(e.document,y);while(a.firstChild)y.appendChild(a.firstChild);a.appendChild(y),g=y}var b=e.document.createElement("span");l.insertNode(b),domUtils.breakParent(b,a);var w=b.nextSibling;g=w.firstChild,g||(y=e.document.createElement("p"),domUtils.fillNode(e.document,y),w.appendChild(y),g=y),domUtils.isEmptyNode(g)&&(g.innerHTML="",domUtils.fillNode(e.document,g)),l.setStart(g,0).collapse(!0).shrinkBoundary().select(),domUtils.remove(b);var E=w.previousSibling;E&&domUtils.isEmptyBlock(E)&&(E.innerHTML="<p></p>",domUtils.fillNode(e.document,E.firstChild))}r()}}}if(s==8){l=e.selection.getRange();if(l.collapsed&&domUtils.isStartInblock(l)){d=l.cloneRange().trimBoundary(),a=domUtils.findParentByTagName(l.startContainer,"li",!0);if(a&&domUtils.isStartInblock(d)){h=domUtils.findParentByTagName(l.startContainer,"p",!0);if(h&&h!==a.firstChild){var m=domUtils.findParentByTagName(h,["ol","ul"]);domUtils.breakParent(h,m),c(h),e.fireEvent("contentchange"),l.setStart(h,0).setCursor(!1,!0),e.fireEvent("saveScene"),domUtils.preventDefault(n);return}if(a&&(E=a.previousSibling)){if(s==46&&a.childNodes.length)return;dtd.$list[E.tagName]&&(E=E.lastChild),e.undoManger&&e.undoManger.save(),g=a.firstChild;if(domUtils.isBlockElm(g))if(domUtils.isEmptyNode(g)){E.appendChild(g),l.setStart(g,0).setCursor(!1,!0);while(a.firstChild)E.appendChild(a.firstChild)}else b=e.document.createElement("span"),l.insertNode(b),domUtils.isEmptyBlock(E)&&(E.innerHTML=""),domUtils.moveChild(a,E),l.setStartBefore(b).collapse(!0).select(!0),domUtils.remove(b);else if(domUtils.isEmptyNode(a)){var y=e.document.createElement("p");E.appendChild(y),l.setStart(y,0).setCursor()}else{l.setEnd(E,E.childNodes.length).collapse().select(!0);while(a.firstChild)E.appendChild(a.firstChild)}domUtils.remove(a),e.fireEvent("contentchange"),e.fireEvent("saveScene"),domUtils.preventDefault(n);return}if(a&&!a.previousSibling){var m=a.parentNode,v=l.createBookmark();if(domUtils.isTagNode(m.parentNode,"ol ul"))m.parentNode.insertBefore(a,m),domUtils.isEmptyNode(m)&&domUtils.remove(m);else{while(a.firstChild)m.parentNode.insertBefore(a.firstChild,m);domUtils.remove(a),domUtils.isEmptyNode(m)&&domUtils.remove(m)}l.moveToBookmark(v).setCursor(!1,!0),e.fireEvent("contentchange"),e.fireEvent("saveScene"),domUtils.preventDefault(n);return}}}}}),e.addListener("keyup",function(t,n){var r=n.keyCode||n.which;if(r==8){var i=e.selection.getRange(),s;(s=domUtils.findParentByTagName(i.startContainer,["ol","ul"],!0))&&f(s,s.tagName.toLowerCase(),u(s)||domUtils.getComputedStyle(s,"list-style-type"),!0)}}),e.addListener("tabkeydown",function(){function n(t){if(e.options.maxListLevel!=-1){var n=t.parentNode,r=0;while(/[ou]l/i.test(n.tagName))r++,n=n.parentNode;if(r>=e.options.maxListLevel)return!0}}var t=e.selection.getRange(),r=domUtils.findParentByTagName(t.startContainer,"li",!0);if(r){var s;if(!t.collapsed){e.fireEvent("saveScene"),s=t.createBookmark();for(var p=0,d,v=domUtils.findParents(r),m;m=v[p++];)if(domUtils.isTagNode(m,"ol ul")){d=m;break}var g=r;if(s.end)while(g&&!(domUtils.getPosition(g,s.end)&domUtils.POSITION_FOLLOWING)){if(n(g)){g=domUtils.getNextDomNode(g,!1,null,function(e){return e!==d});continue}var o=g.parentNode,a=e.document.createElement(o.tagName),c=utils.indexOf(i[a.tagName],u(o)||domUtils.getComputedStyle(o,"list-style-type")),y=c+1==i[a.tagName].length?0:c+1,h=i[a.tagName][y];l(a,h),o.insertBefore(a,g);while(g&&!(domUtils.getPosition(g,s.end)&domUtils.POSITION_FOLLOWING)){r=g.nextSibling,a.appendChild(g);if(!r||domUtils.isTagNode(r,"ol ul")){if(r){while(r=r.firstChild)if(r.tagName=="LI")break}else r=domUtils.getNextDomNode(g,!1,null,function(e){return e!==d});break}g=r}f(a,a.tagName.toLowerCase(),h),g=r}return e.fireEvent("contentchange"),t.moveToBookmark(s).select(),!0}if(n(r))return!0;var o=r.parentNode,a=e.document.createElement(o.tagName),c=utils.indexOf(i[a.tagName],u(o)||domUtils.getComputedStyle(o,"list-style-type"));c=c+1==i[a.tagName].length?0:c+1;var h=i[a.tagName][c];l(a,h);if(domUtils.isStartInblock(t))return e.fireEvent("saveScene"),s=t.createBookmark(),o.insertBefore(a,r),a.appendChild(r),f(a,a.tagName.toLowerCase(),h),e.fireEvent("contentchange"),t.moveToBookmark(s).select(!0),!0}}),e.commands.insertorderedlist=e.commands.insertunorderedlist={execCommand:function(e,n){n||(n=e.toLowerCase()=="insertorderedlist"?"decimal":"disc");var r=this,i=this.selection.getRange(),s=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},o=e.toLowerCase()=="insertorderedlist"?"ol":"ul",a=r.document.createDocumentFragment();i.adjustmentBoundary().shrinkBoundary();var c=i.createBookmark(!0),p=h(r.document.getElementById(c.start)),d=0,v=h(r.document.getElementById(c.end)),m=0,g,y,b,w;if(p||v){p&&(g=p.parentNode),c.end||(v=p),v&&(y=v.parentNode);if(g===y){while(p!==v){w=p,p=p.nextSibling;if(!domUtils.isBlockElm(w.firstChild)){var E=r.document.createElement("p");while(w.firstChild)E.appendChild(w.firstChild);w.appendChild(E)}a.appendChild(w)}w=r.document.createElement("span"),g.insertBefore(w,v);if(!domUtils.isBlockElm(v.firstChild)){E=r.document.createElement("p");while(v.firstChild)E.appendChild(v.firstChild);v.appendChild(E)}a.appendChild(v),domUtils.breakParent(w,g),domUtils.isEmptyNode(w.previousSibling)&&domUtils.remove(w.previousSibling),domUtils.isEmptyNode(w.nextSibling)&&domUtils.remove(w.nextSibling);var S=u(g)||domUtils.getComputedStyle(g,"list-style-type")||(e.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(g.tagName.toLowerCase()==o&&S==n){for(var x=0,T,N=r.document.createDocumentFragment();T=a.childNodes[x++];)if(domUtils.isTagNode(T,"ol ul"))utils.each(domUtils.getElementsByTagName(T,"li"),function(e){while(e.firstChild)N.appendChild(e.firstChild)});else while(T.firstChild)N.appendChild(T.firstChild);w.parentNode.insertBefore(N,w)}else b=r.document.createElement(o),l(b,n),b.appendChild(a),w.parentNode.insertBefore(b,w);domUtils.remove(w),b&&f(b,o,n),i.moveToBookmark(c).select();return}if(p){while(p){w=p.nextSibling;if(domUtils.isTagNode(p,"ol ul"))a.appendChild(p);else{var C=r.document.createDocumentFragment(),k=0;while(p.firstChild)domUtils.isBlockElm(p.firstChild)&&(k=1),C.appendChild(p.firstChild);if(!k){var L=r.document.createElement("p");L.appendChild(C),a.appendChild(L)}else a.appendChild(C);domUtils.remove(p)}p=w}g.parentNode.insertBefore(a,g.nextSibling),domUtils.isEmptyNode(g)?(i.setStartBefore(g),domUtils.remove(g)):i.setStartAfter(g),d=1}if(v&&domUtils.inDoc(y,r.document)){p=y.firstChild;while(p&&p!==v){w=p.nextSibling;if(domUtils.isTagNode(p,"ol ul"))a.appendChild(p);else{C=r.document.createDocumentFragment(),k=0;while(p.firstChild)domUtils.isBlockElm(p.firstChild)&&(k=1),C.appendChild(p.firstChild);k?a.appendChild(C):(L=r.document.createElement("p"),L.appendChild(C),a.appendChild(L)),domUtils.remove(p)}p=w}var A=domUtils.createElement(r.document,"div",{tmpDiv:1});domUtils.moveChild(v,A),a.appendChild(A),domUtils.remove(v),y.parentNode.insertBefore(a,y),i.setEndBefore(y),domUtils.isEmptyNode(y)&&domUtils.remove(y),m=1}}d||i.setStartBefore(r.document.getElementById(c.start)),c.end&&!m&&i.setEndAfter(r.document.getElementById(c.end)),i.enlarge(!0,function(e){return t[e.tagName]}),a=r.document.createDocumentFragment();var O=i.createBookmark(),M=domUtils.getNextDomNode(O.start,!1,s),_=i.cloneRange(),D,P=domUtils.isBlockElm;while(M&&M!==O.end&&domUtils.getPosition(M,O.end)&domUtils.POSITION_PRECEDING)if(M.nodeType==3||dtd.li[M.tagName]){if(M.nodeType==1&&dtd.$list[M.tagName]){while(M.firstChild)a.appendChild(M.firstChild);D=domUtils.getNextDomNode(M,!1,s),domUtils.remove(M),M=D;continue}D=M,_.setStartBefore(M);while(M&&M!==O.end&&(!P(M)||domUtils.isBookmarkNode(M)))D=M,M=domUtils.getNextDomNode(M,!1,null,function(e){return!t[e.tagName]});M&&P(M)&&(w=domUtils.getNextDomNode(D,!1,s),w&&domUtils.isBookmarkNode(w)&&(M=domUtils.getNextDomNode(w,!1,s),D=w)),_.setEndAfter(D),M=domUtils.getNextDomNode(D,!1,s);var H=i.document.createElement("li");H.appendChild(_.extractContents());if(domUtils.isEmptyNode(H)){var D=i.document.createElement("p");while(H.firstChild)D.appendChild(H.firstChild);H.appendChild(D)}a.appendChild(H)}else M=domUtils.getNextDomNode(M,!0,s);i.moveToBookmark(O).collapse(!0),b=r.document.createElement(o),l(b,n),b.appendChild(a),i.insertNode(b),f(b,o,n);for(var x=0,T,B=domUtils.getElementsByTagName(b,"div");T=B[x++];)T.getAttribute("tmpDiv")&&domUtils.remove(T,!0);i.moveToBookmark(c).select()},queryCommandState:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul",n=this.selection.getStartElementPath();for(var r=0,i;i=n[r++];){if(i.nodeName=="TABLE")return 0;if(t==i.nodeName.toLowerCase())return 1}return 0},queryCommandValue:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul",n=this.selection.getStartElementPath(),r;for(var i=0,s;s=n[i++];){if(s.nodeName=="TABLE"){r=null;break}if(t==s.nodeName.toLowerCase()){r=s;break}}return r?u(r)||domUtils.getComputedStyle(r,"list-style-type"):null}}},function(){var e={textarea:function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;",browser.ie&&browser.version<8&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;browser.ie?(e=n.createTextRange(),e.collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t.onresize=null,n=null,t=null}}},codemirror:function(e,t){var n=window.CodeMirror(t,{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0}),r=n.getWrapperElement();return r.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;',n.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;",n.refresh(),{getCodeMirror:function(){return n},setContent:function(e){n.setValue(e)},getContent:function(){return n.getValue()},select:function(){n.focus()},dispose:function(){t.removeChild(r),r=null,n=null}}}};UE.plugins.source=function(){function s(r){return e[n.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](t,r)}var t=this,n=this.options,r=!1,i;n.sourceEditor=browser.ie?"textarea":n.sourceEditor||"codemirror",t.setOpt({sourceEditorFirst:!1});var o,u=t.getContent,a;t.commands.source={execCommand:function(){r=!r;if(r){a=t.selection.getRange().createAddress(!1,!0),t.undoManger&&t.undoManger.save(!0),browser.gecko&&(t.body.contentEditable=!1),o=t.iframe.style.cssText,t.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;",t.fireEvent("beforegetcontent");var e=UE.htmlparser(t.body.innerHTML);t.filterOutputRule(e),e.traversal(function(e){if(e.type=="element")switch(e.tagName){case"td":case"th":case"caption":e.children&&e.children.length==1&&e.firstChild().tagName=="br"&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),t.fireEvent("aftergetcontent");var n=e.toHtml(!0);i=s(t.iframe.parentNode),i.setContent(n),setTimeout(function(){i.select(),t.addListener("fullscreenchanged",function(){try{i.getCodeMirror().refresh()}catch(e){}})}),t.getContent=function(){return i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{t.iframe.style.cssText=o;var f=i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";f=f.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),t.setContent(f),i.dispose(),i=null,t.getContent=u;var l=t.body.firstChild;l||(t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",l=t.body.firstChild),t.undoManger&&t.undoManger.save(!0);if(browser.gecko){var c=document.createElement("input");c.style.cssText="position:absolute;left:0;top:-32768px",document.body.appendChild(c),t.body.contentEditable=!1,setTimeout(function(){domUtils.setViewportOffset(c,{left:-32768,top:0}),c.focus(),setTimeout(function(){t.body.contentEditable=!0,t.selection.getRange().moveToAddress(a).select(!0),domUtils.remove(c)})})}else try{t.selection.getRange().moveToAddress(a).select(!0)}catch(h){}}this.fireEvent("sourcemodechanged",r)},queryCommandState:function(){return r|0},notNeedUndo:1};var f=t.queryCommandState;t.queryCommandState=function(e){return e=e.toLowerCase(),r?e in{source:1,fullscreen:1}?1:-1:f.apply(this,arguments)},n.sourceEditor=="codemirror"&&t.addListener("ready",function(){utils.loadFile(document,{src:n.codeMirrorJsUrl||n.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){n.sourceEditorFirst&&setTimeout(function(){t.execCommand("source")},0)}),utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:n.codeMirrorCssUrl||n.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}(),UE.plugins.enterkey=function(){var e,t=this,n=t.options.enterTag;t.addListener("keyup",function(n,r){var i=r.keyCode||r.which;if(i==13){var s=t.selection.getRange(),o=s.startContainer,u;if(!browser.ie){if(/h\d/i.test(e)){if(browser.gecko){var a=domUtils.findParentByTagName(o,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);a||(t.document.execCommand("formatBlock",!1,"<p>"),u=1)}else if(o.nodeType==1){var f=t.document.createTextNode(""),l;s.insertNode(f),l=domUtils.findParentByTagName(f,"div",!0);if(l){var c=t.document.createElement("p");while(l.firstChild)c.appendChild(l.firstChild);l.parentNode.insertBefore(c,l),domUtils.remove(l),s.setStartBefore(f).setCursor(),u=1}domUtils.remove(f)}t.undoManger&&u&&t.undoManger.save()}browser.opera&&s.select()}else t.fireEvent("saveScene",!0,!0)}}),t.addListener("keydown",function(r,i){var s=i.keyCode||i.which;if(s==13){if(t.fireEvent("beforeenterkeydown")){domUtils.preventDefault(i);return}t.fireEvent("saveScene",!0,!0),e="";var o=t.selection.getRange();if(!o.collapsed){var u=o.startContainer,a=o.endContainer,f=domUtils.findParentByTagName(u,"td",!0),l=domUtils.findParentByTagName(a,"td",!0);if(f&&l&&f!==l||!f&&l||f&&!l){i.preventDefault?i.preventDefault():i.returnValue=!1;return}}if(n=="p")browser.ie||(u=domUtils.findParentByTagName(o.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),!u&&!browser.opera?(t.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(o=t.selection.getRange(),u=domUtils.findParentByTagName(o.startContainer,"p",!0),u&&domUtils.removeDirtyAttr(u))):(e=u.tagName,u.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(u)));else{i.preventDefault?i.preventDefault():i.returnValue=!1;if(!o.collapsed){o.deleteContents(),u=o.startContainer;if(u.nodeType==1&&(u=u.childNodes[o.startOffset])){while(u.nodeType==1){if(dtd.$empty[u.tagName])return o.setStartBefore(u).setCursor(),t.undoManger&&t.undoManger.save(),!1;if(!u.firstChild){var c=o.document.createElement("br");return u.appendChild(c),o.setStart(u,0).setCursor(),t.undoManger&&t.undoManger.save(),!1}u=u.firstChild}u===o.startContainer.childNodes[o.startOffset]?(c=o.document.createElement("br"),o.insertNode(c).setCursor()):o.setStart(u,0).setCursor()}else c=o.document.createElement("br"),o.insertNode(c).setStartAfter(c).setCursor()}else{c=o.document.createElement("br"),o.insertNode(c);var h=c.parentNode;h.lastChild===c?(c.parentNode.insertBefore(c.cloneNode(!0),c),o.setStartBefore(c)):o.setStartAfter(c),o.setCursor()}}}})},UE.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(n,r){var i=r.keyCode||r.which,s=e.selection.getRange();if(!s.collapsed&&!(r.ctrlKey||r.shiftKey||r.altKey||r.metaKey)&&(i>=65&&i<=90||i>=48&&i<=57||i>=96&&i<=111||{13:1,8:1,46:1}[i])){var o=s.startContainer;domUtils.isFillChar(o)&&s.setStartBefore(o),o=s.endContainer,domUtils.isFillChar(o)&&s.setEndAfter(o),s.txtToElmBoundary(),s.endContainer&&s.endContainer.nodeType==1&&(o=s.endContainer.childNodes[s.endOffset],o&&domUtils.isBr(o)&&s.setEndAfter(o));if(s.startOffset==0){o=s.startContainer;if(domUtils.isBoundaryNode(o,"firstChild")){o=s.endContainer;if(s.endOffset==(o.nodeType==3?o.nodeValue.length:o.childNodes.length)&&domUtils.isBoundaryNode(o,"lastChild")){e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",s.setStart(e.body.firstChild,0).setCursor(!1,!0),e._selectionChange();return}}}}if(i==8){s=e.selection.getRange(),t=s.collapsed;if(e.fireEvent("delkeydown",r))return;var u,a;s.collapsed&&s.inFillChar()&&(u=s.startContainer,domUtils.isFillChar(u)?(s.setStartBefore(u).shrinkBoundary(!0).collapse(!0),domUtils.remove(u)):(u.nodeValue=u.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),s.startOffset--,s.collapse(!0).select(!0)));if(u=s.getClosedNode()){e.fireEvent("saveScene"),s.setStartBefore(u),domUtils.remove(u),s.setCursor(),e.fireEvent("saveScene"),domUtils.preventDefault(r);return}if(!browser.ie){u=domUtils.findParentByTagName(s.startContainer,"table",!0),a=domUtils.findParentByTagName(s.endContainer,"table",!0);if(u&&!a||!u&&a||u!==a){r.preventDefault();return}}}if(i==9){var f={ol:1,ul:1,table:1};if(e.fireEvent("tabkeydown",r)){domUtils.preventDefault(r);return}var l=e.selection.getRange();e.fireEvent("saveScene");for(var c=0,h="",p=e.options.tabSize||4,d=e.options.tabNode||"&nbsp;";c<p;c++)h+=d;var v=e.document.createElement("span");v.innerHTML=h+domUtils.fillChar;if(l.collapsed)l.insertNode(v.cloneNode(!0).firstChild).setCursor(!0);else{u=domUtils.findParent(l.startContainer,g),a=domUtils.findParent(l.endContainer,g);if(u&&a&&u===a)l.deleteContents(),l.insertNode(v.cloneNode(!0).firstChild).setCursor(!0);else{var m=l.createBookmark(),g=function(e){return domUtils.isBlockElm(e)&&!f[e.tagName.toLowerCase()]};l.enlarge(!0);var y=l.createBookmark(),b=domUtils.getNextDomNode(y.start,!1,g);while(b&&!(domUtils.getPosition(b,y.end)&domUtils.POSITION_FOLLOWING))b.insertBefore(v.cloneNode(!0).firstChild,b.firstChild),b=domUtils.getNextDomNode(b,!1,g);l.moveToBookmark(y).moveToBookmark(m).select()}}domUtils.preventDefault(r)}if(browser.gecko&&i==46){l=e.selection.getRange();if(l.collapsed){u=l.startContainer;if(domUtils.isEmptyBlock(u)){var w=u.parentNode;while(domUtils.getChildCount(w)==1&&!domUtils.isBody(w))u=w,w=w.parentNode;u===w.lastChild&&r.preventDefault();return}}}}),e.addListener("keyup",function(e,n){var r=n.keyCode||n.which,i,s=this;if(r==8){if(s.fireEvent("delkeyup"))return;i=s.selection.getRange();if(i.collapsed){var o,u=["h1","h2","h3","h4","h5","h6"];if(o=domUtils.findParentByTagName(i.startContainer,u,!0))if(domUtils.isEmptyBlock(o)){var a=o.previousSibling;if(a&&a.nodeName!="TABLE"){domUtils.remove(o),i.setStartAtLast(a).setCursor(!1,!0);return}var f=o.nextSibling;if(f&&f.nodeName!="TABLE"){domUtils.remove(o),i.setStartAtFirst(f).setCursor(!1,!0);return}}if(domUtils.isBody(i.startContainer)){var o=domUtils.createElement(s.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});i.insertNode(o).setStart(o,0).setCursor(!1,!0)}}if(!t&&(i.startContainer.nodeType==3||i.startContainer.nodeType==1&&domUtils.isEmptyBlock(i.startContainer)))if(browser.ie){var l=i.document.createElement("span");i.insertNode(l).setStartBefore(l).collapse(!0),i.select(),domUtils.remove(l)}else i.select()}})},UE.plugins.fiximgclick=function(){var e=this;browser.webkit&&e.addListener("click",function(t,n){if(n.target.tagName=="IMG"){var r=new dom.Range(e.document);r.selectNode(n.target).select()}})},UE.plugins.autolink=function(){var e=0;if(browser.ie)return;var t=this;t.addListener("reset",function(){e=0}),t.
addListener("keydown",function(e,n){var r=n.keyCode||n.which;if(r==32||r==13){var i=t.selection.getNative(),s=i.getRangeAt(0).cloneRange(),o,u,a=s.startContainer;while(a.nodeType==1&&s.startOffset>0){a=s.startContainer.childNodes[s.startOffset-1];if(!a)break;s.setStart(a,a.nodeType==1?a.childNodes.length:a.nodeValue.length),s.collapse(!0),a=s.startContainer}do{if(s.startOffset==0){a=s.startContainer.previousSibling;while(a&&a.nodeType==1)a=a.lastChild;if(!a||domUtils.isFillChar(a))break;o=a.nodeValue.length}else a=s.startContainer,o=s.startOffset;s.setStart(a,o-1),u=s.toString().charCodeAt(0)}while(u!=160&&u!=32);if(s.toString().replace(new RegExp(domUtils.fillChar,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){while(s.toString().length){if(/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(s.toString()))break;try{s.setStart(s.startContainer,s.startOffset+1)}catch(f){var a=s.startContainer;while(!(next=a.nextSibling)){if(domUtils.isBody(a))return;a=a.parentNode}s.setStart(next,0)}}if(domUtils.findParentByTagName(s.startContainer,"a",!0))return;var l=t.document.createElement("a"),c=t.document.createTextNode(" "),h;t.undoManger&&t.undoManger.save(),l.appendChild(s.extractContents()),l.href=l.innerHTML=l.innerHTML.replace(/<[^>]+>/g,""),h=l.getAttribute("href").replace(new RegExp(domUtils.fillChar,"g"),""),h=/^(?:https?:\/\/)/ig.test(h)?h:"http://"+h,l.setAttribute("_src",utils.html(h)),l.href=utils.html(h),s.insertNode(l),l.parentNode.insertBefore(c,l.nextSibling),s.setStart(c,0),s.collapse(!0),i.removeAllRanges(),i.addRange(s),t.undoManger&&t.undoManger.save()}}})},UE.plugins.autoheight=function(){function a(){var e=this;clearTimeout(u);if(f)return;u=setTimeout(function(){if(!e.queryCommandState||e.queryCommandState&&e.queryCommandState("source")!=1)n||(n=e.document.createElement("span"),n.style.cssText="display:block;width:0;margin:0;padding:0;border:0;clear:both;",n.innerHTML="."),r=n.cloneNode(!0),e.body.appendChild(r),o=Math.max(domUtils.getXY(r).y+r.offsetHeight,Math.max(s.minFrameHeight,s.initialFrameHeight)),o!=i&&(e.setHeight(o,!0),i=o),domUtils.remove(r)},50)}var e=this;e.autoHeightEnabled=e.options.autoHeightEnabled!==!1;if(!e.autoHeightEnabled)return;var t,n,r,i=0,s=e.options,o,u,f;e.addListener("fullscreenchanged",function(e,t){f=t}),e.addListener("destroy",function(){e.removeListener("contentchange afterinserthtml keyup mouseup",a)}),e.enableAutoHeight=function(){var e=this;if(!e.autoHeightEnabled)return;var n=e.document;e.autoHeightEnabled=!0,t=n.body.style.overflowY,n.body.style.overflowY="hidden",e.addListener("contentchange afterinserthtml keyup mouseup",a),setTimeout(function(){a.call(e)},browser.gecko?100:0),e.fireEvent("autoheightchanged",e.autoHeightEnabled)},e.disableAutoHeight=function(){e.body.style.overflowY=t||"",e.removeListener("contentchange",a),e.removeListener("keyup",a),e.removeListener("mouseup",a),e.autoHeightEnabled=!1,e.fireEvent("autoheightchanged",e.autoHeightEnabled)},e.addListener("ready",function(){e.enableAutoHeight();var t;domUtils.on(browser.ie?e.body:e.document,browser.webkit?"dragover":"drop",function(){clearTimeout(t),t=setTimeout(function(){a.call(this)},100)})})},UE.plugins.autofloat=function(){function u(){return UE.ui?1:(alert(t.autofloatMsg),0)}function a(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function v(){var t=domUtils.getXY(c),n=domUtils.getComputedStyle(c,"position"),i=domUtils.getComputedStyle(c,"left");c.style.width=c.offsetWidth+"px",c.style.zIndex=e.options.zIndex*1+1,c.parentNode.insertBefore(l,c),s||o&&browser.ie?(c.style.position!="absolute"&&(c.style.position="absolute"),c.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-h+r+"px"):(browser.ie7Compat&&d&&(d=!1,c.style.left=domUtils.getXY(c).x-document.documentElement.getBoundingClientRect().left+2+"px"),c.style.position!="fixed"&&(c.style.position="fixed",c.style.top=r+"px",(n=="absolute"||n=="relative")&&parseFloat(i)&&(c.style.left=t.x+"px")))}function m(){d=!0,l.parentNode&&l.parentNode.removeChild(l),c.style.cssText=f}function g(){var t=p(e.container),n=e.options.toolbarTopOffset||0;t.top<0&&t.bottom-c.offsetHeight>n?v():m()}var e=this,t=e.getLang();e.setOpt({topOffset:0});var n=e.options.autoFloatEnabled!==!1,r=e.options.topOffset;if(!n)return;var i=UE.ui.uiUtils,s=browser.ie&&browser.version<=6,o=browser.quirks,f,l=document.createElement("div"),c,h,p,d=!0,y=utils.defer(function(){g()},browser.ie?200:100,!0);e.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],g),e.removeListener("keydown",y)}),e.addListener("ready",function(){u(e)&&(p=i.getClientRect,c=e.ui.getDom("toolbarbox"),h=p(c).top,f=c.style.cssText,l.style.height=c.offsetHeight+"px",s&&a(),domUtils.on(window,["scroll","resize"],g),e.addListener("keydown",y),e.addListener("beforefullscreenchange",function(e,t){t&&m()}),e.addListener("fullscreenchanged",function(e,t){t||g()}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){g()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){g()},0)}))})},UE.plugins.pasteplain=function(){var e=this;e.setOpt({pasteplain:!1,filterTxtRules:function(){function e(e){e.tagName="p",e.setStyle()}function t(e){e.parentNode.removeChild(e,!0)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(e){var t,n=UE.uNode.createElement("p");while(t=e.firstChild())t.type=="text"||!UE.dom.dtd.$block[t.tagName]?n.appendChild(t):n.firstChild()?(e.parentNode.insertBefore(n,e),n=UE.uNode.createElement("p")):e.parentNode.insertBefore(t,e);n.firstChild()&&e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e)},ol:t,ul:t,dl:t,dt:t,dd:t,li:t,caption:e,th:e,tr:e,h1:e,h2:e,h3:e,h4:e,h5:e,h6:e,td:function(e){var t=!!e.innerText();t&&e.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),e),e.parentNode.removeChild(e,e.innerText())}}}()});var t=e.options.pasteplain;e.commands.pasteplain={queryCommandState:function(){return t?1:0},execCommand:function(){t=!t|0},notNeedUndo:1}},UE.plugins.video=function(){function n(t,n,r,i,s,o){return o?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+n+'" height="'+r+'"'+(s?' style="float:'+s+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(i?'id="'+i+'"':"")+' width="'+n+'" height="'+r+'" _url="'+t+'" class="edui-faked-video"'+' src="'+e.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+e.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(s?"float:"+s+";":"")+'" />'}function r(e,t){utils.each(e.getNodesByTagName(t?"img":"embed"),function(e){if(e.getAttr("class")=="edui-faked-video"){var r=n(t?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",t);e.parentNode.replaceChild(UE.uNode.createElement(r),e)}})}var e=this,t;e.addOutputRule(function(e){r(e,!0)}),e.addInputRule(function(e){r(e)}),e.commands.insertvideo={execCommand:function(t,r){r=utils.isArray(r)?r:[r];var i=[],s="tmpVedio";for(var o=0,u,a=r.length;o<a;o++)u=r[o],i.push(n(u.url,u.width||420,u.height||280,s+o,null,!1));e.execCommand("inserthtml",i.join(""),!0);var f=this.selection.getRange();for(var o=0,a=r.length;o<a;o++){var l=this.document.getElementById("tmpVedio"+o);domUtils.removeAttributes(l,"id"),f.selectNode(l).select(),e.execCommand("imagefloat",r[o].align)}},queryCommandState:function(){var t=e.selection.getRange().getClosedNode(),n=t&&t.className=="edui-faked-video";return n?1:0}}},function(){function t(e){}var e=UE.UETable=function(e){this.table=e,this.indexTable=[],this.selectedTds=[],this.cellsRange={},this.update(e)};e.removeSelectedClass=function(e){utils.each(e,function(e){domUtils.removeClasses(e,"selectTdClass")})},e.addSelectedClass=function(e){utils.each(e,function(e){domUtils.addClass(e,"selectTdClass")})},e.isEmptyBlock=function(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(dtd.$isNotEmpty.hasOwnProperty(n)&&e.getElementsByTagName(n).length)return 0;return 1},e.getWidth=function(e){return e?parseInt(domUtils.getComputedStyle(e,"width"),10):0},e.getTableCellAlignState=function(e){!utils.isArray(e)&&(e=[e]);var t={},n=["align","valign"],r=null,i=!0;return utils.each(e,function(e){return utils.each(n,function(n){r=e.getAttribute(n);if(!t[n]&&r)t[n]=r;else if(!t[n]||r!==t[n])return i=!1,!1}),i}),i?t:null},e.getTableItemsByRange=function(e){var t=e.selection.getStart();t&&t.id&&t.id.indexOf("_baidu_bookmark_start_")===0&&(t=t.nextSibling);var n=t&&domUtils.findParentByTagName(t,["td","th"],!0),r=n&&n.parentNode,i=t&&domUtils.findParentByTagName(t,"caption",!0),s=i?i.parentNode:r&&r.parentNode.parentNode;return{cell:n,tr:r,table:s,caption:i}},e.getUETableBySelected=function(t){var n=e.getTableItemsByRange(t).table;return n&&n.ueTable&&n.ueTable.selectedTds.length?n.ueTable:null},e.getDefaultValue=function(e,t){var n={thin:"0px",medium:"1px",thick:"2px"},r,i,s,o;if(!t){t=e.document.createElement("table"),t.insertRow(0).insertCell(0).innerHTML="xxx",e.body.appendChild(t);var u=t.getElementsByTagName("td")[0];return o=domUtils.getComputedStyle(t,"border-left-width"),r=parseInt(n[o]||o,10),o=domUtils.getComputedStyle(u,"padding-left"),i=parseInt(n[o]||o,10),o=domUtils.getComputedStyle(u,"border-left-width"),s=parseInt(n[o]||o,10),domUtils.remove(t),{tableBorder:r,tdPadding:i,tdBorder:s}}return u=t.getElementsByTagName("td")[0],o=domUtils.getComputedStyle(t,"border-left-width"),r=parseInt(n[o]||o,10),o=domUtils.getComputedStyle(u,"padding-left"),i=parseInt(n[o]||o,10),o=domUtils.getComputedStyle(u,"border-left-width"),s=parseInt(n[o]||o,10),{tableBorder:r,tdPadding:i,tdBorder:s}},e.getUETable=function(t){var n=t.tagName.toLowerCase();return t=n=="td"||n=="th"||n=="caption"?domUtils.findParentByTagName(t,"table",!0):t,t.ueTable||(t.ueTable=new e(t)),t.ueTable},e.cloneCell=function(e,t,n){if(!e||utils.isString(e))return this.table.ownerDocument.createElement(e||"td");var r=domUtils.hasClass(e,"selectTdClass");r&&domUtils.removeClasses(e,"selectTdClass");var i=e.cloneNode(!0);return t&&(i.rowSpan=i.colSpan=1),!n&&domUtils.removeAttributes(i,"width height"),!n&&domUtils.removeAttributes(i,"style"),i.style.borderLeftStyle="",i.style.borderTopStyle="",i.style.borderLeftColor=e.style.borderRightColor,i.style.borderLeftWidth=e.style.borderRightWidth,i.style.borderTopColor=e.style.borderBottomColor,i.style.borderTopWidth=e.style.borderBottomWidth,r&&domUtils.addClass(e,"selectTdClass"),i},e.prototype={getMaxRows:function(){var e=this.table.rows,t=1;for(var n=0,r;r=e[n];n++){var i=1;for(var s=0,o;o=r.cells[s++];)i=Math.max(o.rowSpan||1,i);t=Math.max(i+n,t)}return t},getMaxCols:function(){var e=this.table.rows,t=0,n={};for(var r=0,i;i=e[r];r++){var s=0;for(var o=0,u;u=i.cells[o++];){s+=u.colSpan||1;if(u.rowSpan&&u.rowSpan>1)for(var a=1;a<u.rowSpan;a++)n["row_"+(r+a)]?n["row_"+(r+a)]++:n["row_"+(r+a)]=u.colSpan||1}s+=n["row_"+r]||0,t=Math.max(s,t)}return t},getCellColIndex:function(e){},getHSideCell:function(e,n){try{var r=this.getCellInfo(e),i,s,o=this.selectedTds.length,u=this.cellsRange;return!n&&(o?!u.beginColIndex:!r.colIndex)||n&&(o?u.endColIndex==this.colsNum-1:r.colIndex==this.colsNum-1)?null:(i=o?u.beginRowIndex:r.rowIndex,s=n?o?u.endColIndex+1:r.colIndex+1:o?u.beginColIndex-1:r.colIndex<1?0:r.colIndex-1,this.getCell(this.indexTable[i][s].rowIndex,this.indexTable[i][s].cellIndex))}catch(a){t(a)}},getTabNextCell:function(e,t){var n=this.getCellInfo(e),r=t||n.rowIndex,i=n.colIndex+1+(n.colSpan-1),s;try{s=this.getCell(this.indexTable[r][i].rowIndex,this.indexTable[r][i].cellIndex)}catch(o){try{r=r*1+1,i=0,s=this.getCell(this.indexTable[r][i].rowIndex,this.indexTable[r][i].cellIndex)}catch(o){}}return s},getVSideCell:function(e,n,r){try{var i=this.getCellInfo(e),s,o,u=this.selectedTds.length&&!r,a=this.cellsRange;return!n&&i.rowIndex==0||n&&(u?a.endRowIndex==this.rowsNum-1:i.rowIndex+i.rowSpan>this.rowsNum-1)?null:(s=n?u?a.endRowIndex+1:i.rowIndex+i.rowSpan:u?a.beginRowIndex-1:i.rowIndex-1,o=u?a.beginColIndex:i.colIndex,this.getCell(this.indexTable[s][o].rowIndex,this.indexTable[s][o].cellIndex))}catch(f){t(f)}},getSameEndPosCells:function(e,n){try{var r=n.toLowerCase()==="x",i=domUtils.getXY(e)[r?"x":"y"]+e["offset"+(r?"Width":"Height")],s=this.table.rows,o=null,u=[];for(var a=0;a<this.rowsNum;a++){o=s[a].cells;for(var f=0,l;l=o[f++];){var c=domUtils.getXY(l)[r?"x":"y"]+l["offset"+(r?"Width":"Height")];if(c>i&&r)break;if(e==l||i==c){l[r?"colSpan":"rowSpan"]==1&&u.push(l);if(r)break}}}return u}catch(h){t(h)}},setCellContent:function(e,t){e.innerHTML=t||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:e.cloneCell,getSameStartPosXCells:function(e){try{var n=domUtils.getXY(e).x+e.offsetWidth,r=this.table.rows,i,s=[];for(var o=0;o<this.rowsNum;o++){i=r[o].cells;for(var u=0,a;a=i[u++];){var f=domUtils.getXY(a).x;if(f>n)break;if(f==n&&a.colSpan==1){s.push(a);break}}}return s}catch(l){t(l)}},update:function(e){this.table=e||this.table,this.selectedTds=[],this.cellsRange={},this.indexTable=[];var t=this.table.rows,n=this.getMaxRows(),r=n-t.length,i=this.getMaxCols();while(r--)this.table.insertRow(t.length);this.rowsNum=n,this.colsNum=i;for(var s=0,o=t.length;s<o;s++)this.indexTable[s]=new Array(i);for(var u=0,a;a=t[u];u++)for(var f=0,l,c=a.cells;l=c[f];f++){l.rowSpan>n&&(l.rowSpan=n);var h=f,p=l.rowSpan||1,d=l.colSpan||1;while(this.indexTable[u][h])h++;for(var v=0;v<p;v++)for(var m=0;m<d;m++)this.indexTable[u+v][h+m]={rowIndex:u,cellIndex:f,colIndex:h,rowSpan:p,colSpan:d}}for(v=0;v<n;v++)for(m=0;m<i;m++)this.indexTable[v][m]===undefined&&(a=t[v],l=a.cells[a.cells.length-1],l=l?l.cloneNode(!0):this.table.ownerDocument.createElement("td"),this.setCellContent(l),l.colSpan!==1&&(l.colSpan=1),l.rowSpan!==1&&(l.rowSpan=1),a.appendChild(l),this.indexTable[v][m]={rowIndex:v,cellIndex:l.cellIndex,colIndex:m,rowSpan:1,colSpan:1});var g=domUtils.getElementsByTagName(this.table,"td"),y=[];utils.each(g,function(e){domUtils.hasClass(e,"selectTdClass")&&y.push(e)});if(y.length){var b=y[0],w=y[y.length-1],E=this.getCellInfo(b),S=this.getCellInfo(w);this.selectedTds=y,this.cellsRange={beginRowIndex:E.rowIndex,beginColIndex:E.colIndex,endRowIndex:S.rowIndex+S.rowSpan-1,endColIndex:S.colIndex+S.colSpan-1}}},getCellInfo:function(e){if(!e)return;var t=e.cellIndex,n=e.parentNode.rowIndex,r=this.indexTable[n],i=this.colsNum;for(var s=t;s<i;s++){var o=r[s];if(o.rowIndex===n&&o.cellIndex===t)return o}},getCell:function(e,t){return e<this.rowsNum&&this.table.rows[e].cells[t]||null},deleteCell:function(e,t){t=typeof t=="number"?t:e.parentNode.rowIndex;var n=this.table.rows[t];n.deleteCell(e.cellIndex)},getCellsRange:function(e,t){function n(e,t,i,s){var o=e,u=t,a=i,f=s,l,c,h;if(e>0)for(c=t;c<s;c++)l=r.indexTable[e][c],h=l.rowIndex,h<e&&(o=Math.min(h,o));if(s<r.colsNum)for(h=e;h<i;h++)l=r.indexTable[h][s],c=l.colIndex+l.colSpan-1,c>s&&(f=Math.max(c,f));if(i<r.rowsNum)for(c=t;c<s;c++)l=r.indexTable[i][c],h=l.rowIndex+l.rowSpan-1,h>i&&(a=Math.max(h,a));if(t>0)for(h=e;h<i;h++)l=r.indexTable[h][t],c=l.colIndex,c<t&&(u=Math.min(l.colIndex,u));return o!=e||u!=t||a!=i||f!=s?n(o,u,a,f):{beginRowIndex:e,beginColIndex:t,endRowIndex:i,endColIndex:s}}try{var r=this,i=r.getCellInfo(e);if(e===t)return{beginRowIndex:i.rowIndex,beginColIndex:i.colIndex,endRowIndex:i.rowIndex+i.rowSpan-1,endColIndex:i.colIndex+i.colSpan-1};var s=r.getCellInfo(t),o=Math.min(i.rowIndex,s.rowIndex),u=Math.min(i.colIndex,s.colIndex),a=Math.max(i.rowIndex+i.rowSpan-1,s.rowIndex+s.rowSpan-1),f=Math.max(i.colIndex+i.colSpan-1,s.colIndex+s.colSpan-1);return n(o,u,a,f)}catch(l){}},getCells:function(e){this.clearSelected();var t=e.beginRowIndex,n=e.beginColIndex,r=e.endRowIndex,i=e.endColIndex,s,o,u,a={},f=[];for(var l=t;l<=r;l++)for(var c=n;c<=i;c++){s=this.indexTable[l][c],o=s.rowIndex,u=s.colIndex;var h=o+"|"+u;if(a[h])continue;a[h]=1;if(o<l||u<c||o+s.rowSpan-1>r||u+s.colSpan-1>i)return null;f.push(this.getCell(o,s.cellIndex))}return f},clearSelected:function(){e.removeSelectedClass(this.selectedTds),this.selectedTds=[],this.cellsRange={}},setSelected:function(t){var n=this.getCells(t);e.addSelectedClass(n),this.selectedTds=n,this.cellsRange=t},isFullRow:function(){var e=this.cellsRange;return e.endColIndex-e.beginColIndex+1==this.colsNum},isFullCol:function(){var e=this.cellsRange,t=this.table,n=t.getElementsByTagName("th"),r=e.endRowIndex-e.beginRowIndex+1;return n.length?r==this.rowsNum||r==this.rowsNum-1:r==this.rowsNum},getNextCell:function(e,n,r){try{var i=this.getCellInfo(e),s,o,u=this.selectedTds.length&&!r,a=this.cellsRange;return!n&&i.rowIndex==0||n&&(u?a.endRowIndex==this.rowsNum-1:i.rowIndex+i.rowSpan>this.rowsNum-1)?null:(s=n?u?a.endRowIndex+1:i.rowIndex+i.rowSpan:u?a.beginRowIndex-1:i.rowIndex-1,o=u?a.beginColIndex:i.colIndex,this.getCell(this.indexTable[s][o].rowIndex,this.indexTable[s][o].cellIndex))}catch(f){t(f)}},getPreviewCell:function(e,n){try{var r=this.getCellInfo(e),i,s,o=this.selectedTds.length,u=this.cellsRange;return!n&&(o?!u.beginColIndex:!r.colIndex)||n&&(o?u.endColIndex==this.colsNum-1:r.rowIndex>this.colsNum-1)?null:(i=n?o?u.beginRowIndex:r.rowIndex<1?0:r.rowIndex-1:o?u.beginRowIndex:r.rowIndex,s=n?o?u.endColIndex+1:r.colIndex:o?u.beginColIndex-1:r.colIndex<1?0:r.colIndex-1,this.getCell(this.indexTable[i][s].rowIndex,this.indexTable[i][s].cellIndex))}catch(a){t(a)}},moveContent:function(t,n){if(e.isEmptyBlock(n))return;if(e.isEmptyBlock(t)){t.innerHTML=n.innerHTML;return}var r=t.lastChild;(r.nodeType==3||!dtd.$block[r.tagName])&&t.appendChild(t.ownerDocument.createElement("br"));while(r=n.firstChild)t.appendChild(r)},mergeRight:function(e){var t=this.getCellInfo(e),n=t.colIndex+t.colSpan,r=this.indexTable[t.rowIndex][n],i=this.getCell(r.rowIndex,r.cellIndex);e.colSpan=t.colSpan+r.colSpan,e.removeAttribute("width"),this.moveContent(e,i),this.deleteCell(i,r.rowIndex),this.update()},mergeDown:function(e){var t=this.getCellInfo(e),n=t.rowIndex+t.rowSpan,r=this.indexTable[n][t.colIndex],i=this.getCell(r.rowIndex,r.cellIndex);e.rowSpan=t.rowSpan+r.rowSpan,e.removeAttribute("height"),this.moveContent(e,i),this.deleteCell(i,r.rowIndex),this.update()},mergeRange:function(){var e=this.cellsRange,t=this.getCell(e.beginRowIndex,this.indexTable[e.beginRowIndex][e.beginColIndex].cellIndex);if(t.tagName=="TH"&&e.endRowIndex!==e.beginRowIndex){var n=this.indexTable,r=this.getCellInfo(t);t=this.getCell(1,n[1][r.colIndex].cellIndex),e=this.getCellsRange(t,this.getCell(n[this.rowsNum-1][r.colIndex].rowIndex,n[this.rowsNum-1][r.colIndex].cellIndex))}var i=this.getCells(e);for(var s=0,o;o=i[s++];)o!==t&&(this.moveContent(t,o),this.deleteCell(o));t.rowSpan=e.endRowIndex-e.beginRowIndex+1,t.rowSpan>1&&t.removeAttribute("height"),t.colSpan=e.endColIndex-e.beginColIndex+1,t.colSpan>1&&t.removeAttribute("width"),t.rowSpan==this.rowsNum&&t.colSpan!=1&&(t.colSpan=1);if(t.colSpan==this.colsNum&&t.rowSpan!=1){var u=t.parentNode.rowIndex;if(this.table.deleteRow)for(var s=u+1,a=u+1,f=t.rowSpan;s<f;s++)this.table.deleteRow(a);else for(var s=0,f=t.rowSpan-1;s<f;s++){var l=this.table.rows[u+1];l.parentNode.removeChild(l)}t.rowSpan=1}this.update()},insertRow:function(e,t){var n=this.colsNum,r=this.table,i=r.insertRow(e),s,o=parseInt((r.offsetWidth-n*20-n-1)/n,10);if(e==0||e==this.rowsNum)for(var u=0;u<n;u++)s=this.cloneCell(t,!0),this.setCellContent(s),s.getAttribute("vAlign")&&s.setAttribute("vAlign",s.getAttribute("vAlign")),i.appendChild(s);else{var a=this.indexTable[e],f=0;for(u=0;u<n;u++){var l=a[u];l.rowIndex<e?(s=this.getCell(l.rowIndex,l.cellIndex),s.rowSpan=l.rowSpan+1):(s=this.cloneCell(t,!0),this.setCellContent(s),i.appendChild(s))}}return this.update(),i},deleteRow:function(e){var t=this.table.rows[e],n=this.indexTable[e],r=this.colsNum,i=0;for(var s=0;s<r;){var o=n[s],u=this.getCell(o.rowIndex,o.cellIndex);if(u.rowSpan>1&&o.rowIndex==e){var a=u.cloneNode(!0);a.rowSpan=u.rowSpan-1,a.innerHTML="",u.rowSpan=1;var f=e+1,l=this.table.rows[f],c,h=this.getPreviewMergedCellsNum(f,s)-i;h<s?(c=s-h-1,domUtils.insertAfter(l.cells[c],a)):l.cells.length&&l.insertBefore(a,l.cells[0]),i+=1}s+=u.colSpan||1}var p=[],d={};for(s=0;s<r;s++){var v=n[s].rowIndex,m=n[s].cellIndex,g=v+"_"+m;if(d[g])continue;d[g]=1,u=this.getCell(v,m),p.push(u)}var y=[];utils.each(p,function(e){e.rowSpan==1?e.parentNode.removeChild(e):y.push(e)}),utils.each(y,function(e){e.rowSpan--}),t.parentNode.removeChild(t),this.update()},insertCol:function(e,t,n){function a(e,t,n){if(e==0){var r=t.nextSibling||t.previousSibling;r.tagName=="TH"&&(r=t.ownerDocument.createElement("th"),r.appendChild(t.firstChild),n.insertBefore(r,t),domUtils.remove(t))}else if(t.tagName=="TH"){var i=t.ownerDocument.createElement("td");i.appendChild(t.firstChild),n.insertBefore(i,t),domUtils.remove(t)}}var r=this.rowsNum,i=0,s,o,u=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10),f;if(e==0||e==this.colsNum)for(;i<r;i++)s=this.table.rows[i],f=s.cells[e==0?e:s.cells.length],o=this.cloneCell(t,!0),this.setCellContent(o),o.setAttribute("vAlign",o.getAttribute("vAlign")),f&&o.setAttribute("width",f.getAttribute("width")),e?domUtils.insertAfter(s.cells[s.cells.length-1],o):s.insertBefore(o,s.cells[0]),a(i,o,s);else for(;i<r;i++){var l=this.indexTable[i][e];l.colIndex<e?(o=this.getCell(l.rowIndex,l.cellIndex),o.colSpan=l.colSpan+1):(s=this.table.rows[i],f=s.cells[l.cellIndex],o=this.cloneCell(t,!0),this.setCellContent(o),o.setAttribute("vAlign",o.getAttribute("vAlign")),f&&o.setAttribute("width",f.getAttribute("width")),f?s.insertBefore(o,f):s.appendChild(o)),a(i,o,s)}this.update(),this.updateWidth(u,n||{tdPadding:10,tdBorder:1})},updateWidth:function(t,n){var r=this.table,i=e.getWidth(r)-n.tdPadding*2-n.tdBorder+t;if(i<r.ownerDocument.body.offsetWidth){r.setAttribute("width",i);return}var s=domUtils.getElementsByTagName(this.table,"td");utils.each(s,function(e){e.setAttribute("width",t)})},deleteCol:function(e){var t=this.indexTable,n=this.table.rows,r=this.table.getAttribute("width"),i=0,s=this.rowsNum,o={};for(var u=0;u<s;){var a=t[u],f=a[e],l=f.rowIndex+"_"+f.colIndex;if(o[l])continue;o[l]=1;var c=this.getCell(f.rowIndex,f.cellIndex);i||(i=c&&parseInt(c.offsetWidth/c.colSpan,10).toFixed(0)),c.colSpan>1?c.colSpan--:n[u].deleteCell(f.cellIndex),u+=f.rowSpan||1}this.table.setAttribute("width",r-i),this.update()},splitToCells:function(e){var t=this,n=this.splitToRows(e);utils.each(n,function(e){t.splitToCols(e)})},splitToRows:function(e){var t=this.getCellInfo(e),n=t.rowIndex,r=t.colIndex,i=[];e.rowSpan=1,i.push(e);for(var s=n,o=n+t.rowSpan;s<o;s++){if(s==n)continue;var u=this.table.rows[s],a=u.insertCell(r-this.getPreviewMergedCellsNum(s,r));a.colSpan=t.colSpan,this.setCellContent(a),a.setAttribute("vAlign",e.getAttribute("vAlign")),a.setAttribute("align",e.getAttribute("align")),e.style.cssText&&(a.style.cssText=e.style.cssText),i.push(a)}return this.update(),i},getPreviewMergedCellsNum:function(e,t){var n=this.indexTable[e],r=0;for(var i=0;i<t;){var s=n[i].colSpan,o=n[i].rowIndex;r+=s-(o==e?1:0),i+=s}return r},splitToCols:function(e){var t=(e.offsetWidth/e.colSpan-22).toFixed(0),n=this.getCellInfo(e),r=n.rowIndex,i=n.colIndex,s=[];e.colSpan=1,e.setAttribute("width",t),s.push(e);for(var o=i,u=i+n.colSpan;o<u;o++){if(o==i)continue;var a=this.table.rows[r],f=a.insertCell(this.indexTable[r][o].cellIndex+1);f.rowSpan=n.rowSpan,this.setCellContent(f),f.setAttribute("vAlign",e.getAttribute("vAlign")),f.setAttribute("align",e.getAttribute("align")),f.setAttribute("width",t),e.style.cssText&&(f.style.cssText=e.style.cssText);if(e.tagName=="TH"){var l=e.ownerDocument.createElement("th");l.appendChild(f.firstChild),l.setAttribute("vAlign",e.getAttribute("vAlign")),l.rowSpan=f.rowSpan,a.insertBefore(l,f),domUtils.remove(f)}s.push(f)}return this.update(),s},isLastCell:function(e,t,n){t=t||this.rowsNum,n=n||this.colsNum;var r=this.getCellInfo(e);return r.rowIndex+r.rowSpan==t&&r.colIndex+r.colSpan==n},getLastCell:function(e){e=e||this.table.getElementsByTagName("td");var t=this.getCellInfo(e[0]),n=this,r=e[0],i=r.parentNode,s=0,o=0,u;return utils.each(e,function(e){e.parentNode==i&&(o+=e.colSpan||1),s+=e.rowSpan*e.colSpan||1}),u=s/o,utils.each(e,function(e){if(n.isLastCell(e,u,o))return r=e,!1}),r},selectRow:function(e){var t=this.indexTable[e],n=this.getCell(t[0].rowIndex,t[0].cellIndex),r=this.getCell(t[this.colsNum-1].rowIndex,t[this.colsNum-1].cellIndex),i=this.getCellsRange(n,r);this.setSelected(i)},selectTable:function(){var e=this.table.getElementsByTagName("td"),t=this.getCellsRange(e[0],e[e.length-1]);this.setSelected(t)},sortTable:function(e,t){var n=this.table,r=n.rows,i=[],s=r[0].cells[0].tagName==="TH",o=0;if(this.selectedTds.length){var u=this.cellsRange,a=u.endRowIndex+1;for(var f=u.beginRowIndex;f<a;f++)i[f]=r[f];i.splice(0,u.beginRowIndex),o=u.endRowIndex+1===this.rowsNum?0:u.endRowIndex+1}else for(var f=0,a=r.length;f<a;f++)i[f]=r[f];s&&i.splice(0,1),i=utils.sort(i,function(n,r){var i=function(e){return e.innerText||e.textContent};return t?typeof t=="number"?t:t.call(this,n.cells[e],r.cells[e]):function(){var t=i(n.cells[e]),s=i(r.cells[e]);return t.localeCompare(s)}()});var l=n.ownerDocument.createDocumentFragment();for(var c=0,a=i.length;c<a;c++)l.appendChild(i[c]);var h=n.getElementsByTagName("tbody")[0];o?h.insertBefore(l,r[o-u.endRowIndex+u.beginRowIndex-1]):h.appendChild(l)},setBackground:function(e,t){if(typeof t=="string")utils.each(e,function(e){e.style.backgroundColor=t});else if(typeof t=="object"){t=utils.extend({repeat:!0,colorList:["#ddd","#fff"]},t);var n=this.getCellInfo(e[0]).rowIndex,r=0,i=t.colorList,s=function(e,t,n){return e[t]?e[t]:n?e[t%e.length]:""};for(var o=0,u;u=e[o++];){var a=this.getCellInfo(u);u.style.backgroundColor=s(i,n+r==a.rowIndex?r:++r,t.repeat)}}},removeBackground:function(e){utils.each(e,function(e){e.style.backgroundColor=""})}}}(),function(){function s(e,t){var n=e.getElementsByTagName("td");utils.each(n,function(e){e.removeAttribute("width")}),e.setAttribute("width",o(t,!0,r(t,e))),setTimeout(function(){utils.each(n,function(e){e.colSpan==1&&e.setAttribute("width",e.offsetWidth+"")})},0)}function o(e,t,n){var r=e.body;return r.offsetWidth-(t?parseInt(domUtils.getComputedStyle(r,"margin-left"),10)*2:0)-n.tableBorder*2-(e.options.offsetWidth||0)}function u(e){var n=t(e).cell;if(n){var r=i(n);return r.selectedTds.length?r.selectedTds:[n]}return[]}var e=UE.UETable,t=function(t){return e.getTableItemsByRange(t)},n=function(t){return e.getUETableBySelected(t)},r=function(t,n){return e.getDefaultValue(t,n)},i=function(t){return e.getUETable(t)};UE.commands.inserttable={queryCommandState:function(){return t(this).table?-1:0},execCommand:function(e,t){function n(e,t){var n=[],r=e.numRows,i=e.numCols;for(var s=0;s<r;s++){n.push("<tr>");for(var o=0;o<i;o++)n.push('<td width="'+t+'"  vAlign="'+e.tdvalign+'" >'+(browser.ie?domUtils.fillChar:"<br/>")+"</td>");n.push("</tr>")}return"<table><tbody>"+n.join("")+"</tbody></table>"}t||(t=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign}));var i=this,s=this.selection.getRange(),o=s.startContainer,u=domUtils.findParent(o,function(e){return domUtils.isBlockElm(e)},!0)||i.body,a=r(i),f=u.offsetWidth,l=Math.floor(f/t.numCols-a.tdPadding*2-a.tdBorder);!t.tdvalign&&(t.tdvalign=i.options.tdvalign),i.execCommand("inserthtml",n(t,l))}},UE.commands.insertparagraphbeforetable={queryCommandState:function(){return t(this).cell?0:-1},execCommand:function(){var e=t(this).table;if(e){var n=this.document.createElement("p");n.innerHTML=browser.ie?"&nbsp;":"<br />",e.parentNode.insertBefore(n,e),this.selection.getRange().setStart(n,0).setCursor()}}},UE.commands.deletetable={queryCommandState:function(){var e=this.selection.getRange();return domUtils.findParentByTagName(e.startContainer,"table",!0)?0:-1},execCommand:function(e,t){var n=this.selection.getRange();t=t||domUtils.findParentByTagName(n.startContainer,"table",!0);if(t){var r=t.nextSibling;r||(r=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"}),t.parentNode.insertBefore(r,t)),domUtils.remove(t),n=this.selection.getRange(),r.nodeType==3?n.setStartBefore(r):n.setStart(r,0),n.setCursor(!1,!0),this.fireEvent("tablehasdeleted")}}},UE.commands.cellalign={queryCommandState:function(){return u(this).length?0:-1},execCommand:function(e,t){var n=u(this);if(n.length)for(var r=0,i;i=n[r++];)i.setAttribute("align",t)}},UE.commands.cellvalign={queryCommandState:function(){return u(this).length?0:-1},execCommand:function(e,t){var n=u(this);if(n.length)for(var r=0,i;i=n[r++];)i.setAttribute("vAlign",t)}},UE.commands.insertcaption={queryCommandState:function(){var e=t(this).table;return e?e.getElementsByTagName("caption").length==0?1:-1:-1},execCommand:function(){var e=t(this).table;if(e){var n=this.document.createElement("caption");n.innerHTML=browser.ie?domUtils.fillChar:"<br/>",e.insertBefore(n,e.firstChild);var r=this.selection.getRange();r.setStart(n,0).setCursor()}}},UE.commands.deletecaption={queryCommandState:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");return t?t.getElementsByTagName("caption").length==0?-1:1:-1},execCommand:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");if(t){domUtils.remove(t.getElementsByTagName("caption")[0]);var n=this.selection.getRange();n.setStart(t.rows[0].cells[0],0).setCursor()}}},UE.commands.inserttitle={queryCommandState:function(){var e=t(this).table;if(e){var n=e.rows[0];return n.getElementsByTagName("th").length==0?0:-1}return-1},execCommand:function(){var e=t(this).table;e&&i(e).insertRow(0,"th");var n=e.getElementsByTagName("th")[0];this.selection.getRange().setStart(n,0).setCursor(!1,!0)}},UE.commands.deletetitle={queryCommandState:function(){var e=t(this).table;if(e){var n=e.rows[0];return n.getElementsByTagName("th").length?0:-1}return-1},execCommand:function(){var e=t(this).table;e&&domUtils.remove(e.rows[0]);var n=e.getElementsByTagName("td")[0];this.selection.getRange().setStart(n,0).setCursor(!1,!0)}},UE.commands.mergeright={queryCommandState:function(e){var n=t(this);if(!n.cell)return-1;var r=i(n.table);if(r.selectedTds.length)return-1;var s=r.getCellInfo(n.cell),o=s.colIndex+s.colSpan;if(o>=r.colsNum)return-1;var u=r.indexTable[s.rowIndex][o];return u.rowIndex==s.rowIndex&&u.rowSpan==s.rowSpan?0:-1},execCommand:function(e){var n=this.selection.getRange(),r=n.createBookmark(!0),s=t(this).cell,o=i(s);o.mergeRight(s),n.moveToBookmark(r).select()}},UE.commands.mergedown={queryCommandState:function(e){var n=t(this),r=n.cell;if(!r||r.tagName=="TH")return-1;var s=i(n.table);if(s.selectedTds.length)return-1;var o=s.getCellInfo(n.cell),u=o.rowIndex+o.rowSpan;if(u>=s.rowsNum)return-1;var a=s.indexTable[u][o.colIndex];return a.colIndex==o.colIndex&&a.colSpan==o.colSpan&&n.cell.tagName!=="TH"?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this).cell,s=i(r);s.mergeDown(r),e.moveToBookmark(n).select()}},UE.commands.mergecells={queryCommandState:function(){return n(this)?0:-1},execCommand:function(){var e=n(this);if(e&&e.selectedTds.length){var t=e.selectedTds[0];e.mergeRange();var r=this.selection.getRange();domUtils.isEmptyBlock(t)?r.setStart(t,0).collapse(!0):r.selectNodeContents(t),r.select()}}},UE.commands.insertrow={queryCommandState:function(){var e=t(this),n=e.cell;return n&&n.tagName=="TD"&&i(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this),s=r.cell,o=r.table,u=i(o),a=u.getCellInfo(s);if(!u.selectedTds.length)u.insertRow(a.rowIndex,s);else{var f=u.cellsRange;for(var l=0,c=f.endRowIndex-f.beginRowIndex+1;l<c;l++)u.insertRow(f.beginRowIndex,s)}e.moveToBookmark(n).select(),o.getAttribute("interlaced")==="enabled"&&this.fireEvent("interlacetable",o)}},UE.commands.insertrownext={queryCommandState:function(){var e=t(this),n=e.cell;return n&&n.tagName=="TD"&&i(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this),s=r.cell,o=r.table,u=i(o),a=u.getCellInfo(s);if(!u.selectedTds.length)u.insertRow(a.rowIndex+a.rowSpan,s);else{var f=u.cellsRange;for(var l=0,c=f.endRowIndex-f.beginRowIndex+1;l<c;l++)u.insertRow(f.endRowIndex+1,s)}e.moveToBookmark(n).select(),o.getAttribute
("interlaced")==="enabled"&&this.fireEvent("interlacetable",o)}},UE.commands.deleterow={queryCommandState:function(){var e=t(this);if(!e.cell)return-1},execCommand:function(){var e=t(this).cell,n=i(e),r=n.cellsRange,s=n.getCellInfo(e),o=n.getVSideCell(e),u=n.getVSideCell(e,!0),a=this.selection.getRange();if(utils.isEmptyObject(r))n.deleteRow(s.rowIndex);else for(var f=r.beginRowIndex;f<r.endRowIndex+1;f++)n.deleteRow(r.beginRowIndex);var l=n.table;if(!l.getElementsByTagName("td").length){var c=l.nextSibling;domUtils.remove(l),c&&a.setStart(c,0).setCursor(!1,!0)}else if(s.rowSpan==1||s.rowSpan==r.endRowIndex-r.beginRowIndex+1)(u||o)&&a.selectNodeContents(u||o).setCursor(!1,!0);else{var h=n.getCell(s.rowIndex,n.indexTable[s.rowIndex][s.colIndex].cellIndex);h&&a.selectNodeContents(h).setCursor(!1,!0)}l.getAttribute("interlaced")==="enabled"&&this.fireEvent("interlacetable",l)}},UE.commands.insertcol={queryCommandState:function(e){var n=t(this),r=n.cell;return r&&(r.tagName=="TD"||r.tagName=="TH")&&i(n.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(e){var n=this.selection.getRange(),r=n.createBookmark(!0);if(this.queryCommandState(e)==-1)return;var s=t(this).cell,o=i(s),u=o.getCellInfo(s);if(!o.selectedTds.length)o.insertCol(u.colIndex,s);else{var a=o.cellsRange;for(var f=0,l=a.endColIndex-a.beginColIndex+1;f<l;f++)o.insertCol(a.beginColIndex,s)}n.moveToBookmark(r).select(!0)}},UE.commands.insertcolnext={queryCommandState:function(){var e=t(this),n=e.cell;return n&&i(e.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this).cell,s=i(r),o=s.getCellInfo(r);if(!s.selectedTds.length)s.insertCol(o.colIndex+o.colSpan,r);else{var u=s.cellsRange;for(var a=0,f=u.endColIndex-u.beginColIndex+1;a<f;a++)s.insertCol(u.endColIndex+1,r)}e.moveToBookmark(n).select()}},UE.commands.deletecol={queryCommandState:function(){var e=t(this);if(!e.cell)return-1},execCommand:function(){var e=t(this).cell,n=i(e),r=n.cellsRange,s=n.getCellInfo(e),o=n.getHSideCell(e),u=n.getHSideCell(e,!0);if(utils.isEmptyObject(r))n.deleteCol(s.colIndex);else for(var a=r.beginColIndex;a<r.endColIndex+1;a++)n.deleteCol(r.beginColIndex);var f=n.table,l=this.selection.getRange();if(!f.getElementsByTagName("td").length){var c=f.nextSibling;domUtils.remove(f),c&&l.setStart(c,0).setCursor(!1,!0)}else domUtils.inDoc(e,this.document)?l.setStart(e,0).setCursor(!1,!0):u&&domUtils.inDoc(u,this.document)?l.selectNodeContents(u).setCursor(!1,!0):o&&domUtils.inDoc(o,this.document)&&l.selectNodeContents(o).setCursor(!0,!0)}},UE.commands.splittocells={queryCommandState:function(){var e=t(this),n=e.cell;if(!n)return-1;var r=i(e.table);return r.selectedTds.length>0?-1:n&&(n.colSpan>1||n.rowSpan>1)?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this).cell,s=i(r);s.splitToCells(r),e.moveToBookmark(n).select()}},UE.commands.splittorows={queryCommandState:function(){var e=t(this),n=e.cell;if(!n)return-1;var r=i(e.table);return r.selectedTds.length>0?-1:n&&n.rowSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this).cell,s=i(r);s.splitToRows(r),e.moveToBookmark(n).select()}},UE.commands.splittocols={queryCommandState:function(){var e=t(this),n=e.cell;if(!n)return-1;var r=i(e.table);return r.selectedTds.length>0?-1:n&&n.colSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),n=e.createBookmark(!0),r=t(this).cell,s=i(r);s.splitToCols(r),e.moveToBookmark(n).select()}},UE.commands.adaptbytext=UE.commands.adaptbywindow={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e){var n=t(this),r=n.table;if(r)if(e=="adaptbywindow")s(r,this);else{var i=domUtils.getElementsByTagName(r,"td th");utils.each(i,function(e){e.removeAttribute("width")}),r.removeAttribute("width")}}},UE.commands.averagedistributecol={queryCommandState:function(){var e=n(this);return e?e.isFullRow()||e.isFullCol()?0:-1:-1},execCommand:function(e){function s(){var e=i.table,n,s=0,o=0,u=r(t,e);if(i.isFullRow())s=e.offsetWidth,o=i.colsNum;else{var a=i.cellsRange.beginColIndex,f=i.cellsRange.endColIndex,l;for(var c=a;c<=f;)l=i.selectedTds[c],s+=l.offsetWidth,c+=l.colSpan,o+=1}return n=Math.ceil(s/o)-u.tdBorder*2-u.tdPadding*2,n}function o(e){utils.each(domUtils.getElementsByTagName(i.table,"th"),function(e){e.setAttribute("width","")});var t=i.isFullRow()?domUtils.getElementsByTagName(i.table,"td"):i.selectedTds;utils.each(t,function(t){t.colSpan==1&&t.setAttribute("width",e)})}var t=this,i=n(t);i&&i.selectedTds.length&&o(s())}},UE.commands.averagedistributerow={queryCommandState:function(){var e=n(this);return e?e.selectedTds&&/th/ig.test(e.selectedTds[0].tagName)?-1:e.isFullRow()||e.isFullCol()?0:-1:-1},execCommand:function(e){function s(){var e,n,s=0,o=i.table,u=r(t,o),a=parseInt(domUtils.getComputedStyle(o.getElementsByTagName("td")[0],"padding-top"));if(i.isFullCol()){var f=domUtils.getElementsByTagName(o,"caption"),l=domUtils.getElementsByTagName(o,"th"),c,h;f.length>0&&(c=f[0].offsetHeight),l.length>0&&(h=l[0].offsetHeight),s=o.offsetHeight-(c||0)-(h||0),n=l.length==0?i.rowsNum:i.rowsNum-1}else{var p=i.cellsRange.beginRowIndex,d=i.cellsRange.endRowIndex,v=0,m=domUtils.getElementsByTagName(o,"tr");for(var g=p;g<=d;g++)s+=m[g].offsetHeight,v+=1;n=v}return browser.ie&&browser.version<9?e=Math.ceil(s/n):e=Math.ceil(s/n)-u.tdBorder*2-a*2,e}function o(e){var t=i.isFullCol()?domUtils.getElementsByTagName(i.table,"td"):i.selectedTds;utils.each(t,function(t){t.rowSpan==1&&t.setAttribute("height",e)})}var t=this,i=n(t);i&&i.selectedTds.length&&o(s())}},UE.commands.cellalignment={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var r=this,i=n(r);if(!i){var s=r.selection.getStart(),o=s&&domUtils.findParentByTagName(s,["td","th","caption"],!0);/caption/ig.test(o.tagName)?(o.style.textAlign=t.align,o.style.verticalAlign=t.vAlign):domUtils.setAttributes(o,t),r.selection.getRange().setCursor(!0)}else utils.each(i.selectedTds,function(e){domUtils.setAttributes(e,t)})},queryCommandValue:function(e){var n=t(this).cell;n||(n=u(this)[0]);if(!n)return null;var r=UE.UETable.getUETable(n).selectedTds;return!r.length&&(r=n),UE.UETable.getTableCellAlignState(r)}},UE.commands.tablealignment={queryCommandState:function(){return browser.ie&&browser.version<8?-1:t(this).table?0:-1},execCommand:function(e,t){var n=this,r=n.selection.getStart(),i=r&&domUtils.findParentByTagName(r,["table"],!0);i&&i.setAttribute("align",t)}},UE.commands.edittable={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var n=this.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"table");if(r){var i=domUtils.getElementsByTagName(r,"td").concat(domUtils.getElementsByTagName(r,"th"),domUtils.getElementsByTagName(r,"caption"));utils.each(i,function(e){e.style.borderColor=t})}}},UE.commands.edittd={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var r=this,i=n(r);if(!i){var s=r.selection.getStart(),o=s&&domUtils.findParentByTagName(s,["td","th","caption"],!0);o&&(o.style.backgroundColor=t)}else utils.each(i.selectedTds,function(e){e.style.backgroundColor=t})}},UE.commands.sorttable={queryCommandState:function(){var e=this,n=t(e);if(!n.cell)return-1;var r=n.table,i=r.getElementsByTagName("td");for(var s=0,o;o=i[s++];)if(o.rowSpan!=1||o.colSpan!=1)return-1;return 0},execCommand:function(e,n){var r=this,s=r.selection.getRange(),o=s.createBookmark(!0),u=t(r),a=u.cell,f=i(u.table),l=f.getCellInfo(a);f.sortTable(l.cellIndex,n),s.moveToBookmark(o).select()}},UE.commands.enablesort=UE.commands.disablesort={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e){var n=t(this).table;n.setAttribute("data-sort",e=="enablesort"?"sortEnabled":"sortDisabled")}},UE.commands.settablebackground={queryCommandState:function(){return u(this).length>1?0:-1},execCommand:function(e,t){var n,r,s;r=u(this),s=i(r[0]),s.setBackground(r,t)}},UE.commands.cleartablebackground={queryCommandState:function(){var e=u(this);if(!e.length)return-1;for(var t=0,n;n=e[t++];)if(n.style.backgroundColor!=="")return 0;return-1},execCommand:function(){var e=u(this),t=i(e[0]);t.removeBackground(e)}},UE.commands.interlacetable=UE.commands.uninterlacetable={queryCommandState:function(e){var n=t(this).table;if(!n)return-1;var r=n.getAttribute("interlaced");return e=="interlacetable"?r==="enabled"?-1:0:!r||r==="disabled"?-1:0},execCommand:function(e,n){var r=t(this).table;e=="interlacetable"?(r.setAttribute("interlaced","enabled"),this.fireEvent("interlacetable",r,n)):(r.setAttribute("interlaced","disabled"),this.fireEvent("uninterlacetable",r))}}}(),UE.plugins.table=function(){function m(e){}function L(e,t){A(e,"width",!0),A(e,"height",!0)}function A(e,t,n){e.style[t]&&(n&&e.setAttribute(t,parseInt(e.style[t],10)),e.style[t]="")}function O(e){if(e.tagName=="TD"||e.tagName=="TH")return e;var t;return(t=domUtils.findParentByTagName(e,"td",!0)||domUtils.findParentByTagName(e,"th",!0))?t:null}function M(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1}function _(t){return t.pageX||t.pageY?{x:t.pageX,y:t.pageY}:{x:t.clientX+e.document.body.scrollLeft-e.document.body.clientLeft,y:t.clientY+e.document.body.scrollTop-e.document.body.clientTop}}function D(t){if(st())return;try{var n=O(t.target||t.srcElement),r;if(s){e.body.style.webkitUserSelect="none";if(Math.abs(f.x-t.clientX)>u||Math.abs(f.y-t.clientY)>u)G(),s=!1,a=0,Z(t)}if(b&&T){a=0,e.body.style.webkitUserSelect="none",e.selection.getNative()[browser.ie?"empty":"removeAllRanges"](),r=_(t),q(e,!0,b,r,n),b=="h"?x.style.left=F(T,t)+"px":b=="v"&&(x.style.top=I(T,t)+"px");return}if(n){if(e.fireEvent("excludetable",n)===!0)return;r=_(t);var i=W(n,r),o=domUtils.findParentByTagName(n,"table",!0);if(j(o,n,t,!0)){if(e.fireEvent("excludetable",o)===!0)return;e.body.style.cursor="url("+e.options.cursorpath+"h.png),pointer"}else if(j(o,n,t)){if(e.fireEvent("excludetable",o)===!0)return;e.body.style.cursor="url("+e.options.cursorpath+"v.png),pointer"}else{e.body.style.cursor="text";var l=n;/\d/.test(i)&&(i=i.replace(/\d/,""),n=h(n).getPreviewCell(n,i=="v")),q(e,n?!!i:!1,n?i:"",r,n)}}else H(!1,o,e)}catch(c){m(c)}}function H(e,t,n){if(!e){if(S)return;P=setTimeout(function(){!S&&E&&E.parentNode&&E.parentNode.removeChild(E)},2e3)}else B(t,n)}function B(e,t){function s(n,r){clearTimeout(i),i=setTimeout(function(){t.fireEvent("tableClicked",e,r)},300)}function o(n){clearTimeout(i);var r=h(e),s=e.rows[0].cells[0],o=r.getLastCell(),u=r.getCellsRange(s,o);t.selection.getRange().setStart(s,0).setCursor(!1,!0),r.setSelected(u)}var n=domUtils.getXY(e),r=e.ownerDocument;if(E&&E.parentNode)return E;E=r.createElement("div"),E.contentEditable=!1,E.innerHTML="",E.style.cssText="width:15px;height:15px;background-image:url("+t.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(n.y-15)+"px;left:"+n.x+"px;",domUtils.unSelectable(E),E.onmouseover=function(e){S=!0},E.onmouseout=function(e){S=!1},domUtils.on(E,"click",function(e,t){s(t,this)}),domUtils.on(E,"dblclick",function(e,t){o(t)}),domUtils.on(E,"dragstart",function(e,t){domUtils.preventDefault(t)});var i;r.body.appendChild(E)}function j(e,t,n,r){var i=_(n),s=W(t,i);if(r){var o=e.getElementsByTagName("caption")[0],u=o?o.offsetHeight:0;return s=="v1"&&i.y-domUtils.getXY(e).y-u<8}return s=="h1"&&i.x-domUtils.getXY(e).x<8}function F(t,n){var r=h(t);if(r){var s=r.getSameEndPosCells(t,"x")[0],o=r.getSameStartPosXCells(t)[0],u=_(n).x,a=(s?domUtils.getXY(s).x:domUtils.getXY(r.table).x)+20,f=o?domUtils.getXY(o).x+o.offsetWidth-20:e.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(e.body,"width"),10);return a+=i,f-=i,u<a?a:u>f?f:u}}function I(e,t){try{var n=domUtils.getXY(e).y,r=_(t).y;return r<n?n:r}catch(i){m(i)}}function q(e,t,n,r,i){try{e.body.style.cursor=n=="h"?"col-resize":n=="v"?"row-resize":"text",browser.ie&&(n&&!N&&!p(e)?(dt(e,e.document),mt(n,i)):vt(e)),w=t}catch(s){m(s)}}function R(){var e="_UETableResizeLine",t=this.document.getElementById(e);if(!t){t=this.document.createElement("div"),t.id=e,t.contnetEditable=!1,t.setAttribute("unselectable","on");var n={width:2*o+1+"px",position:"absolute","z-index":1e5,cursor:"col-resize",background:"red",display:"none"};t.onmouseout=function(){this.style.display="none"},utils.extend(t.style,n),this.document.body.appendChild(t)}return t}function U(e,t){var n=R.call(this),r=t.table,i={top:domUtils.getXY(r).y+"px",left:domUtils.getXY(e).x+e.offsetWidth-o+"px",display:"block",height:r.offsetHeight+"px"};utils.extend(n.style,i)}function z(e){var t=h(e);U.call(this,e,t)}function W(e,t){var n=domUtils.getXY(e);return n?n.x+e.offsetWidth-t.x<o?"h":t.x-n.x<o?"h1":n.y+e.offsetHeight-t.y<o?"v":t.y-n.y<o?"v1":"":""}function X(t,n){if(st())return;f={x:n.clientX,y:n.clientY};if(n.button==2){var r=p(e),i=!1;if(r){var s=bt(e,n);utils.each(r.selectedTds,function(e){e===s&&(i=!0)}),i?(s=r.selectedTds[0],setTimeout(function(){e.selection.getRange().setStart(s,0).setCursor(!1,!0)},0)):(v(domUtils.getElementsByTagName(e.body,"th td")),r.clearSelected())}}else J(n)}function V(){t&&clearTimeout(t),t=null}function $(t){a=0,t=t||e.window.event;var n=O(t.target||t.srcElement);if(n){var r;if(r=W(n,_(t))){vt(e);if(r=="h1"){r="h";if(j(domUtils.findParentByTagName(n,"table"),n,t))e.execCommand("adaptbywindow");else{n=h(n).getPreviewCell(n);if(n){var i=e.selection.getRange();i.selectNodeContents(n).setCursor(!0,!0)}}}if(r=="h"){var s=h(n),o=s.table,u=at(n,o,!0);u=Q(u,"left"),s.width=s.offsetWidth;var f=[],l=[];utils.each(u,function(e){f.push(e.offsetWidth)}),utils.each(u,function(e){e.removeAttribute("width")}),window.setTimeout(function(){var e=!0;utils.each(u,function(t,n){var r=t.offsetWidth;if(r>f[n])return e=!1,!1;l.push(r)});var t=e?l:f;utils.each(u,function(e,n){e.width=t[n]-pt()})},0)}}}}function J(t){v(domUtils.getElementsByTagName(e.body,"td th")),utils.each(e.document.getElementsByTagName("table"),function(e){e.ueTable=null}),g=bt(e,t);if(!g)return;var n=domUtils.findParentByTagName(g,"table",!0);ut=h(n),ut&&ut.clearSelected(),w?K(t):(e.document.body.style.webkitUserSelect="",N=!0,e.addListener("mouseover",tt))}function K(e){browser.ie&&(e=Y(e)),G(),s=!0,n=setTimeout(function(){Z(e)},l)}function Q(e,t){var n=[],r=null;for(var i=0,s=e.length;i<s;i++)r=e[i][t],r&&n.push(r);return n}function G(){n&&clearTimeout(n),n=null}function Y(e){var t=["pageX","pageY","clientX","clientY","srcElement","target"],n={};if(e)for(var r=0,i,s;i=t[r];r++)s=e[i],s&&(n[i]=s);return n}function Z(t){s=!1;if(!g)return;var n=Math.abs(f.x-t.clientX)>=Math.abs(f.y-t.clientY)?"h":"v";/\d/.test(n)&&(n=n.replace(/\d/,""),g=h(g).getPreviewCell(g,n=="v")),vt(e),dt(e,e.document),e.fireEvent("saveScene"),mt(n,g),N=!0,b=n,T=g}function et(e,t){if(st())return;G(),s=!1;if(w){a=++a%3,f={x:t.clientX,y:t.clientY},r=setTimeout(function(){a>0&&a--},l);if(a===2){a=0,$(t);return}}if(t.button==2)return;var n=this,i=n.selection.getRange(),o=domUtils.findParentByTagName(i.startContainer,"table",!0),u=domUtils.findParentByTagName(i.endContainer,"table",!0);if(o||u)o===u?(o=domUtils.findParentByTagName(i.startContainer,["td","th","caption"],!0),u=domUtils.findParentByTagName(i.endContainer,["td","th","caption"],!0),o!==u&&n.selection.clearRange()):n.selection.clearRange();N=!1,n.document.body.style.webkitUserSelect="";if(b&&T){n.selection.getNative()[browser.ie?"empty":"removeAllRanges"](),a=0,x=n.document.getElementById("ue_tableDragLine");var c=domUtils.getXY(T),p=domUtils.getXY(x);switch(b){case"h":it(T,p.x-c.x);break;case"v":ot(T,p.y-c.y-T.offsetHeight);break;default:}b="",T=null,vt(n),n.fireEvent("saveScene");return}if(!g){var d=domUtils.findParentByTagName(t.target||t.srcElement,"td",!0);d||(d=domUtils.findParentByTagName(t.target||t.srcElement,"th",!0));if(d&&(d.tagName=="TD"||d.tagName=="TH")){if(n.fireEvent("excludetable",d)===!0)return;i=new dom.Range(n.document),i.setStart(d,0).setCursor(!1,!0)}}else{var v=h(g),m=v?v.selectedTds[0]:null;if(m)i=new dom.Range(n.document),domUtils.isEmptyBlock(m)?i.setStart(m,0).setCursor(!1,!0):i.selectNodeContents(m).shrinkBoundary().setCursor(!1,!0);else{i=n.selection.getRange().shrinkBoundary();if(!i.collapsed){var o=domUtils.findParentByTagName(i.startContainer,["td","th"],!0),u=domUtils.findParentByTagName(i.endContainer,["td","th"],!0);(o&&!u||!o&&u||o&&u&&o!==u)&&i.setCursor(!1,!0)}}g=null,n.removeListener("mouseover",tt)}n._selectionChange(250,t)}function tt(e,t){if(st())return;var n=this,r=t.target||t.srcElement;y=domUtils.findParentByTagName(r,"td",!0)||domUtils.findParentByTagName(r,"th",!0);if(g&&y&&(g.tagName=="TD"&&y.tagName=="TD"||g.tagName=="TH"&&y.tagName=="TH")&&domUtils.findParentByTagName(g,"table")==domUtils.findParentByTagName(y,"table")){var i=h(y);if(g!=y){n.document.body.style.webkitUserSelect="none",n.selection.getNative()[browser.ie?"empty":"removeAllRanges"]();var s=i.getCellsRange(g,y);i.setSelected(s)}else n.document.body.style.webkitUserSelect="",i.clearSelected()}t.preventDefault?t.preventDefault():t.returnValue=!1}function nt(e,t,n){var r=parseInt(domUtils.getComputedStyle(e,"line-height"),10),i=n+t;t=i<r?r:i,e.style.height&&(e.style.height=""),e.rowSpan==1?e.setAttribute("height",t):e.removeAttribute&&e.removeAttribute("height")}function rt(e){return e?parseInt(domUtils.getComputedStyle(e,"width"),10):0}function it(e,t){var n=h(e);if(n){var r=n.table,i=at(e,r);r.style.width="",r.removeAttribute("width"),t=lt(t,e,i);if(e.nextSibling){var s=0;utils.each(i,function(e){e.left.width=+e.left.width+t,e.right&&(e.right.width=+e.right.width-t)})}else utils.each(i,function(e){e.left.width-=-t})}}function st(){return e.body.contentEditable==="false"}function ot(e,t){if(Math.abs(t)<10)return;var n=h(e);if(n){var r=n.getSameEndPosCells(e,"y"),i=r[0]?r[0].offsetHeight:0;for(var s=0,o;o=r[s++];)nt(o,t,i)}}function at(e,t,n){t||(t=domUtils.findParentByTagName(e,"table"));if(!t)return null;var r=domUtils.getNodeIndex(e),i=e,s=t.rows,o=0;while(i)i.nodeType===1&&(o+=i.colSpan||1),i=i.previousSibling;i=null;var u=[];return utils.each(s,function(e){var t=e.cells,r=0;utils.each(t,function(e){r+=e.colSpan||1;if(r===o)return u.push({left:e,right:e.nextSibling||null}),!1;if(r>o)return n&&u.push({left:e}),!1})}),u}function ft(e){var t=Number.MAX_VALUE;for(var n=0,r;r=e[n];n++)t=Math.min(t,r.width||ct(r));return t}function lt(e,t,n){e-=pt();if(e<0)return 0;e-=ct(t);var r=e<0?"left":"right";return e=Math.abs(e),utils.each(n,function(t){var n=t[r];n&&(e=Math.min(e,ct(n)-i))}),e=e<0?0:e,r==="left"?-e:e}function ct(e){var t=0,n=0,t=e.offsetWidth-pt();e.nextSibling||(t-=ht(e)),t=t<0?0:t;try{e.width=t}catch(r){}return t}function ht(e){tab=domUtils.findParentByTagName(e,"table",!1);if(tab.offsetVal===undefined){var t=e.previousSibling;t?tab.offsetVal=e.offsetWidth-t.offsetWidth===c.borderWidth?c.borderWidth:0:tab.offsetVal=0}return tab.offsetVal}function pt(){if(c.tabcellSpace===undefined){var t=null,n=e.document.createElement("table"),r=e.document.createElement("tbody"),i=e.document.createElement("tr"),s=e.document.createElement("td"),o=null;s.style.cssText="border: 0;",s.width=1,i.appendChild(s),i.appendChild(o=s.cloneNode(!1)),r.appendChild(i),n.appendChild(r),n.style.cssText="visibility: hidden;",e.body.appendChild(n),c.paddingSpace=s.offsetWidth-1;var u=n.offsetWidth;s.style.cssText="",o.style.cssText="",c.borderWidth=(n.offsetWidth-u)/3,c.tabcellSpace=c.paddingSpace+c.borderWidth,e.body.removeChild(n)}return pt=function(){return c.tabcellSpace},c.tabcellSpace}function dt(e,t){if(N)return;x=e.document.createElement("div"),domUtils.setAttributes(x,{id:"ue_tableDragLine",unselectable:"on",contenteditable:!1,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"}),e.body.appendChild(x)}function vt(e){if(N)return;var t;while(t=e.document.getElementById("ue_tableDragLine"))domUtils.remove(t)}function mt(e,t){if(!t)return;var n=domUtils.findParentByTagName(t,"table"),r=n.getElementsByTagName("caption"),i=n.offsetWidth,s=n.offsetHeight-(r.length>0?r[0].offsetHeight:0),o=domUtils.getXY(n),u=domUtils.getXY(t),a;switch(e){case"h":a="height:"+s+"px;top:"+(o.y+(r.length>0?r[0].offsetHeight:0))+"px;left:"+(u.x+t.offsetWidth),x.style.cssText=a+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":a="width:"+i+"px;left:"+o.x+"px;top:"+(u.y+t.offsetHeight),x.style.cssText=a+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)";break;default:}}function gt(e,t){var n=domUtils.getElementsByTagName(e.body,"table"),r;for(var i=0,s;s=n[i++];){var o=domUtils.getElementsByTagName(s,"td");o[0]&&(t?(r=o[0].style.borderColor.replace(/\s/g,""),/(#ffffff)|(rgb\(255,f55,255\))/ig.test(r)&&domUtils.addClass(s,"noBorderTable")):domUtils.removeClasses(s,"noBorderTable"))}}function yt(e,t,n){var r=e.body;return r.offsetWidth-(t?parseInt(domUtils.getComputedStyle(r,"margin-left"),10)*2:0)-n.tableBorder*2-(e.options.offsetWidth||0)}function bt(e,t){var n=domUtils.findParentByTagName(t.target||t.srcElement,["td","th"],!0),r=null;if(!n)return null;r=W(n,_(t));if(!n)return null;if(r==="h1"&&n.previousSibling){var i=domUtils.getXY(n),s=n.offsetWidth;Math.abs(i.x+s-t.clientX)>s/3&&(n=n.previousSibling)}else if(r==="v1"&&n.parentNode.previousSibling){var i=domUtils.getXY(n),o=n.offsetHeight;Math.abs(i.y+o-t.clientY)>o/3&&(n=n.parentNode.previousSibling.firstChild)}return n&&e.fireEvent("excludetable",n)!==!0?n:null}var e=this,t=null,n=null,r=null,i=5,s=!1,o=5,u=10,a=0,f=null,l=360,c=UE.UETable,h=function(e){return c.getUETable(e)},p=function(e){return c.getUETableBySelected(e)},d=function(e,t){return c.getDefaultValue(e,t)},v=function(e){return c.removeSelectedClass(e)};e.ready(function(){var e=this,t=e.selection.getText;e.selection.getText=function(){var n=p(e);if(n){var r="";return utils.each(n.selectedTds,function(e){r+=e[browser.ie?"innerText":"textContent"]}),r}return t.call(e.selection)}});var g=null,y=null,b="",w=!1,E=null,S=!1,x=null,T=null,N=!1,C=!0;e.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:e.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:!1,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]}),e.getUETable=h;var k={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};e.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}table{margin-bottom:10px;border-collapse:collapse;display:table;}td,th{padding: 5px 10px;border: 1px solid #DDD;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:2px solid #BBB;background:#F7F7F7;}.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }td p{margin:0;padding:0;}",e.document);var t,n,r;e.addListener("keydown",function(e,i){var s=this,o=i.keyCode||i.which;if(o==8){var u=p(s);u&&u.selectedTds.length&&(u.isFullCol()?s.execCommand("deletecol"):u.isFullRow()?s.execCommand("deleterow"):s.fireEvent("delcells"),domUtils.preventDefault(i));var a=domUtils.findParentByTagName(s.selection.getStart(),"caption",!0),f=s.selection.getRange();if(f.collapsed&&a&&M(a)){s.fireEvent("saveScene");var l=a.parentNode;domUtils.remove(a),l&&f.setStart(l.rows[0].cells[0],0).setCursor(!1,!0),s.fireEvent("saveScene")}}if(o==46){u=p(s);if(u){s.fireEvent("saveScene");for(var c=0,h;h=u.selectedTds[c++];)domUtils.fillNode(s.document,h);s.fireEvent("saveScene"),domUtils.preventDefault(i)}}if(o==13){var d=s.selection.getRange(),a=domUtils.findParentByTagName(d.startContainer,"caption",!0);if(a){var l=domUtils.findParentByTagName(a,"table");d.collapsed?a&&d.setStart(l.rows[0].cells[0],0).setCursor(!1,!0):(d.deleteContents(),s.fireEvent("saveScene")),domUtils.preventDefault(i);return}if(d.collapsed){var l=domUtils.findParentByTagName(d.startContainer,"table");if(l){var v=l.rows[0].cells[0],m=domUtils.findParentByTagName(s.selection.getStart(),["td","th"],!0),g=l.previousSibling;if(v===m&&(!g||g.nodeType==1&&g.tagName=="TABLE")&&domUtils.isStartInblock(d)){var y=domUtils.findParent(s.selection.getStart(),function(e){return domUtils.isBlockElm(e)},!0);y&&(/t(h|d)/i.test(y.tagName)||y===m.firstChild)&&(s.execCommand("insertparagraphbeforetable"),domUtils.preventDefault(i))}}}}if((i.ctrlKey||i.metaKey)&&i.keyCode=="67"){t=null;var u=p(s);if(u){var b=u.selectedTds;n=u.isFullCol(),r=u.isFullRow(),t=[[u.cloneCell(b[0],null,!0)]];for(var c=1,h;h=b[c];c++)h.parentNode!==b[c-1].parentNode?t.push([u.cloneCell(h,null,!0)]):t[t.length-1].push(u.cloneCell(h,null,!0))}}}),e.addListener("tablehasdeleted",function(){q(this,!1,"",null),E&&domUtils.remove(E)}),e.addListener("beforepaste",function(e,i){var s=this,o=s.selection.getRange();if(domUtils.findParentByTagName(o.startContainer,"caption",!0)){var u=s.document.createElement("div");u.innerHTML=i.html,i.html=u[browser.ie?"innerText":"textContent"];return}var a=p(s);if(t){s.fireEvent("saveScene");var o=s.selection.getRange(),f=domUtils.findParentByTagName(o.startContainer,["td","th"],!0),l,v;if(f){var m=h(f);if(r){var g=m.getCellInfo(f).rowIndex;f.tagName=="TH"&&g++;for(var y=0,b;b=t[y++];){var w=m.insertRow(g++,"td");for(var E=0,S;S=b[E];E++){var x=w.cells[E];x||(x=w.insertCell(E)),x.innerHTML=S.innerHTML,S.getAttribute("width")&&x.setAttribute("width",S.getAttribute("width")),S.getAttribute("vAlign")&&x.setAttribute("vAlign",S.getAttribute("vAlign")),S.getAttribute("align")&&x.setAttribute("align",S.getAttribute("align")),S.style.cssText&&(x.style.cssText=S.style.cssText)}for(var E=0,S;S=w.cells[E];E++){if(!b[E])break;S.innerHTML=b[E].innerHTML,b[E].getAttribute("width")&&S.setAttribute("width",b[E].getAttribute("width")),b[E].getAttribute("vAlign")&&S.setAttribute("vAlign",b[E].getAttribute("vAlign")),b[E].getAttribute("align")&&S.setAttribute("align",b[E].getAttribute("align")),b[E].style.cssText&&(S.style.cssText=b[E].style.cssText)}}}else{if(n){k=m.getCellInfo(f);var T=0;for(var E=0,b=t[0],S;S=b[E++];)T+=S.colSpan||1;s.__hasEnterExecCommand=!0;for(y=0;y<T;y++)s.execCommand("insertcol");s.__hasEnterExecCommand=!1,f=m.table.rows[0].cells[k.cellIndex],f.tagName=="TH"&&(f=m.table.rows[1].cells[k.cellIndex])}for(var y=0,b;b=t[y++];){l=f;for(var E=0,S;S=b[E++];)if(f)f.innerHTML=S.innerHTML,S.getAttribute("width")&&f.setAttribute("width",S.getAttribute("width")),S.getAttribute("vAlign")&&f.setAttribute("vAlign",S.getAttribute("vAlign")),S.getAttribute("align")&&f.setAttribute("align",S.getAttribute("align")),S.style.cssText&&(f.style.cssText=S.style.cssText),v=f,f=f.nextSibling;else{var N=S.cloneNode(!0);domUtils.removeAttributes(N,["class","rowSpan","colSpan"]),v.parentNode.appendChild(N)}f=m.getNextCell(l,!0,!0);if(!t[y])break;if(!f){var k=m.getCellInfo(l);m.table.insertRow(m.table.rows.length),m.update(),f=m.getVSideCell(l,!0)}}}m.update()}else{a=s.document.createElement("table");for(var y=0,b;b=t[y++];){var w=a.insertRow(a.rows.length);for(var E=0,S;S=b[E++];)N=c.cloneCell(S,null,!0),domUtils.removeAttributes(N,["class"]),w.appendChild(N);E==2&&N.rowSpan>1&&(N.rowSpan=1)}var A=d(s),O=s.body.offsetWidth-(C?parseInt(domUtils.getComputedStyle(s.body,"margin-left"),10)*2:0)-A.tableBorder*2-(s.options.offsetWidth||0);s.execCommand("insertHTML","<table  "+(n&&r?'width="'+O+'"':"")+">"+a.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}return s.fireEvent("contentchange"),s.fireEvent("saveScene"),i.html="",!0}var u=s.document.createElement("div"),_;u.innerHTML=i.html,_=u.getElementsByTagName("table"),domUtils.findParentByTagName(s.selection.getStart(),"table")?(utils.each(_,function(e){domUtils.remove(e)}),domUtils.findParentByTagName(s.selection.getStart(),"caption",!0)&&(u.innerHTML=u[browser.ie?"innerText":"textContent"])):utils.each(_,function(e){L(e,!0),domUtils.removeAttributes(e,["style","border"]),utils.each(domUtils.getElementsByTagName(e,"td"),function(e){M(e)&&domUtils.fillNode(s.document,e),L(e,!0)})}),i.html=u.innerHTML}),e.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(e.body,"table"),function(t){if(t.offsetWidth>e.body.offsetWidth){var n=d(e,t);t.style.width=e.body.offsetWidth-(C?parseInt(domUtils.getComputedStyle(e.body,"margin-left"),10)*2:0)-n.tableBorder*2-(e.options.offsetWidth||0)+"px"}})}),e.addListener("blur",function(){t=null});var i;e.addListener("keydown",function(){clearTimeout(i),i=setTimeout(function(){var t=e.selection.getRange(),n=domUtils.findParentByTagName(t.startContainer,["th","td"],!0);if(n){var r=n.parentNode.parentNode.parentNode;r.offsetWidth>r.getAttribute("width")&&(n.style.wordBreak="break-all")}},100)}),e.addListener("selectionchange",function(){q(e,!1,"",null)}),e.addListener("contentchange",function(){var e=this;vt(e);if(p(e))return;var t=e.selection.getRange(),n=t.startContainer;n=domUtils.findParentByTagName(n,["td","th"],!0),utils.each(domUtils.getElementsByTagName(e.document,"table"),function(t){if(e.fireEvent("excludetable",t)===!0)return;t.ueTable=new c(t),utils.each(domUtils.getElementsByTagName(e.document,"td"),function(t){domUtils.isEmptyBlock(t)&&t!==n&&(domUtils.fillNode(e.document,t),browser.ie&&browser.version==6&&(t.innerHTML="&nbsp;"))}),utils.each(domUtils.getElementsByTagName(e.document,"th"),function(t){domUtils.isEmptyBlock(t)&&t!==n&&(domUtils.fillNode(e.document,t),browser.ie&&browser.version==6&&(t.innerHTML="&nbsp;"))}),t.onmouseover=function(){e.fireEvent("tablemouseover",t)},t.onmousemove=function(){e.fireEvent("tablemousemove",t),e.options.tableDragable&&H(!0,this,e)},t.onmouseout=function(){e.fireEvent("tablemouseout",t),q(e,!1,"",null),vt(e)},t.onclick=function(t){t=e.window.event||t;var n=O(t.target||t.srcElement);if(!n)return;var r=h(n),i=r.table,s=r.getCellInfo(n),o,u=e.selection.getRange();if(j(i,n,t,!0)){var a=r.getCell(r.indexTable[r.rowsNum-1][s.colIndex].rowIndex,r.indexTable[r.rowsNum-1][s.colIndex].cellIndex);t.shiftKey&&r.selectedTds.length?r.selectedTds[0]!==a?(o=r.getCellsRange(r.selectedTds[0],a),r.setSelected(o)):u&&u.selectNodeContents(a).select():n!==a?(o=r.getCellsRange(n,a),r.setSelected(o)):u&&u.selectNodeContents(a).select();return}if(j(i,n,t)){var f=r.getCell(r.indexTable[s.rowIndex][r.colsNum-1].rowIndex,r.indexTable[s.rowIndex][r.colsNum-1].cellIndex);t.shiftKey&&r.selectedTds.length?r.selectedTds[0]!==f?(o=r.getCellsRange(r.selectedTds[0],f),r.setSelected(o)):u&&u.selectNodeContents(f).select():n!==f?(o=r.getCellsRange(n,f),r.setSelected(o)):u&&u.selectNodeContents(f).select()}}}),gt(e,!0)}),domUtils.on(e.document,"mousemove",D),domUtils.on(e.document,"mouseout",function(t){var n=t.target||t.srcElement;n.tagName=="TABLE"&&q(e,!1,"",null)}),e.addListener("interlacetable",function(e,t,n){if(!t)return;var r=this,i=t.rows,s=i.length,o=function(e,t,n){return e[t]?e[t]:n?e[t%e.length]:""};for(var u=0;u<s;u++)i[u].className=o(n||r.options.classList,u,!0)}),e.addListener("uninterlacetable",function(e,t){if(!t)return;var n=this,r=t.rows,i=n.options.classList,s=r.length;for(var o=0;o<s;o++)domUtils.removeClasses(r[o],i)}),e.addListener("mousedown",X),e.addListener("mouseup",et),domUtils.on(e.body,"dragstart",function(t){et.call(e,"dragstart",t)});var s=0;e.addListener("mousedown",function(){s=0}),e.addListener("tabkeydown",function(){var t=this.selection.getRange(),n=t.getCommonAncestor(!0,!0),r=domUtils.findParentByTagName(n,"table");if(r){if(domUtils.findParentByTagName(n,"caption",!0)){var i=domUtils.getElementsByTagName(r,"th td");i&&i.length&&t.setStart(i[0],0).setCursor(!1,!0)}else{var i=domUtils.findParentByTagName(n,["td","th"],!0),o=h(i);s=i.rowSpan>1?s:o.getCellInfo(i).rowIndex;var u=o.getTabNextCell(i,s);u?M(u)?t.setStart(u,0).setCursor(!1,!0):t.selectNodeContents(u).select():(e.fireEvent("saveScene"),e.__hasEnterExecCommand=!0
,this.execCommand("insertrownext"),e.__hasEnterExecCommand=!1,t=this.selection.getRange(),t.setStart(r.rows[r.rows.length-1].cells[0],0).setCursor(),e.fireEvent("saveScene"))}return!0}}),browser.ie&&e.addListener("selectionchange",function(){q(this,!1,"",null)}),e.addListener("keydown",function(e,t){var n=this,r=t.keyCode||t.which;if(r==8||r==46)return;var i=!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey;i&&v(domUtils.getElementsByTagName(n.body,"td"));var s=p(n);if(!s)return;i&&s.clearSelected()}),e.addListener("beforegetcontent",function(){gt(this,!1),browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(e){domUtils.isEmptyNode(e)&&(e.innerHTML="&nbsp;")})}),e.addListener("aftergetcontent",function(){gt(this,!0)}),e.addListener("getAllHtml",function(){v(e.document.getElementsByTagName("td"))}),e.addListener("fullscreenchanged",function(t,n){if(!n){var r=this.body.offsetWidth/document.body.offsetWidth,i=domUtils.getElementsByTagName(this.body,"table");utils.each(i,function(t){if(t.offsetWidth<e.body.offsetWidth)return!1;var n=domUtils.getElementsByTagName(t,"td"),i=[];utils.each(n,function(e){i.push(e.offsetWidth)});for(var s=0,o;o=n[s];s++)o.setAttribute("width",Math.floor(i[s]*r));t.setAttribute("width",Math.floor(yt(e,C,d(e))))})}});var o=e.execCommand;e.execCommand=function(e,t){var n=this,r=arguments;e=e.toLowerCase();var i=p(n),s,u=new dom.Range(n.document),a=n.commands[e]||UE.commands[e],f;if(!a)return;if(i&&!k[e]&&!a.notNeedUndo&&!n.__hasEnterExecCommand){n.__hasEnterExecCommand=!0,n.fireEvent("beforeexeccommand",e),s=i.selectedTds;var l=-2,c=-2,h,d;for(var v=0,m;m=s[v];v++){M(m)?u.setStart(m,0).setCursor(!1,!0):u.selectNode(m).select(!0),d=n.queryCommandState(e),h=n.queryCommandValue(e);if(d!=-1){if(l!==d||c!==h)n._ignoreContentChange=!0,f=o.apply(n,arguments),n._ignoreContentChange=!1;l=n.queryCommandState(e),c=n.queryCommandValue(e),domUtils.isEmptyBlock(m)&&domUtils.fillNode(n.document,m)}}u.setStart(s[0],0).shrinkBoundary(!0).setCursor(!1,!0),n.fireEvent("contentchange"),n.fireEvent("afterexeccommand",e),n.__hasEnterExecCommand=!1,n._selectionChange()}else f=o.apply(n,arguments);return f}});var P},UE.plugins.contextmenu=function(){var e=this,t=e.getLang("contextMenu"),n,r=e.options.contextMenu||[{label:t.selectall,cmdName:"selectall"},{label:t.deletecode,cmdName:"highlightcode",icon:"deletehighlightcode"},{label:t.cleardoc,cmdName:"cleardoc",exec:function(){confirm(t.confirmclear)&&this.execCommand("cleardoc")}},"-",{label:t.unlink,cmdName:"unlink"},"-",{group:t.paragraph,icon:"justifyjustify",subMenu:[{label:t.justifyleft,cmdName:"justify",value:"left"},{label:t.justifyright,cmdName:"justify",value:"right"},{label:t.justifycenter,cmdName:"justify",value:"center"},{label:t.justifyjustify,cmdName:"justify",value:"justify"}]},"-",{group:t.table,icon:"table",subMenu:[{label:t.inserttable,cmdName:"inserttable"},{label:t.deletetable,cmdName:"deletetable"},"-",{label:t.deleterow,cmdName:"deleterow"},{label:t.deletecol,cmdName:"deletecol"},{label:t.insertcol,cmdName:"insertcol"},{label:t.insertcolnext,cmdName:"insertcolnext"},{label:t.insertrow,cmdName:"insertrow"},{label:t.insertrownext,cmdName:"insertrownext"},"-",{label:t.insertcaption,cmdName:"insertcaption"},{label:t.deletecaption,cmdName:"deletecaption"},{label:t.inserttitle,cmdName:"inserttitle"},{label:t.deletetitle,cmdName:"deletetitle"},"-",{label:t.mergecells,cmdName:"mergecells"},{label:t.mergeright,cmdName:"mergeright"},{label:t.mergedown,cmdName:"mergedown"},"-",{label:t.splittorows,cmdName:"splittorows"},{label:t.splittocols,cmdName:"splittocols"},{label:t.splittocells,cmdName:"splittocells"},"-",{label:t.averageDiseRow,cmdName:"averagedistributerow"},{label:t.averageDisCol,cmdName:"averagedistributecol"},"-",{label:t.edittd,cmdName:"edittd",exec:function(){UE.ui.edittd&&new UE.ui.edittd(this),this.getDialog("edittd").open()}},{label:t.edittable,cmdName:"edittable",exec:function(){UE.ui.edittable&&new UE.ui.edittable(this),this.getDialog("edittable").open()}}]},{group:t.tablesort,icon:"tablesort",subMenu:[{label:t.reversecurrent,cmdName:"sorttable",value:1},{label:t.orderbyasc,cmdName:"sorttable"},{label:t.reversebyasc,cmdName:"sorttable",exec:function(){this.execCommand("sorttable",function(e,t){var n=e.innerHTML,r=t.innerHTML;return r.localeCompare(n)})}},{label:t.orderbynum,cmdName:"sorttable",exec:function(){this.execCommand("sorttable",function(e,t){var n=e[browser.ie?"innerText":"textContent"].match(/\d+/),r=t[browser.ie?"innerText":"textContent"].match(/\d+/);return n&&(n=+n[0]),r&&(r=+r[0]),(n||0)-(r||0)})}},{label:t.reversebynum,cmdName:"sorttable",exec:function(){this.execCommand("sorttable",function(e,t){var n=e[browser.ie?"innerText":"textContent"].match(/\d+/),r=t[browser.ie?"innerText":"textContent"].match(/\d+/);return n&&(n=+n[0]),r&&(r=+r[0]),(r||0)-(n||0)})}}]},{group:t.borderbk,icon:"borderBack",subMenu:[{label:t.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:t.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:t.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#bbb","#ccc"]})}},{label:t.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:t.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["red","blue"]})}},{label:t.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:t.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:t.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:t.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:t.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:t.tableright,value:"right"}]},"-",{label:t.insertparagraphbefore,cmdName:"insertparagraph",value:!0},{label:t.insertparagraphafter,cmdName:"insertparagraph"},{label:t.copy,cmdName:"copy",exec:function(){alert(t.copymsg)},query:function(){return 0}},{label:t.paste,cmdName:"paste",exec:function(){alert(t.pastemsg)},query:function(){return 0}},{label:t.highlightcode,cmdName:"highlightcode",exec:function(){UE.ui.highlightcode&&new UE.ui.highlightcode(this),this.ui._dialogs.highlightcodeDialog.open()}}];if(!r.length)return;var i=UE.ui.uiUtils;e.addListener("contextmenu",function(s,o){var u=i.getViewportOffsetByEvent(o);e.fireEvent("beforeselectionchange"),n&&n.destroy();for(var a=0,f,l=[];f=r[a];a++){var c;(function(n){if(n=="-")(c=l[l.length-1])&&c!=="-"&&l.push("-");else if(n.hasOwnProperty("group")){for(var r=0,i,s=[];i=n.subMenu[r];r++)(function(t){t=="-"?(c=s[s.length-1])&&c!=="-"?s.push("-"):s.splice(s.length-1):(e.commands[t.cmdName]||UE.commands[t.cmdName]||t.query)&&(t.query?t.query():e.queryCommandState(t.cmdName))>-1&&s.push({label:t.label||e.getLang("contextMenu."+t.cmdName+(t.value||""))||"",className:"edui-for-"+t.cmdName+(t.className?" edui-for-"+t.cmdName+"-"+t.className:""),onclick:t.exec?function(){t.exec.call(e)}:function(){e.execCommand(t.cmdName,t.value)}})})(i);if(s.length){function o(){switch(n.icon){case"table":return e.getLang("contextMenu.table");case"justifyjustify":return e.getLang("contextMenu.paragraph");case"aligntd":return e.getLang("contextMenu.aligntd");case"aligntable":return e.getLang("contextMenu.aligntable");case"tablesort":return t.tablesort;case"borderBack":return t.borderbk;default:return""}}l.push({label:o(),className:"edui-for-"+n.icon,subMenu:{items:s,editor:e}})}}else if((e.commands[n.cmdName]||UE.commands[n.cmdName]||n.query)&&(n.query?n.query.call(e):e.queryCommandState(n.cmdName))>-1){if(n.cmdName=="highlightcode"){if(e.queryCommandState(n.cmdName)==1&&n.icon!="deletehighlightcode")return;if(e.queryCommandState(n.cmdName)!=1&&n.icon=="deletehighlightcode")return}l.push({label:n.label||e.getLang("contextMenu."+n.cmdName),className:"edui-for-"+(n.icon?n.icon:n.cmdName+(n.value||"")),onclick:n.exec?function(){n.exec.call(e)}:function(){e.execCommand(n.cmdName,n.value)}})}})(f)}l[l.length-1]=="-"&&l.pop(),n=new UE.ui.Menu({items:l,className:"edui-contextmenu",editor:e}),n.render(),n.showAt(u),e.fireEvent("aftershowcontextmenu",n),domUtils.preventDefault(o);if(browser.ie){var h;try{h=e.selection.getNative().createRange()}catch(p){return}if(h.item){var d=new dom.Range(e.document);d.selectNode(h.item(0)).select(!0,!0)}}})},UE.plugins.shortcutmenu=function(){var e=this,t,n=e.options.shortcutMenu||[];if(!n.length)return;e.addListener("contextmenu mouseup",function(e,r){var i=this,s={type:e,target:r.target||r.srcElement,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY};setTimeout(function(){var r=i.selection.getRange();if(r.collapsed===!1||e=="contextmenu")t||(t=new baidu.editor.ui.ShortCutMenu({editor:i,items:n,theme:i.options.theme,className:"edui-shortcutmenu"}),t.render(),i.fireEvent("afterrendershortcutmenu",t)),t.show(s,!!UE.plugins.contextmenu)});if(e=="contextmenu"){domUtils.preventDefault(r);if(browser.ie){var o;try{o=i.selection.getNative().createRange()}catch(r){return}if(o.item){var u=new dom.Range(i.document);u.selectNode(o.item(0)).select(!0,!0)}}}e=="keydown"&&t&&!t.isHidden&&t.hide()}),e.addListener("keydown",function(e){e=="keydown"&&t&&!t.isHidden&&t.hide()})},UE.plugins.basestyle=function(){var e={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},t=function(e,t){return domUtils.filterNodeList(e.selection.getStartElementPath(),t)},n=this;n.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"}),n.addInputRule(function(e){utils.each(e.getNodesByTagName("b i"),function(e){switch(e.tagName){case"b":e.tagName="strong";break;case"i":e.tagName="em"}})});for(var r in e)(function(e,r){n.commands[e]={execCommand:function(e){var i=n.selection.getRange(),s=t(this,r);if(i.collapsed){if(s){var o=n.document.createTextNode("");i.insertNode(o).removeInlineStyle(r),i.setStartBefore(o),domUtils.remove(o)}else{var u=i.document.createElement(r[0]);if(e=="superscript"||e=="subscript")o=n.document.createTextNode(""),i.insertNode(o).removeInlineStyle(["sub","sup"]).setStartBefore(o).collapse(!0);i.insertNode(u).setStart(u,0)}i.collapse(!0)}else(e=="superscript"||e=="subscript")&&(!s||s.tagName.toLowerCase()!=e)&&i.removeInlineStyle(["sub","sup"]),s?i.removeInlineStyle(r):i.applyInlineStyle(r[0]);i.select()},queryCommandState:function(){return t(this,r)?1:0}}})(r,e[r])},UE.plugins.elementpath=function(){var e,t,n=this;n.setOpt("elementPathEnabled",!0);if(!n.options.elementPathEnabled)return;n.commands.elementpath={execCommand:function(r,i){var s=t[i],o=n.selection.getRange();e=i*1,o.selectNode(s).select()},queryCommandValue:function(){var n=[].concat(this.selection.getStartElementPath()).reverse(),r=[];t=n;for(var i=0,s;s=n[i];i++){if(s.nodeType==3)continue;var o=s.tagName.toLowerCase();o=="img"&&s.getAttribute("anchorname")&&(o="anchor"),r[i]=o;if(e==i){e=-1;break}}return r}}},UE.plugins.formatmatch=function(){function i(s,o){function a(e){return h&&e.selectNode(h),e.applyInlineStyle(t[t.length-1].tagName,null,t)}if(browser.webkit)var u=o.target.tagName=="IMG"?o.target:null;e.undoManger&&e.undoManger.save();var f=e.selection.getRange(),l=u||f.getClosedNode();if(n&&l&&l.tagName=="IMG")l.style.cssText+=";float:"+(n.style.cssFloat||n.style.styleFloat||"none")+";display:"+(n.style.display||"inline"),n=null;else if(!n){var c=f.collapsed;if(c){var h=e.document.createTextNode("match");f.insertNode(h).select()}e.__hasEnterExecCommand=!0;var p=e.options.removeFormatAttributes;e.options.removeFormatAttributes="",e.execCommand("removeformat"),e.options.removeFormatAttributes=p,e.__hasEnterExecCommand=!1,f=e.selection.getRange(),t.length&&a(f),h&&f.setStartBefore(h).collapse(!0),f.select(),h&&domUtils.remove(h)}e.undoManger&&e.undoManger.save(),e.removeListener("mouseup",i),r=0}var e=this,t=[],n,r=0;e.addListener("reset",function(){t=[],r=0}),e.commands.formatmatch={execCommand:function(s){if(r){r=0,t=[],e.removeListener("mouseup",i);return}var o=e.selection.getRange();n=o.getClosedNode();if(!n||n.tagName!="IMG"){o.collapse(!0).shrinkBoundary();var u=o.startContainer;t=domUtils.findParents(u,!0,function(e){return!domUtils.isBlockElm(e)&&e.nodeType==1});for(var a=0,f;f=t[a];a++)if(f.tagName=="A"){t.splice(a,1);break}}e.addListener("mouseup",i),r=1},queryCommandState:function(){return r},notNeedUndo:1}},UE.plugins.searchreplace=function(){var e,t,n=this;n.addListener("reset",function(){e=null,t=null}),n.commands.searchreplace={execCommand:function(n,r){var i=this,s=i.selection,o,u,a=0,r=utils.extend(r,{all:!1,casesensitive:!1,dir:1},!0),f=r.searchStr;if(browser.ie){i.focus();for(;;){var l;u=i.document.selection.createRange(),l=u.duplicate(),l.moveToElementText(i.document.body),r.all?(t=0,r.dir=1,e?l.setEndPoint(r.dir==-1?"EndToStart":"StartToEnd",e):l.moveToElementText(i.document.body)):(l.setEndPoint(r.dir==-1?"EndToStart":"StartToEnd",u),r.hasOwnProperty("replaceStr")&&l.setEndPoint(r.dir==-1?"StartToEnd":"EndToStart",u)),u=l.duplicate();if(/^\/[^/]+\/\w*$/.test(r.searchStr)){var c=l.text,h=new RegExp(r.searchStr.replace(/^\/|\/\w*$/g,""),"g"+(r.casesensitive?"":"i")),p=c.match(h);if(!p||!p.length)return e=null,a;f=r.dir<0?p[p.length-1]:p[0]}if(!l.findText(f,r.dir,r.casesensitive?4:0))return e=null,l=i.document.selection.createRange(),l.scrollIntoView(),e=null,a;l.select(),r.hasOwnProperty("replaceStr")&&(o=s.getRange(),o.deleteContents().insertNode(o.document.createTextNode(r.replaceStr)).select(),e=s.getNative().createRange()),a++;if(!r.all)break}}else{var d=i.window,v=s.getNative();for(;;){if(r.all)e?(e.collapse(!1),u=e):(u=i.document.createRange(),u.setStart(i.document.body,0),u.collapse(!0)),v.removeAllRanges(),v.addRange(u),t=0,r.dir=1;else{browser.safari&&i.selection.getRange().select();var v=d.getSelection();v.rangeCount?u=v.getRangeAt(0):u=e||i._bakNativeRange,r.hasOwnProperty("replaceStr")&&u.collapse(r.dir==1?!0:!1)}t?v.removeAllRanges():(u.collapse(r.dir<0?!0:!1),v.removeAllRanges(),v.addRange(u));if(/^\/[^/]+\/\w*$/.test(r.searchStr)){var l=u.cloneRange();r.dir<0?(u.collapse(!0),u.setStart(i.body,0)):u.setEnd(i.body,i.body.childNodes.length);var c=u+"",h=new RegExp(r.searchStr.replace(/^\/|\/\w*$/g,""),"g"+(r.casesensitive?"":"i")),p=c.match(h);if(!p||!p.length)return e=null,a;f=r.dir<0?p[p.length-1]:p[0],v.removeAllRanges(),u=l,v.addRange(u)}if(!d.find(f,r.casesensitive,r.dir<0?!0:!1))return e=null,v.removeAllRanges(),a;t=0,o=d.getSelection().getRangeAt(0);if(!o.collapsed){if(r.hasOwnProperty("replaceStr")){o.deleteContents();var m=d.document.createTextNode(r.replaceStr);o.insertNode(m),o.selectNode(m),v.addRange(o)}e=o.cloneRange()}a++;if(!r.all)break}}return!0}}},UE.plugins.customstyle=function(){var e=this;e.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]}),e.commands.customstyle={execCommand:function(e,t){var n=this,r=t.tag,i=domUtils.findParent(n.selection.getStart(),function(e){return e.getAttribute("label")},!0),s,o,u={};for(var a in t)t[a]!==undefined&&(u[a]=t[a]);delete u.tag;if(i&&i.getAttribute("label")==t.label){s=this.selection.getRange(),o=s.createBookmark();if(s.collapsed)if(dtd.$block[i.tagName]){var f=n.document.createElement("p");domUtils.moveChild(i,f),i.parentNode.insertBefore(f,i),domUtils.remove(i)}else domUtils.remove(i,!0);else{var l=domUtils.getCommonAncestor(o.start,o.end),c=domUtils.getElementsByTagName(l,r);(new RegExp(r,"i")).test(l.tagName)&&c.push(l);for(var h=0,p;p=c[h++];)if(p.getAttribute("label")==t.label){var d=domUtils.getPosition(p,o.start),v=domUtils.getPosition(p,o.end);if((d&domUtils.POSITION_FOLLOWING||d&domUtils.POSITION_CONTAINS)&&(v&domUtils.POSITION_PRECEDING||v&domUtils.POSITION_CONTAINS)&&dtd.$block[r]){var f=n.document.createElement("p");domUtils.moveChild(p,f),p.parentNode.insertBefore(f,p)}domUtils.remove(p,!0)}i=domUtils.findParent(l,function(e){return e.getAttribute("label")==t.label},!0),i&&domUtils.remove(i,!0)}s.moveToBookmark(o).select()}else if(dtd.$block[r]){this.execCommand("paragraph",r,u,"customstyle"),s=n.selection.getRange();if(!s.collapsed){s.collapse(),i=domUtils.findParent(n.selection.getStart(),function(e){return e.getAttribute("label")==t.label},!0);var m=n.document.createElement("p");domUtils.insertAfter(i,m),domUtils.fillNode(n.document,m),s.setStart(m,0).setCursor()}}else{s=n.selection.getRange();if(s.collapsed){i=n.document.createElement(r),domUtils.setAttributes(i,u),s.insertNode(i).setStart(i,0).setCursor();return}o=s.createBookmark(),s.applyInlineStyle(r,u).moveToBookmark(o).select()}},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return e.getAttribute("label")});return e?e.getAttribute("label"):""}},e.addListener("keyup",function(t,n){var r=n.keyCode||n.which;if(r==32||r==13){var i=e.selection.getRange();if(i.collapsed){var s=domUtils.findParent(e.selection.getStart(),function(e){return e.getAttribute("label")},!0);if(s&&dtd.$block[s.tagName]&&domUtils.isEmptyNode(s)){var o=e.document.createElement("p");domUtils.insertAfter(s,o),domUtils.fillNode(e.document,o),domUtils.remove(s),i.setStart(o,0).setCursor()}}}})},UE.plugins.catchremoteimage=function(){function catchremoteimage(e,t){var n=e.join(separater),r={timeout:6e4,onsuccess:t.success,onerror:t.error};r[me.options.catchFieldName]=n,ajax.request(catcherUrl,r)}if(this.options.catchRemoteImageEnable===!1)return;var me=this;this.setOpt({localDomain:["127.0.0.1","localhost","img.baidu.com"],separater:"ue_separate_ue",catchFieldName:"upfile",catchRemoteImageEnable:!0});var ajax=UE.ajax,localDomain=me.options.localDomain,catcherUrl=me.options.catcherUrl,separater=me.options.separater;me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")}),me.addListener("catchRemoteImage",function(){var remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,"img"),test=function(e,t){for(var n=0,r;r=t[n++];)if(e.indexOf(r)!==-1)return!0;return!1};for(var i=0,ci;ci=imgs[i++];){if(ci.getAttribute("word_img"))continue;var src=ci.getAttribute("_src")||ci.src||"";/^(https?|ftp):/i.test(src)&&!test(src,localDomain)&&remoteImages.push(src)}remoteImages.length&&catchremoteimage(remoteImages,{success:function(xhr){try{var info=eval("("+xhr.responseText+")")}catch(e){return}var srcUrls=info.srcUrl.split(separater),urls=info.url.split(separater);for(var i=0,ci;ci=imgs[i++];){var src=ci.getAttribute("_src")||ci.src||"";for(var j=0,cj;cj=srcUrls[j++];){var url=urls[j-1];if(src==cj&&url!="error"){var newSrc=me.options.catcherPath+url;domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}}}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})})},UE.plugins.snapscreen=function(){var me=this,doc,snapplugin;me.setOpt({snapscreenServerPort:location.port,snapscreenImgAlign:"",snapscreenHost:location.hostname}),me.commands.snapscreen={execCommand:function(){var me=this,lang=me.getLang("snapScreen_plugin");if(!snapplugin){var container=me.container;doc=container.ownerDocument||container.document,snapplugin=doc.createElement("object");try{snapplugin.type="application/x-pluginbaidusnap"}catch(e){return}snapplugin.style.cssText="position:absolute;left:-9999px;",snapplugin.setAttribute("width","0"),snapplugin.setAttribute("height","0"),container.appendChild(snapplugin)}var editorOptions=me.options,onSuccess=function(rs){try{rs=eval("("+rs+")")}catch(e){alert(lang.callBackErrorMsg);return}if(rs.state!="SUCCESS"){alert(rs.state);return}me.execCommand("insertimage",{src:editorOptions.snapscreenPath+rs.url,floatStyle:editorOptions.snapscreenImgAlign,_src:editorOptions.snapscreenPath+rs.url})},onStartUpload=function(){},onError=function(){alert(lang.uploadErrorMsg)};try{var port=editorOptions.snapscreenServerPort+"";editorOptions.snapscreenServerUrl=editorOptions.snapscreenServerUrl.split(editorOptions.snapscreenHost),editorOptions.snapscreenServerUrl=editorOptions.snapscreenServerUrl[1]||editorOptions.snapscreenServerUrl[0],editorOptions.snapscreenServerUrl.indexOf(":"+port)===0&&(editorOptions.snapscreenServerUrl=editorOptions.snapscreenServerUrl.substring(port.length+1));var ret=snapplugin.saveSnapshot(editorOptions.snapscreenHost,editorOptions.snapscreenServerUrl,port);onSuccess(ret)}catch(e){me.ui._dialogs.snapscreenDialog.open()}}}},UE.commands.insertparagraph={execCommand:function(e,t){var n=this,r=n.selection.getRange(),i=r.startContainer,s;while(i){if(domUtils.isBody(i))break;s=i,i=i.parentNode}if(s){var o=n.document.createElement("p");t?s.parentNode.insertBefore(o,s):s.parentNode.insertBefore(o,s.nextSibling),domUtils.fillNode(n.document,o),r.setStart(o,0).setCursor(!1,!0)}}},UE.plugins.webapp=function(){function t(t,n,r){return n?'<iframe class="edui-faked-webapp" title="'+t.title+'" width="'+t.width+'" height="'+t.height+'"  scrolling="no" frameborder="0" src="'+t.url+'" logo_url = '+t.logo+"></iframe>":(r?"<p>":"")+'<img title="'+t.title+'" width="'+t.width+'" height="'+t.height+'"'+' src="'+e.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+t.logo+') no-repeat center center; border:1px solid gray;" class="edui-faked-webapp" _url="'+t.url+'" />'+(r?"</p>":"")}function n(n){var r,i=domUtils.getElementsByTagName(e.document,n?"img":"iframe");for(var s=0,o;o=i[s++];){if(o.className!="edui-faked-webapp")continue;r=e.document.createElement("div"),r.innerHTML=t(n?{url:o.getAttribute("_url"),width:o.width,height:o.height,title:o.title,logo:o.style.backgroundImage.replace("url(","").replace(")","")}:{url:o.getAttribute("src",2),title:o.title,width:o.width,height:o.height,logo:o.getAttribute("logo_url")},n?!0:!1,!1),o.parentNode.replaceChild(r.firstChild,o)}}var e=this;e.addListener("beforegetcontent",function(){n(!0)}),e.addListener("aftersetcontent",function(){n(!1)}),e.addListener("aftergetcontent",function(t){if(t=="aftergetcontent"&&e.queryCommandState("source"))return;n(!1)}),e.commands.webapp={execCommand:function(n,r){e.execCommand("inserthtml",t(r,!1,!0))}}},UE.plugins.template=function(){UE.commands.template={execCommand:function(e,t){t.html&&this.execCommand("inserthtml",t.html)}},this.addListener("click",function(e,t){var n=t.target||t.srcElement,r=this.selection.getRange(),i=domUtils.findParent(n,function(e){if(e.className&&domUtils.hasClass(e,"ue_t"))return e},!0);i&&r.selectNode(i).shrinkBoundary().select()}),this.addListener("keydown",function(e,t){var n=this.selection.getRange();if(!n.collapsed&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){var r=domUtils.findParent(n.startContainer,function(e){if(e.className&&domUtils.hasClass(e,"ue_t"))return e},!0);r&&domUtils.removeClasses(r,["ue_t"])}})},UE.plugins.music=function(){function n(t,n,r,i,s,o){return s?'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+n+'" height="'+r+'" align="'+i+'"'+(i!="none"?' style= "'+(i=="center"?"display:block;":" float: "+i)+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':(o?"<p "+(i!="none"?i=="center"?' style="text-align:center;" ':' style="float:"'+i:"")+">":"")+'<img align="'+i+'" width="'+n+'" height="'+r+'" _url="'+t+'" class="edui-faked-music"'+' src="'+e.options.langPath+e.options.lang+'/images/music.png" />'+(o?"</p>":"")}function r(t){var r,i=domUtils.getElementsByTagName(e.document,t?"img":"embed");for(var s=0,o;o=i[s++];){if(o.className!="edui-faked-music")continue;r=e.document.createElement("div");var u=domUtils.getComputedStyle(o,"float");u=u=="none"?o.getAttribute("align")||"":u,r.innerHTML=n(t?o.getAttribute("_url"):o.getAttribute("src"),o.width,o.height,u,t),o.parentNode.replaceChild(r.firstChild,o)}}var e=this,t;e.addListener("beforegetcontent",function(){r(!0)}),e.addListener("aftersetcontent",function(){r(!1)}),e.addListener("aftergetcontent",function(t){if(t=="aftergetcontent"&&e.queryCommandState("source"))return;r(!1)}),e.commands.music={execCommand:function(e,t){var r=this,i=n(t.url,t.width||400,t.height||95,"none",!1,!0);r.execCommand("inserthtml",i)},queryCommandState:function(){var e=this,t=e.selection.getRange().getClosedNode(),n=t&&t.className=="edui-faked-music";return n?1:0}}};var baidu=baidu||{};baidu.editor=baidu.editor||{},baidu.editor.ui={},function(){function u(){var e=document.getElementById("edui_fixedlayer");o.setViewportOffset(e,{left:0,top:0})}function a(e){t.on(window,"scroll",u),t.on(window,"resize",baidu.editor.utils.defer(u,0,!0))}var e=baidu.editor.browser,t=baidu.editor.dom.domUtils,n="$EDITORUI",r=window[n]={},i="ID"+n,s=0,o=baidu.editor.ui.uiUtils={uid:function(e){return e?e[i]||(e[i]=++s):++s},hook:function(e,t){var n;return e&&e._callbacks?n=e:(n=function(){var t;e&&(t=e.apply(this,arguments));var r=n._callbacks,i=r.length;while(i--){var s=r[i].apply(this,arguments);t===undefined&&(t=s)}return t},n._callbacks=[]),n._callbacks.push(t),n},createElementByHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,t=t.firstChild,t.parentNode.removeChild(t),t},getViewportElement:function(){return e.ie&&e.quirks?document.body:document.documentElement},getClientRect:function(e){var n;try{n=e.getBoundingClientRect()}catch(r){n={left:0,top:0,height:0,width:0}}var i={left:Math.round(n.left),top:Math.round(n.top),height:Math.round(n.bottom-n.top),width:Math.round(n.right-n.left)},s;while((s=e.ownerDocument)!==document&&(e=t.getWindow(s).frameElement))n=e.getBoundingClientRect(),i.left+=n.left,i.top+=n.top;return i.bottom=i.top+i.height,i.right=i.left+i.width,i},getViewportRect:function(){var e=o.getViewportElement(),t=(window.innerWidth||e.clientWidth)|0,n=(window.innerHeight||e.clientHeight)|0;return{left:0,top:0,height:n,width:t,bottom:n,right:t}},setViewportOffset:function(e,n){var r,i=o.getFixedLayer();e.parentNode===i?(e.style.left=n.left+"px",e.style.top=n.top+"px"):t.setViewportOffset(e,n)},getEventOffset:function(e){var t=e.target||e.srcElement,n=o.getClientRect(t),r=o.getViewportOffsetByEvent(e);return{left:r.left-n.left,top:r.top-n.top}},getViewportOffsetByEvent:function(e){var n=e.target||e.srcElement,r=t.getWindow(n).frameElement,i={left:e.clientX,top:e.clientY};if(r&&n.ownerDocument!==document){var s=o.getClientRect(r);i.left+=s.left,i.top+=s.top}return i},setGlobal:function(e,t){return r[e]=t,n+'["'+e+'"]'},unsetGlobal:function(e){delete r[e]},copyAttributes:function(n,r){var i=r.attributes,s=i.length;while(s--){var o=i[s];o.nodeName!="style"&&o.nodeName!="class"&&(!e.ie||o.specified)&&n.setAttribute(o.nodeName,o.nodeValue)}r.className&&t.addClass(n,r.className),r.style.cssText&&(n.style.cssText+=";"+r.style.cssText)},removeStyle:function(e,t){if(e.style.removeProperty)e.style.removeProperty(t);else{if(!e.style.removeAttribute)throw"";e.style.removeAttribute(t)}},contains:function(e,t){return e&&t&&(e===t?!1:e.contains?e.contains(t):e.compareDocumentPosition(t)&16)},startDrag:function(e,t,n){function s(e){var n=e.clientX-r,s=e.clientY-i;t.ondragmove(n,s,e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}var n=n||document,r=e.clientX,i=e.clientY;if(n.addEventListener){function o(e){n.removeEventListener("mousemove",s,!0),n.removeEventListener("mouseup",o,!0),window.removeEventListener("mouseup",o,!0),t.ondragstop()}n.addEventListener("mousemove",s,!0),n.addEventListener("mouseup",o,!0),window.addEventListener("mouseup",o,!0),e.preventDefault()}else{var u=e.srcElement;u.setCapture();function a(){u.releaseCapture(),u.detachEvent("onmousemove",s),u.detachEvent("onmouseup",a),u.detachEvent("onlosecaptrue",a),t.ondragstop()}u.attachEvent("onmousemove",s),u.attachEvent("onmouseup",a),u.attachEvent("onlosecaptrue",a),e.returnValue=!1}t.ondragstart()},getFixedLayer:function(){var t=document.getElementById("edui_fixedlayer");return t==null&&(t=document.createElement("div"),t.id="edui_fixedlayer",document.body.appendChild(t),e.ie&&e.version<=8?(t.style.position="absolute",a(),setTimeout(u)):t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0"),t},makeUnselectable:function(t){if(e.opera||e.ie&&e.version<9){t.unselectable="on";if(t.hasChildNodes())for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==1&&o.makeUnselectable(t.childNodes[n])}else t.style.MozUserSelect!==undefined?t.style.MozUserSelect="none":t.style.WebkitUserSelect!==undefined?t.style.WebkitUserSelect="none":t.style.KhtmlUserSelect!==undefined&&(t.style.KhtmlUserSelect="none")}}}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.EventBase,r=baidu.editor.ui.UIBase=function(){};r.prototype={className:"",uiName:"",initOptions:function(e){var n=this;for(var r in e)n[r]=e[r];this.id=this.id||"edui"+t.uid()},initUIBase:function(){this._globalKey=e.unhtml(t.setGlobal(this.id,this))},render:function(e){var n=this.renderHtml(),r=t.createElementByHtml(n),i=domUtils.getElementsByTagName(r,"*"),s="edui-"+(this.theme||this.editor.options.theme),o=document.getElementById("edui_fixedlayer");for(var u=0,a;a=i[u++];)domUtils.addClass(a,s);domUtils.addClass(r,s),o&&(o.className="",domUtils.addClass(o,s));var f=this.getDom();f!=null?(f.parentNode.replaceChild(r,f),t.copyAttributes(r,f)):(typeof e=="string"&&(e=document.getElementById(e)),e=e||t.getFixedLayer(),domUtils.addClass(e,s),e.appendChild(r)),this.postRender()},getDom:function(e){return e?document.getElementById(this.id+"_"+e):document.getElementById(this.id)},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(e){var t="edui-"+this.uiName;return e.replace(/##/g,this.id).replace(/%%-/g,this.uiName?t+"-":"").replace(/%%/g,(this.uiName?t:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var e=this.getDom();e&&baidu.editor.dom.domUtils.remove(e),t.unsetGlobal(this.id)}},e.inherits(r,n)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Separator=function(e){this.initOptions(e),this.initSeparator()};n.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}},e.inherits(n,t)}(),function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.uiUtils,i=baidu.editor.ui.Mask=function(e){this.initOptions(e),this.initUIBase()};i.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var e=this;t.on(window,"resize",function(){setTimeout(function(){e.isHidden()||e._fill()})})},show:function(e){this._fill(),this.getDom().style.display="",this.getDom().style.zIndex=e},hide:function(){this.getDom().style.display="none",this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return!1},_fill:function(){var e=this.getDom(),t=r.getViewportRect();e.style.width=t.width+"px",e.style.height=t.height+"px"}},e.inherits(i,n)}(),function(){function o(e,t){for(var n=0;n<s.length;n++){var r=s[n];if(!r.isHidden()&&r.queryAutoHide(t)!==!1){if(e&&/scroll/ig.test(e.type)&&r.className=="edui-wordpastepop")return;r.hide()}}s.length&&r.editor.fireEvent("afterhidepop")}var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.dom.domUtils,r=baidu.editor.ui.UIBase,i=baidu.editor.ui.Popup=function(e){this.initOptions(e),this.initPopup()},s=[];i.postHide=o;var u=["edui-anchor-topleft"
,"edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];i.prototype={SHADOW_RADIUS:5,content:null,_hidden:!1,autoRender:!0,canSideLeft:!0,canSideUp:!0,initPopup:function(){this.initUIBase(),s.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>"},getContentHtmlTpl:function(){return this.content?typeof this.content=="string"?this.content:this.content.renderHtml():""},_UIBase_postRender:r.prototype.postRender,postRender:function(){this.content instanceof r&&this.content.postRender();if(this.captureWheel&&!this.captured){this.captured=!0;var e=(document.documentElement.clientHeight||document.body.clientHeight)-80,t=this.getDom().offsetHeight,i=n.getXY(this.combox.getDom()).y,s=this.getDom("content"),o=this;while(i+t>e)t-=30,s.style.height=t+"px";window.XMLHttpRequest?n.on(s,"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,e.wheelDelta?s.scrollTop-=e.wheelDelta/120*60:s.scrollTop-=e.detail/-3*60}):n.on(this.getDom(),"mousewheel",function(e){e.returnValue=!1,o.getDom("content").scrollTop-=e.wheelDelta/120*60})}this.fireEvent("postRenderAfter"),this.hide(!0),this._UIBase_postRender()},_doAutoRender:function(){!this.getDom()&&this.autoRender&&this.render()},mesureSize:function(){var e=this.getDom("content");return t.getClientRect(e)},fitSize:function(){if(this.captureWheel&&this.sized)return this.__size;this.sized=!0;var e=this.getDom("body");e.style.width="",e.style.height="";var t=this.mesureSize();return this.captureWheel?e.style.width=-(-20-t.width)+"px":e.style.width=t.width+"px",e.style.height=t.height+"px",this.__size=t,this.captureWheel&&(this.getDom("content").style.overflow="auto"),t},showAnchor:function(e,n){this.showAnchorRect(t.getClientRect(e),n)},showAnchorRect:function(e,r,i){this._doAutoRender();var s=t.getViewportRect();this._show();var o=this.fitSize(),a,f,l,c;r?(a=this.canSideLeft&&e.right+o.width>s.right&&e.left>o.width,f=this.canSideUp&&e.top+o.height>s.bottom&&e.bottom>o.height,l=a?e.left-o.width:e.right,c=f?e.bottom-o.height:e.top):(a=this.canSideLeft&&e.right+o.width>s.right&&e.left>o.width,f=this.canSideUp&&e.top+o.height>s.bottom&&e.bottom>o.height,l=a?e.right-o.width:e.left,c=f?e.top-o.height:e.bottom);var h=this.getDom();t.setViewportOffset(h,{left:l,top:c}),n.removeClasses(h,u),h.className+=" "+u[(f?1:0)*2+(a?1:0)],this.editor&&(h.style.zIndex=this.editor.container.style.zIndex*1+10,baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=h.style.zIndex-1)},showAt:function(e){var t=e.left,n=e.top,r={left:t,top:n,right:t,bottom:n,height:0,width:0};this.showAnchorRect(r,!1,!0)},_show:function(){if(this._hidden){var e=this.getDom();e.style.display="",this._hidden=!1,this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender(),this._show()},hide:function(e){!this._hidden&&this.getDom()&&(this.getDom().style.display="none",this._hidden=!0,e||this.fireEvent("hide"))},queryAutoHide:function(e){return!e||!t.contains(this.getDom(),e)}},e.inherits(i,r),n.on(document,"mousedown",function(e){var t=e.target||e.srcElement;o(e,t)}),n.on(window,"scroll",function(e,t){o(e,t)})}(),function(){function i(e,t){var n='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+e+"</div>"+"</div>"+'<table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0">'+'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+t.getLang("themeColor")+"</td> </tr>"+'<tr class="edui-colorpicker-tablefirstrow" >';for(var i=0;i<r.length;i++)i&&i%10===0&&(n+="</tr>"+(i==60?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+t.getLang("standardColor")+"</td></tr>":"")+"<tr"+(i==60?' class="edui-colorpicker-tablefirstrow"':"")+">"),n+=i<70?'<td style="padding: 0 2px;"><a hidefocus title="'+r[i]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell"'+' data-color="#'+r[i]+'"'+' style="background-color:#'+r[i]+";border:solid #ccc;"+(i<10||i>=60?"border-width:1px;":i>=10&&i<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":"";return n+="</tr></table></div>",n}var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.ColorPicker=function(e){this.initOptions(e),this.noColorText=this.noColorText||this.editor.getLang("clearColor"),this.initUIBase()};n.prototype={getHtmlTpl:function(){return i(this.noColorText,this.editor)},_onTableClick:function(e){var t=e.target||e.srcElement,n=t.getAttribute("data-color");n&&this.fireEvent("pickcolor",n)},_onTableOver:function(e){var t=e.target||e.srcElement,n=t.getAttribute("data-color");n&&(this.getDom("preview").style.backgroundColor=n)},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}},e.inherits(n,t);var r="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(",")}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.TablePicker=function(e){this.initOptions(e),this.initTablePicker()};r.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this;return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-infoarea"><span id="##_label" class="edui-label"></span></div><div class="edui-pickarea" onmousemove="$$._onMouseMove(event, this);" onmouseover="$$._onMouseOver(event, this);" onmouseout="$$._onMouseOut(event, this);" onclick="$$._onClick(event, this);"><div id="##_overlay" class="edui-overlay"></div></div></div></div>'},_UIBase_render:n.prototype.render,render:function(e){this._UIBase_render(e),this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(e,t){var n=this.getDom("overlay").style,r=this.lengthOfCellSide;n.width=e*r+"px",n.height=t*r+"px";var i=this.getDom("label");i.innerHTML=e+this.editor.getLang("t_col")+" x "+t+this.editor.getLang("t_row"),this.numCols=e,this.numRows=t},_onMouseOver:function(e,n){var r=e.relatedTarget||e.fromElement;!t.contains(n,r)&&n!==r&&(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="")},_onMouseOut:function(e,n){var r=e.relatedTarget||e.toElement;!t.contains(n,r)&&n!==r&&(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="hidden")},_onMouseMove:function(e,n){var r=this.getDom("overlay").style,i=t.getEventOffset(e),s=this.lengthOfCellSide,o=Math.ceil(i.left/s),u=Math.ceil(i.top/s);this._track(o,u)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}},e.inherits(r,n)}(),function(){var e=baidu.editor.browser,t=baidu.editor.dom.domUtils,n=baidu.editor.ui.uiUtils,r='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(e.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:!1,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl,this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var e=this._Stateful_dGetHtmlTpl();return e.replace(/stateful/g,function(){return r})},Stateful_onMouseEnter:function(e,t){this.target=t;if(!this.isDisabled()||this.alwalysHoverable)this.addState("hover"),this.fireEvent("over")},Stateful_onMouseLeave:function(e,t){if(!this.isDisabled()||this.alwalysHoverable)this.removeState("hover"),this.removeState("active"),this.fireEvent("out")},Stateful_onMouseOver:function(e,t){var r=e.relatedTarget;!n.contains(t,r)&&t!==r&&this.Stateful_onMouseEnter(e,t)},Stateful_onMouseOut:function(e,t){var r=e.relatedTarget;!n.contains(t,r)&&t!==r&&this.Stateful_onMouseLeave(e,t)},Stateful_onMouseDown:function(e,t){this.isDisabled()||this.addState("active")},Stateful_onMouseUp:function(e,t){this.isDisabled()||this.removeState("active")},Stateful_postRender:function(){this.disabled&&!this.hasState("disabled")&&this.addState("disabled")},hasState:function(e){return t.hasClass(this.getStateDom(),"edui-state-"+e)},addState:function(e){this.hasState(e)||(this.getStateDom().className+=" edui-state-"+e)},removeState:function(e){this.hasState(e)&&t.removeClasses(this.getStateDom(),["edui-state-"+e])},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(e){!this.isDisabled()&&e?this.addState("checked"):this.removeState("checked")},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(e){e?(this.removeState("hover"),this.removeState("checked"),this.removeState("active"),this.addState("disabled")):this.removeState("disabled")}}}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Stateful,r=baidu.editor.ui.Button=function(e){this.initOptions(e),this.initButton()};r.prototype={uiName:"button",label:"",title:"",showIcon:!0,showText:!0,initButton:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return false;" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>"},postRender:function(){this.Stateful_postRender(),this.setDisabled(this.disabled)},_onClick:function(){this.isDisabled()||this.fireEvent("click")}},e.inherits(r,t),e.extend(r.prototype,n)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.dom.domUtils,r=baidu.editor.ui.UIBase,i=baidu.editor.ui.Stateful,s=baidu.editor.ui.SplitButton=function(e){this.initOptions(e),this.initSplitButton()};s.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase(),this.Stateful_init();var e=this;if(this.popup!=null){var t=this.popup;this.popup=null,this.setPopup(t)}},_UIBase_postRender:r.prototype.postRender,postRender:function(){this.Stateful_postRender(),this._UIBase_postRender()},setPopup:function(n){if(this.popup===n)return;this.popup!=null&&this.popup.dispose(),n.addListener("show",e.bind(this._onPopupShow,this)),n.addListener("hide",e.bind(this._onPopupHide,this)),n.addListener("postrender",e.bind(function(){n.getDom("body").appendChild(t.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(t.getClientRect(this.getDom()).width+20)+'px"></div>')),n.getDom().className+=" "+this.className},this)),this.popup=n},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body">'+'<div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);">'+'<div class="edui-box edui-icon"></div>'+"</div>"+'<div class="edui-box edui-splitborder"></div>'+'<div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div>'+"</div></div></div>"},showPopup:function(){var e=t.getClientRect(this.getDom());e.top-=this.popup.SHADOW_RADIUS,e.height+=this.popup.SHADOW_RADIUS,this.popup.showAnchorRect(e)},_onArrowClick:function(e,t){this.isDisabled()||this.showPopup()},_onButtonClick:function(){this.isDisabled()||this.fireEvent("buttonclick")}},e.inherits(s,r),e.extend(s.prototype,i,!0)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.ColorPicker,r=baidu.editor.ui.Popup,i=baidu.editor.ui.SplitButton,s=baidu.editor.ui.ColorButton=function(e){this.initOptions(e),this.initColorButton()};s.prototype={initColorButton:function(){var e=this;this.popup=new r({content:new n({noColorText:e.editor.getLang("clearColor"),editor:e.editor,onpickcolor:function(t,n){e._onPickColor(n)},onpicknocolor:function(t,n){e._onPickNoColor(n)}}),editor:e.editor}),this.initSplitButton()},_SplitButton_postRender:i.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.getDom("button_body").appendChild(t.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>')),this.getDom().className+=" edui-colorbutton"},setColor:function(e){this.getDom("colorlump").style.backgroundColor=e,this.color=e},_onPickColor:function(e){this.fireEvent("pickcolor",e)!==!1&&(this.setColor(e),this.popup.hide())},_onPickNoColor:function(e){this.fireEvent("picknocolor")!==!1&&this.popup.hide()}},e.inherits(s,i)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,n=baidu.editor.ui.TablePicker,r=baidu.editor.ui.SplitButton,i=baidu.editor.ui.TableButton=function(e){this.initOptions(e),this.initTableButton()};i.prototype={initTableButton:function(){var e=this;this.popup=new t({content:new n({editor:e.editor,onpicktable:function(t,n,r){e._onPickTable(n,r)}}),editor:e.editor}),this.initSplitButton()},_onPickTable:function(e,t){this.fireEvent("picktable",e,t)!==!1&&this.popup.hide()}},e.inherits(i,r)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.AutoTypeSetPicker=function(e){this.initOptions(e),this.initAutoTypeSetPicker()};n.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this.editor,t=e.options.autotypeset,n=e.getLang("autoTypeSet"),r="textAlignValue"+e.uid,i="imageBlockLineValue"+e.uid;return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap colspan="2"><input type="checkbox" name="mergeEmptyline" '+(t.mergeEmptyline?"checked":"")+">"+n.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(t.removeEmptyline?"checked":"")+">"+n.delLine+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="removeClass" '+(t.removeClass?"checked":"")+">"+n.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(t.indent?"checked":"")+">"+n.indent+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="textAlign" '+(t.textAlign?"checked":"")+">"+n.alignment+'</td><td colspan="2" id="'+r+'"><input type="radio" name="'+r+'" value="left" '+(t.textAlign&&t["textAlign"]=="left"?"checked":"")+">"+e.getLang("justifyleft")+'<input type="radio" name="'+r+'" value="center" '+(t.textAlign&&t["textAlign"]=="center"?"checked":"")+">"+e.getLang("justifycenter")+'<input type="radio" name="'+r+'" value="right" '+(t.textAlign&&t["textAlign"]=="right"?"checked":"")+">"+e.getLang("justifyright")+" </tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="imageBlockLine" '+(t.imageBlockLine?"checked":"")+">"+n.imageFloat+"</td>"+'<td nowrap colspan="2" id="'+i+'">'+'<input type="radio" name="'+i+'" value="none" '+(t.imageBlockLine&&t["imageBlockLine"]=="none"?"checked":"")+">"+e.getLang("default")+'<input type="radio" name="'+i+'" value="left" '+(t.imageBlockLine&&t["imageBlockLine"]=="left"?"checked":"")+">"+e.getLang("justifyleft")+'<input type="radio" name="'+i+'" value="center" '+(t.imageBlockLine&&t["imageBlockLine"]=="center"?"checked":"")+">"+e.getLang("justifycenter")+'<input type="radio" name="'+i+'" value="right" '+(t.imageBlockLine&&t["imageBlockLine"]=="right"?"checked":"")+">"+e.getLang("justifyright")+"</tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="clearFontSize" '+(t.clearFontSize?"checked":"")+">"+n.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(t.clearFontFamily?"checked":"")+">"+n.removeFontFamily+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="removeEmptyNode" '+(t.removeEmptyNode?"checked":"")+">"+n.removeHtml+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="pasteFilter" '+(t.pasteFilter?"checked":"")+">"+n.pasteFilter+"</td></tr>"+'<tr><td nowrap colspan="4" align="right"><button >'+n.run+"</button></td></tr>"+"</table>"+"</div>"+"</div>"},_UIBase_render:t.prototype.render},e.inherits(n,t)}(),function(){function s(e){var t=e.editor.options.autotypeset,n=e.getDom(),r=e.editor.uid,i=null,s=null,o=domUtils.getElementsByTagName(n,"input");for(var u=o.length-1,a;a=o[u--];){i=a.getAttribute("type");if(i=="checkbox"){s=a.getAttribute("name"),t[s]&&delete t[s];if(a.checked){var f=document.getElementById(s+"Value"+r);if(f)if(/input/ig.test(f.tagName))t[s]=f.value;else{var l=f.getElementsByTagName("input");for(var c=l.length-1,h;h=l[c--];)if(h.checked){t[s]=h.value;break}}else t[s]=!0}}}var p=domUtils.getElementsByTagName(n,"select");for(var u=0,d;d=p[u++];){var v=d.getAttribute("name");t[v]=t[v]?d.value:""}e.editor.options.autotypeset=t}var e=baidu.editor.utils,t=baidu.editor.ui.Popup,n=baidu.editor.ui.AutoTypeSetPicker,r=baidu.editor.ui.SplitButton,i=baidu.editor.ui.AutoTypeSetButton=function(e){this.initOptions(e),this.initAutoTypeSetButton()};i.prototype={initAutoTypeSetButton:function(){var e=this;this.popup=new t({content:new n({editor:e.editor}),editor:e.editor,hide:function(){!this._hidden&&this.getDom()&&(s(this),this.getDom().style.display="none",this._hidden=!0,this.fireEvent("hide"))}});var r=0;this.popup.addListener("postRenderAfter",function(){var t=this;if(r)return;var n=this.getDom(),i=n.getElementsByTagName("button")[0];i.onclick=function(){s(t),e.editor.execCommand("autotypeset"),t.hide()},r=1}),this.initSplitButton()}},e.inherits(i,r)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,n=baidu.editor.ui.Stateful,r=baidu.editor.ui.UIBase,i=baidu.editor.ui.CellAlignPicker=function(e){this.initOptions(e),this.initSelected(),this.initCellAlignPicker()};i.prototype={initSelected:function(){var e={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3},t=-1;this.selected&&(this.selectedIndex=e.valign[this.selected.valign]*e.count+e.align[this.selected.align])},initCellAlignPicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){var e=["left","center","right"],t=9,n=null,r=-1,i=[];for(var s=0;s<t;s++)n=this.selectedIndex===s?' class="edui-cellalign-selected" ':"",r=s%3,r===0&&i.push("<tr>"),i.push('<td index="'+s+'" '+n+' stateful><div class="edui-icon edui-'+e[r]+'"></div></td>'),r===2&&i.push("</tr>");return'<div id="##" class="edui-cellalignpicker %%"><div class="edui-cellalignpicker-body"><table onclick="$$._onClick(event);">'+i.join("")+"</table>"+"</div>"+"</div>"},getStateDom:function(){return this.target},_onClick:function(e){var n=e.target||e.srcElement;/icon/.test(n.className)&&(this.items[n.parentNode.getAttribute("index")].onclick(),t.postHide(e))},_UIBase_render:r.prototype.render},e.inherits(i,r),e.extend(i.prototype,n,!0)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.Stateful,n=baidu.editor.ui.uiUtils,r=baidu.editor.ui.UIBase,i=baidu.editor.ui.PastePicker=function(e){this.initOptions(e),this.initPastePicker()};i.prototype={initPastePicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div><div class="edui-pastecontainer"><div class="edui-title">'+this.editor.getLang("pasteOpt")+"</div>"+'<div class="edui-button">'+'<div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful>'+'<div class="edui-richtxticon"></div></div>'+'<div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful>'+'<div class="edui-tagicon"></div></div>'+'<div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful>'+'<div class="edui-plaintxticon"></div></div>'+"</div>"+"</div>"+"</div>"},getStateDom:function(){return this.target},format:function(e){this.editor.ui._isTransfer=!0,this.editor.fireEvent("pasteTransfer",e)},_onClick:function(e){var t=domUtils.getNextDomNode(e),r=n.getViewportRect().height,i=n.getClientRect(t);i.top+i.height>r?t.style.top=-i.height-e.offsetHeight+"px":t.style.top="",/hidden/ig.test(domUtils.getComputedStyle(t,"visibility"))?(t.style.visibility="visible",domUtils.addClass(e,"edui-state-opened")):(t.style.visibility="hidden",domUtils.removeClasses(e,"edui-state-opened"))},_UIBase_render:r.prototype.render},e.inherits(i,r),e.extend(i.prototype,t,!0)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.Toolbar=function(e){this.initOptions(e),this.initToolbar()};r.prototype={items:null,initToolbar:function(){this.items=this.items||[],this.initUIBase()},add:function(e){this.items.push(e)},getHtmlTpl:function(){var e=[];for(var t=0;t<this.items.length;t++)e[t]=this.items[t].renderHtml();return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+e.join("")+"</div>"},postRender:function(){var e=this.getDom();for(var n=0;n<this.items.length;n++)this.items[n].postRender();t.makeUnselectable(e)},_onMouseDown:function(){return!1}},e.inherits(r,n)}(),function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,n=baidu.editor.ui.uiUtils,r=baidu.editor.ui.UIBase,i=baidu.editor.ui.Popup,s=baidu.editor.ui.Stateful,o=baidu.editor.ui.CellAlignPicker,u=baidu.editor.ui.Menu=function(e){this.initOptions(e),this.initMenu()},a={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return!0}};u.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[],this.initPopup(),this.initItems()},initItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];t=="-"?this.items[e]=this.getSeparator():t instanceof f||(t.editor=this.editor,t.theme=this.editor.options.theme,this.items[e]=this.createItem(t))}},getSeparator:function(){return a},createItem:function(e){return e.menu=this,new f(e)},_Popup_getContentHtmlTpl:i.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0)return this._Popup_getContentHtmlTpl();var e=[];for(var t=0;t<this.items.length;t++){var n=this.items[t];e[t]=n.renderHtml()}return'<div class="%%-body">'+e.join("")+"</div>"},_Popup_postRender:i.prototype.postRender,postRender:function(){var e=this;for(var r=0;r<this.items.length;r++){var i=this.items[r];i.ownerMenu=this,i.postRender()}t.on(this.getDom(),"mouseover",function(t){t=t||event;var r=t.relatedTarget||t.fromElement,i=e.getDom();!n.contains(i,r)&&i!==r&&e.fireEvent("over")}),this._Popup_postRender()},queryAutoHide:function(e){if(e){if(n.contains(this.getDom(),e))return!1;for(var t=0;t<this.items.length;t++){var r=this.items[t];if(r.queryAutoHide(e)===!1)return!1}}},clearItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];clearTimeout(t._showingTimer),clearTimeout(t._closingTimer),t.subMenu&&t.subMenu.destroy()}this.items=[]},destroy:function(){this.getDom()&&t.remove(this.getDom()),this.clearItems()},dispose:function(){this.destroy()}},e.inherits(u,i);var f=baidu.editor.ui.MenuItem=function(e){this.initOptions(e),this.initUIBase(),this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof u))if(e.className&&e.className.indexOf("aligntd")!=-1){var n=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment"),this.subMenu=new i({content:new o(this.subMenu),parentMenu:n,editor:n.editor,destroy:function(){this.getDom()&&t.remove(this.getDom())}}),this.subMenu.addListener("postRenderAfter",function(){t.on(this.getDom(),"mouseover",function(){n.addState("opened")})})}else this.subMenu=new u(this.subMenu)};f.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:!0,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>"},postRender:function(){var e=this;this.addListener("over",function(){e.ownerMenu.fireEvent("submenuover",e),e.subMenu&&e.delayShowSubMenu()}),this.subMenu&&(this.getDom().className+=" edui-hassubmenu",this.subMenu.render(),this.addListener("out",function(){e.delayHideSubMenu()}),this.subMenu.addListener("over",function(){clearTimeout(e._closingTimer),e._closingTimer=null,e.addState("opened")}),this.ownerMenu.addListener("hide",function(){e.hideSubMenu()}),this.ownerMenu.addListener("submenuover",function(t,n){n!==e&&e.delayHideSubMenu()}),this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide,this.subMenu.queryAutoHide=function(t){return t&&n.contains(e.getDom(),t)?!1:this._bakQueryAutoHide(t)}),this.getDom().style.tabIndex="-1",n.makeUnselectable(this.getDom()),this.Stateful_postRender()},delayShowSubMenu:function(){var e=this;e.isDisabled()||(e.addState("opened"),clearTimeout(e._showingTimer),clearTimeout(e._closingTimer),e._closingTimer=null,e._showingTimer=setTimeout(function(){e.showSubMenu()},250))},delayHideSubMenu:function(){var e=this;e.isDisabled()||(e.removeState("opened"),clearTimeout(e._showingTimer),e._closingTimer||(e._closingTimer=setTimeout(function(){e.hasState("opened")||e.hideSubMenu(),e._closingTimer=null},400)))},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(e){if(this.subMenu&&this.hasState("opened"))return this.subMenu.queryAutoHide(e)},_onClick:function(e,t){if(this.hasState("disabled"))return;this.fireEvent("click",e,t)!==!1&&(this.subMenu?this.showSubMenu():i.postHide(e))},showSubMenu:function(){var e=n.getClientRect(this.getDom());e.right-=5,e.left+=2,e.width-=7,e.top-=4,e.bottom+=4,e.height+=8,this.subMenu.showAnchorRect(e,!0,!0)},hideSubMenu:function(){this.subMenu.hide()}},e.inherits(f,r),e.extend(f.prototype,s,!0)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.Menu,r=baidu.editor.ui.SplitButton,i=baidu.editor.ui.Combox=function(e){this.initOptions(e),this.initCombox()};i.prototype={uiName:"combox",initCombox:function(){var e=this;this.items=this.items||[];for(var t=0;t<this.items.length;t++){var r=this.items[t];r.uiName="listitem",r.index=t,r.onclick=function(){e.selectByIndex(this.index)}}this.popup=new n({items:this.items,uiName:"list",editor:this.editor,captureWheel:!0,combox:this}),this.initSplitButton()},_SplitButton_postRender:r.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.setLabel(this.label||""),this.setValue(this.initValue||"")},showPopup:function(){var e=t.getClientRect(this.getDom());e.top+=1,e.bottom-=1,e.height-=2,this.popup.showAnchorRect(e)},getValue:function(){return this.value},setValue:function(e){var t=this.indexByValue(e);t!=-1?(this.selectedIndex=t,this.setLabel(this.items[t].label),this.value=this.items[t].value):(this.selectedIndex=-1,this.setLabel(this.getLabelForUnknowValue(e)),this.value=e)},setLabel:function(e){this.getDom("button_body").innerHTML=e,this.label=e},getLabelForUnknowValue:function(e){return e},indexByValue:function(e){for(var t=0;t<this.items.length;t++)if(e==this.items[t].value)return t;return-1},getItem:function(e){return this.items[e]},selectByIndex:function(e){e<this.items.length&&this.fireEvent("select",e)!==!1&&(this.selectedIndex=e,this.value=this.items[e].value,this.setLabel(this.items[e].label))}},e.inherits(i,r)}(),function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,n=baidu.editor.ui.uiUtils,r=baidu.editor.ui.Mask,i=baidu.editor.ui.UIBase,s=baidu.editor.ui.Button,o=baidu.editor.ui.Dialog=function(t){this.initOptions(e.extend({autoReset:!0,draggable:!0,onok:function(){},oncancel:function(){},onclose:function(e,t){return t?this.onok():this.oncancel()},holdScroll:!1},t)),this.initDialog()},u,a;o.prototype={draggable:!1,uiName:"dialog",initDialog:function(){var e=this,t=this.editor.options.theme;this.initUIBase(),this.modalMask=u||(u=new r({className:"edui-dialog-modalmask",theme:t})),this.dragMask=a||(a=new r({className:"edui-dialog-dragmask",theme:t})),this.closeButton=new s({className:"edui-dialog-closebutton",title:e.closeDialog,theme:t,onclick:function(){e.close(!1)}});if(this.buttons)for(var n=0;n<this.buttons.length;n++)this.buttons[n]instanceof s||(this.buttons[n]=new s(this.buttons[n]))},fitSize:function(){var e=this.getDom("body"),t=this.mesureSize();return e.style.width=t.width+"px",e.style.height=t.height+"px",t},safeSetOffset:function(e){var t=this,r=t.getDom(),i=n.getViewportRect(),s=n.getClientRect(r),o=e.left;o+s.width>i.right&&(o=i.right-s.width);var u=e.top;u+s.height>i.bottom&&(u=i.bottom-s.height),r.style.left=Math.max(o,0)+"px",r.style.top=Math.max(u,0)+"px"},showAtCenter:function(){this.getDom().style.display="";var e=n.getViewportRect(),r=this.fitSize(),i=this.getDom("titlebar").offsetHeight|0,s=e.width/2-r.width/2,o=e.height/2-(r.height-i)/2-i,u=this.getDom();this.safeSetOffset({left:Math.max(s|0,0),top:Math.max(o|0,0)}),t.hasClass(u,"edui-state-centered")||(u.className+=" edui-state-centered"),this._show()},getContentHtml:function(){var e="";return typeof this.content=="string"?e=this.content:this.iframeUrl&&(e='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'),e},getHtmlTpl:function(){var e="";if(this.buttons){var t=[];for(var n=0;n<this.buttons.length;n++)t[n]=this.buttons[n].renderHtml();e='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+t.join("")+"</div>"+"</div>"}return'<div id="##" class="%%"><div class="%%-wrap"><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+e+"</div></div></div>"},postRender:function(){this.modalMask.getDom()||(this.modalMask.render(),this.modalMask.hide()),this.dragMask.getDom()||(this.dragMask.render(),this.dragMask.hide());var e=this;this.addListener("show",function(){e.modalMask.show(this.getDom().style.zIndex-2)}),this.addListener("hide",function(){e.modalMask.hide()});if(this.buttons)for(var r=0;r<this.buttons.length;r++)this.buttons[r].postRender();t.on(window,"resize",function(){setTimeout(function(){e.isHidden()||e.safeSetOffset(n.getClientRect(e.getDom()))})}),this.holdScroll&&(e.iframeUrl?e.addListener("dialogafterreset",function(){window.setTimeout(function(){var n=document.getElementById(e.id+"_iframe").contentWindow;if(browser.ie)var r=window.setInterval(function(){n.document&&n.document.body&&(window.clearInterval(r),r=null,t.on(n.document.body,browser.gecko?"DOMMouseScroll":"mousewheel",function(e){t.preventDefault(e)}))},100);else t.on(n,browser.gecko?"DOMMouseScroll":"mousewheel",function(e){t.preventDefault(e)})},1)}):t.on(document.getElementById(e.id+"_iframe"),browser.gecko?"DOMMouseScroll":"mousewheel",function(e){t.preventDefault(e
)})),this._hide()},mesureSize:function(){var e=this.getDom("body"),t=n.getClientRect(this.getDom("content")).width,r=e.style;return r.width=t,n.getClientRect(e)},_onTitlebarMouseDown:function(e,r){if(this.draggable){var i,s=n.getViewportRect(),o=this;n.startDrag(e,{ondragstart:function(){i=n.getClientRect(o.getDom()),o.getDom("contmask").style.visibility="visible",o.dragMask.show(o.getDom().style.zIndex-1)},ondragmove:function(e,t){var n=i.left+e,r=i.top+t;o.safeSetOffset({left:n,top:r})},ondragstop:function(){o.getDom("contmask").style.visibility="hidden",t.removeClasses(o.getDom(),["edui-state-centered"]),o.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml(),this.fireEvent("dialogafterreset")},_show:function(){this._hidden&&(this.getDom().style.display="",this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10),this._hidden=!1,this.fireEvent("show"),baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4)},isHidden:function(){return this._hidden},_hide:function(){this._hidden||(this.getDom().style.display="none",this.getDom().style.zIndex="",this._hidden=!0,this.fireEvent("hide"))},open:function(){if(this.autoReset)try{this.reset()}catch(e){this.render(),this.open()}this.showAtCenter();if(this.iframeUrl)try{this.getDom("iframe").focus()}catch(t){}},_onCloseButtonClick:function(e,t){this.close(!1)},close:function(e){this.fireEvent("close",e)!==!1&&this._hide()}},e.inherits(o,i)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.Menu,n=baidu.editor.ui.SplitButton,r=baidu.editor.ui.MenuButton=function(e){this.initOptions(e),this.initMenuButton()};r.prototype={initMenuButton:function(){var e=this;this.uiName="menubutton",this.popup=new t({items:e.items,className:e.className,editor:e.editor}),this.popup.addListener("show",function(){var t=this;for(var n=0;n<t.items.length;n++)t.items[n].removeState("checked"),t.items[n].value==e._value&&(t.items[n].addState("checked"),this.value=e._value)}),this.initSplitButton()},setValue:function(e){this._value=e}},e.inherits(r,n)}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui,n=t.Dialog;t.buttons={},t.Dialog=function(e){var t=new n(e);return t.addListener("hide",function(){if(t.editor){var e=t.editor;try{if(browser.gecko){var n=e.window.scrollY,r=e.window.scrollX;e.body.focus(),e.window.scrollTo(r,n)}else e.focus()}catch(i){}}}),t};var r={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html"},i=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","preview","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable"];for(var s=0,o;o=i[s++];)o=o.toLowerCase(),t[o]=function(e){return function(n){var r=new t.Button({className:"edui-for-"+e,title:n.options.labelMap[e]||n.getLang("labelMap."+e)||"",onclick:function(){n.execCommand(e)},theme:n.options.theme,showText:!1});return t.buttons[e]=r,n.addListener("selectionchange",function(t,i,s){var o=n.queryCommandState(e);o==-1?(r.setDisabled(!0),r.setChecked(!1)):s||(r.setDisabled(!1),r.setChecked(o))}),r}}(o);t.cleardoc=function(e){var n=new t.Button({className:"edui-for-cleardoc",title:e.options.labelMap.cleardoc||e.getLang("labelMap.cleardoc")||"",theme:e.options.theme,onclick:function(){confirm(e.getLang("confirmClear"))&&e.execCommand("cleardoc")}});return t.buttons.cleardoc=n,e.addListener("selectionchange",function(){n.setDisabled(e.queryCommandState("cleardoc")==-1)}),n};var u={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var a in u)(function(e,n){for(var r=0,i;i=n[r++];)(function(n){t[e.replace("float","")+n]=function(r){var i=new t.Button({className:"edui-for-"+e.replace("float","")+n,title:r.options.labelMap[e.replace("float","")+n]||r.getLang("labelMap."+e.replace("float","")+n)||"",theme:r.options.theme,onclick:function(){r.execCommand(e,n)}});return t.buttons[e]=i,r.addListener("selectionchange",function(t,s,o){i.setDisabled(r.queryCommandState(e)==-1),i.setChecked(r.queryCommandValue(e)==n&&!o)}),i}})(i)})(a,u[a]);for(var s=0,o;o=["backcolor","forecolor"][s++];)t[o]=function(e){return function(n){var r=new t.ColorButton({className:"edui-for-"+e,color:"default",title:n.options.labelMap[e]||n.getLang("labelMap."+e)||"",editor:n,onpickcolor:function(t,r){n.execCommand(e,r)},onpicknocolor:function(){n.execCommand(e,"default"),this.setColor("transparent"),this.color="default"},onbuttonclick:function(){n.execCommand(e,this.color)}});return t.buttons[e]=r,n.addListener("selectionchange",function(){r.setDisabled(n.queryCommandState(e)==-1)}),r}}(o);var f={noOk:["searchreplace","help","spechars","webapp"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background"]};for(var a in f)(function(n,i){for(var s=0,o;o=i[s++];){if(browser.opera&&o==="searchreplace")continue;(function(i){t[i]=function(s,o,u){o=o||(s.options.iframeUrlMap||{})[i]||r[i],u=s.options.labelMap[i]||s.getLang("labelMap."+i)||"";var a;o&&(a=new t.Dialog(e.extend({iframeUrl:s.ui.mapUrl(o),editor:s,className:"edui-for-"+i,title:u,holdScroll:i==="insertimage",closeDialog:s.getLang("closeDialog")},n=="ok"?{buttons:[{className:"edui-okbutton",label:s.getLang("ok"),editor:s,onclick:function(){a.close(!0)}},{className:"edui-cancelbutton",label:s.getLang("cancel"),editor:s,onclick:function(){a.close(!1)}}]}:{})),s.ui._dialogs[i+"Dialog"]=a);var f=new t.Button({className:"edui-for-"+i,title:u,onclick:function(){if(a)switch(i){case"wordimage":s.execCommand("wordimage","word_img"),s.word_img&&(a.render(),a.open());break;case"scrawl":s.queryCommandState("scrawl")!=-1&&(a.render(),a.open());break;default:a.render(),a.open()}},theme:s.options.theme,disabled:i=="scrawl"&&s.queryCommandState("scrawl")==-1});return t.buttons[i]=f,s.addListener("selectionchange",function(){var e={edittable:1};if(i in e)return;var t=s.queryCommandState(i);f.getDom()&&(f.setDisabled(t==-1),f.setChecked(t))}),f}})(o.toLowerCase())}})(a,f[a]);t.snapscreen=function(e,n,i){i=e.options.labelMap.snapscreen||e.getLang("labelMap.snapscreen")||"";var s=new t.Button({className:"edui-for-snapscreen",title:i,onclick:function(){e.execCommand("snapscreen")},theme:e.options.theme});t.buttons.snapscreen=s,n=n||(e.options.iframeUrlMap||{}).snapscreen||r.snapscreen;if(n){var o=new t.Dialog({iframeUrl:e.ui.mapUrl(n),editor:e,className:"edui-for-snapscreen",title:i,buttons:[{className:"edui-okbutton",label:e.getLang("ok"),editor:e,onclick:function(){o.close(!0)}},{className:"edui-cancelbutton",label:e.getLang("cancel"),editor:e,onclick:function(){o.close(!1)}}]});o.render(),e.ui._dialogs.snapscreenDialog=o}return e.addListener("selectionchange",function(){s.setDisabled(e.queryCommandState("snapscreen")==-1)}),s},t.insertcode=function(n,r,i){r=n.options.insertcode||[],i=n.options.labelMap.insertcode||n.getLang("labelMap.insertcode")||"";var s=[];e.each(r,function(e,t){s.push({label:e,value:t,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var o=new t.Combox({editor:n,items:s,onselect:function(e,t){n.execCommand("insertcode",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:i,initValue:i,className:"edui-for-insertcode",indexByValue:function(e){if(e)for(var t=0,n;n=this.items[t];t++)if(n.value.indexOf(e)!=-1)return t;return-1}});return t.buttons.insertcode=o,n.addListener("selectionchange",function(e,t,r){if(!r){var s=n.queryCommandState("insertcode");if(s==-1)o.setDisabled(!0);else{o.setDisabled(!1);var u=n.queryCommandValue("insertcode");if(!u){o.setValue(i);return}u&&(u=u.replace(/['"]/g,"").split(",")[0]),o.setValue(u)}}}),o},t.fontfamily=function(n,r,i){r=n.options.fontfamily||[],i=n.options.labelMap.fontfamily||n.getLang("labelMap.fontfamily")||"";if(!r.length)return;for(var s=0,o,u=[];o=r[s];s++){var a=n.getLang("fontfamily")[o.name]||"";(function(t,r){u.push({label:t,value:r,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+e.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})})(o.label||a,o.val)}var f=new t.Combox({editor:n,items:u,onselect:function(e,t){n.execCommand("FontFamily",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:i,initValue:i,className:"edui-for-fontfamily",indexByValue:function(e){if(e)for(var t=0,n;n=this.items[t];t++)if(n.value.indexOf(e)!=-1)return t;return-1}});return t.buttons.fontfamily=f,n.addListener("selectionchange",function(e,t,r){if(!r){var i=n.queryCommandState("FontFamily");if(i==-1)f.setDisabled(!0);else{f.setDisabled(!1);var s=n.queryCommandValue("FontFamily");s&&(s=s.replace(/['"]/g,"").split(",")[0]),f.setValue(s)}}}),f},t.fontsize=function(e,n,r){r=e.options.labelMap.fontsize||e.getLang("labelMap.fontsize")||"",n=n||e.options.fontsize||[];if(!n.length)return;var i=[];for(var s=0;s<n.length;s++){var o=n[s]+"px";i.push({label:o,value:o,theme:e.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var u=new t.Combox({editor:e,items:i,title:r,initValue:r,onselect:function(t,n){e.execCommand("FontSize",this.items[n].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});return t.buttons.fontsize=u,e.addListener("selectionchange",function(t,n,r){if(!r){var i=e.queryCommandState("FontSize");i==-1?u.setDisabled(!0):(u.setDisabled(!1),u.setValue(e.queryCommandValue("FontSize")))}}),u},t.paragraph=function(n,r,i){i=n.options.labelMap.paragraph||n.getLang("labelMap.paragraph")||"",r=n.options.paragraph||[];if(e.isEmptyObject(r))return;var s=[];for(var o in r)s.push({value:o,label:r[o]||n.getLang("paragraph")[o],theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}});var u=new t.Combox({editor:n,items:s,title:i,initValue:i,className:"edui-for-paragraph",onselect:function(e,t){n.execCommand("Paragraph",this.items[t].value)},onbuttonclick:function(){this.showPopup()}});return t.buttons.paragraph=u,n.addListener("selectionchange",function(e,t,r){if(!r){var i=n.queryCommandState("Paragraph");if(i==-1)u.setDisabled(!0);else{u.setDisabled(!1);var s=n.queryCommandValue("Paragraph"),o=u.indexByValue(s);o!=-1?u.setValue(s):u.setValue(u.initValue)}}}),u},t.customstyle=function(e){var n=e.options.customstyle||[],r=e.options.labelMap.customstyle||e.getLang("labelMap.customstyle")||"";if(!n.length)return;var i=e.getLang("customstyle");for(var s=0,o=[],u;u=n[s++];)(function(t){var n={};n.label=t.label?t.label:i[t.name],n.style=t.style,n.className=t.className,n.tag=t.tag,o.push({label:n.label,value:n,theme:e.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+n.tag+" "+(n.className?' class="'+n.className+'"':"")+(n.style?' style="'+n.style+'"':"")+">"+n.label+"</"+n.tag+">"+"</div>"}})})(u);var a=new t.Combox({editor:e,items:o,title:r,initValue:r,className:"edui-for-customstyle",onselect:function(t,n){e.execCommand("customstyle",this.items[n].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(e){for(var t=0,n;n=this.items[t++];)if(n.label==e)return t-1;return-1}});return t.buttons.customstyle=a,e.addListener("selectionchange",function(t,n,r){if(!r){var i=e.queryCommandState("customstyle");if(i==-1)a.setDisabled(!0);else{a.setDisabled(!1);var s=e.queryCommandValue("customstyle"),o=a.indexByValue(s);o!=-1?a.setValue(s):a.setValue(a.initValue)}}}),a},t.inserttable=function(e,n,r){r=e.options.labelMap.inserttable||e.getLang("labelMap.inserttable")||"";var i=new t.TableButton({editor:e,title:r,className:"edui-for-inserttable",onpicktable:function(t,n,r){e.execCommand("InsertTable",{numRows:r,numCols:n,border:1})},onbuttonclick:function(){this.showPopup()}});return t.buttons.inserttable=i,e.addListener("selectionchange",function(){i.setDisabled(e.queryCommandState("inserttable")==-1)}),i},t.lineheight=function(e){var n=e.options.lineheight||[];if(!n.length)return;for(var r=0,i,s=[];i=n[r++];)s.push({label:i,value:i,theme:e.options.theme,onclick:function(){e.execCommand("lineheight",this.value)}});var o=new t.MenuButton({editor:e,className:"edui-for-lineheight",title:e.options.labelMap.lineheight||e.getLang("labelMap.lineheight")||"",items:s,onbuttonclick:function(){var t=e.queryCommandValue("LineHeight")||this.value;e.execCommand("LineHeight",t)}});return t.buttons.lineheight=o,e.addListener("selectionchange",function(){var t=e.queryCommandState("LineHeight");if(t==-1)o.setDisabled(!0);else{o.setDisabled(!1);var n=e.queryCommandValue("LineHeight");n&&o.setValue((n+"").replace(/cm/,"")),o.setChecked(t)}}),o};var l=["top","bottom"];for(var c=0,h;h=l[c++];)(function(e){t["rowspacing"+e]=function(n){var r=n.options["rowspacing"+e]||[];if(!r.length)return null;for(var i=0,s,o=[];s=r[i++];)o.push({label:s,value:s,theme:n.options.theme,onclick:function(){n.execCommand("rowspacing",this.value,e)}});var u=new t.MenuButton({editor:n,className:"edui-for-rowspacing"+e,title:n.options.labelMap["rowspacing"+e]||n.getLang("labelMap.rowspacing"+e)||"",items:o,onbuttonclick:function(){var t=n.queryCommandValue("rowspacing",e)||this.value;n.execCommand("rowspacing",t,e)}});return t.buttons[e]=u,n.addListener("selectionchange",function(){var t=n.queryCommandState("rowspacing",e);if(t==-1)u.setDisabled(!0);else{u.setDisabled(!1);var r=n.queryCommandValue("rowspacing",e);r&&u.setValue((r+"").replace(/%/,"")),u.setChecked(t)}}),u}})(h);var p=["insertorderedlist","insertunorderedlist"];for(var d=0,v;v=p[d++];)(function(e){t[e]=function(n){var r=n.options[e],i=function(){n.execCommand(e,this.value)},s=[];for(var o in r)s.push({label:r[o]||n.getLang()[e][o]||"",value:o,theme:n.options.theme,onclick:i});var u=new t.MenuButton({editor:n,className:"edui-for-"+e,title:n.getLang("labelMap."+e)||"",items:s,onbuttonclick:function(){var t=n.queryCommandValue(e)||this.value;n.execCommand(e,t)}});return t.buttons[e]=u,n.addListener("selectionchange",function(){var t=n.queryCommandState(e);if(t==-1)u.setDisabled(!0);else{u.setDisabled(!1);var r=n.queryCommandValue(e);u.setValue(r),u.setChecked(t)}}),u}})(v);t.fullscreen=function(e,n){n=e.options.labelMap.fullscreen||e.getLang("labelMap.fullscreen")||"";var r=new t.Button({className:"edui-for-fullscreen",title:n,theme:e.options.theme,onclick:function(){e.ui&&e.ui.setFullScreen(!e.ui.isFullScreen()),this.setChecked(e.ui.isFullScreen())}});return t.buttons.fullscreen=r,e.addListener("selectionchange",function(){var t=e.queryCommandState("fullscreen");r.setDisabled(t==-1),r.setChecked(e.ui.isFullScreen())}),r},t.emotion=function(e,n){var i="emotion",s=new t.MultiMenuPop({title:e.options.labelMap[i]||e.getLang("labelMap."+i+"")||"",editor:e,className:"edui-for-"+i,iframeUrl:e.ui.mapUrl(n||(e.options.iframeUrlMap||{})[i]||r[i])});return t.buttons[i]=s,e.addListener("selectionchange",function(){s.setDisabled(e.queryCommandState(i)==-1)}),s},t.autotypeset=function(e){var n=new t.AutoTypeSetButton({editor:e,title:e.options.labelMap.autotypeset||e.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){e.execCommand("autotypeset")}});return t.buttons.autotypeset=n,e.addListener("selectionchange",function(){n.setDisabled(e.queryCommandState("autotypeset")==-1)}),n}}(),function(){function s(e){this.initOptions(e),this.initEditorUI()}var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.dom.domUtils,i=[];s.prototype={uiName:"editor",initEditorUI:function(){function o(e,t){e.setOpt({wordCount:!0,maximumWords:1e4,wordCountMsg:e.options.wordCountMsg||e.getLang("wordCountMsg"),wordOverFlowMsg:e.options.wordOverFlowMsg||e.getLang("wordOverFlowMsg")});var n=e.options,r=n.maximumWords,i=n.wordCountMsg,s=n.wordOverFlowMsg,o=t.getDom("wordcount");if(!n.wordCount)return;var u=e.getContentLength(!0);u>r?(o.innerHTML=s,e.fireEvent("wordcountoverflow")):o.innerHTML=i.replace("{#leave}",r-u).replace("{#count}",u)}this.editor.ui=this,this._dialogs={},this.initUIBase(),this._initToolbars();var e=this.editor,t=this;e.addListener("ready",function(){e.getDialog=function(t){return e.ui._dialogs[t+"Dialog"]},r.on(e.window,"scroll",function(e){baidu.editor.ui.Popup.postHide(e)}),e.ui._actualFrameWidth=e.options.initialFrameWidth,e.options.elementPathEnabled&&(e.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+e.getLang("elementPathTip")+":</div>");if(e.options.wordCount){function n(){o(e,t),r.un(e.document,"click",arguments.callee)}r.on(e.document,"click",n),e.ui.getDom("wordcount").innerHTML=e.getLang("wordCountTip")}e.ui._scale(),e.options.scaleEnabled?(e.autoHeightEnabled&&e.disableAutoHeight(),t.enableScale()):t.disableScale(),!e.options.elementPathEnabled&&!e.options.wordCount&&!e.options.scaleEnabled&&(e.ui.getDom("elementpath").style.display="none",e.ui.getDom("wordcount").style.display="none",e.ui.getDom("scale").style.display="none");if(!e.selection.isFocus())return;e.fireEvent("selectionchange",!1,!0)}),e.addListener("mousedown",function(e,t){var n=t.target||t.srcElement;baidu.editor.ui.Popup.postHide(t,n),baidu.editor.ui.ShortCutMenu.postHide(t)}),e.addListener("delcells",function(){UE.ui.edittip&&new UE.ui.edittip(e),e.getDialog("edittip").open()});var n,i=!1,s;e.addListener("afterpaste",function(){if(e.queryCommandState("pasteplain"))return;baidu.editor.ui.PastePicker&&(n=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:e}),editor:e,className:"edui-wordpastepop"}),n.render()),i=!0}),e.addListener("afterinserthtml",function(){clearTimeout(s),s=setTimeout(function(){if(n&&(i||e.ui._isTransfer)){if(n.isHidden()){var t=r.createElement(e.document,"span",{style:"line-height:0px;",innerHTML:"﻿"}),s=e.selection.getRange();s.insertNode(t);var o=getDomNode(t,"firstChild","previousSibling");n.showAnchor(o.nodeType==3?o.parentNode:o),r.remove(t)}else n.show();delete e.ui._isTransfer,i=!1}},200)}),e.addListener("contextmenu",function(e,t){baidu.editor.ui.Popup.postHide(t)}),e.addListener("keydown",function(e,t){n&&n.dispose(t);var r=t.keyCode||t.which;t.altKey&&r==90&&UE.ui.buttons.fullscreen.onclick()}),e.addListener("wordcount",function(e){o(this,t)}),e.addListener("selectionchange",function(){e.options.elementPathEnabled&&t[(e.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"](),e.options.scaleEnabled&&t[(e.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]()});var u=new baidu.editor.ui.Popup({editor:e,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide(),e.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(t){this.hide(),e.ui._dialogs[t]&&e.ui._dialogs[t].open()},_onImgSetFloat:function(t){this.hide(),e.execCommand("imagefloat",t)},_setIframeAlign:function(e){var t=u.anchorEl,n=t.cloneNode(!0);switch(e){case-2:n.setAttribute("align","");break;case-1:n.setAttribute("align","left");break;case 1:n.setAttribute("align","right")}t.parentNode.insertBefore(n,t),r.remove(t),u.anchorEl=n,u.showAnchor(u.anchorEl)},_updateIframe:function(){e._iframe=u.anchorEl,e.ui._dialogs.insertframeDialog.open(),u.hide()},_onRemoveButtonClick:function(t){e.execCommand(t),this.hide()},queryAutoHide:function(t){if(t&&t.ownerDocument==e.document)if(t.tagName.toLowerCase()=="img"||r.findParentByTagName(t,"a",!0))return t!==u.anchorEl;return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,t)}});u.render(),e.options.imagePopup&&(e.addListener("mouseover",function(t,n){n=n||window.event;var r=n.target||n.srcElement;if(e.ui._dialogs.insertframeDialog&&/iframe/ig.test(r.tagName)){var i=u.formatHtml("<nobr>"+e.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+e.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+e.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+e.getLang("justifyright")+"</span>&nbsp;&nbsp;"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+e.getLang("modify")+"</span></nobr>");i?(u.getDom("content").innerHTML=i,u.anchorEl=r,u.showAnchor(u.anchorEl)):u.hide()}}),e.addListener("selectionchange",function(t,n){if(!n)return;var r="",i="",s=e.selection.getRange().getClosedNode(),o=e.ui._dialogs;if(s&&s.tagName=="IMG"){var a="insertimageDialog";s.className.indexOf("edui-faked-video")!=-1&&(a="insertvideoDialog"),s.className.indexOf("edui-faked-webapp")!=-1&&(a="webappDialog"),s.src.indexOf("http://api.map.baidu.com")!=-1&&(a="mapDialog"),s.className.indexOf("edui-faked-music")!=-1&&(a="musicDialog"),s.src.indexOf("http://maps.google.com/maps/api/staticmap")!=-1&&(a="gmapDialog"),s.getAttribute("anchorname")&&(a="anchorDialog",r=u.formatHtml("<nobr>"+e.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+e.getLang("modify")+"</span>&nbsp;&nbsp;"+"<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+e.getLang("delete")+"</span></nobr>")),s.getAttribute("word_img")&&(e.word_img=[s.getAttribute("word_img")],a="wordimageDialog");if(!o[a])return;i="<nobr>"+e.getLang("property")+": "+'<span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+e.getLang("default")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+e.getLang("justifyleft")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+e.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+e.getLang("justifycenter")+"</span>&nbsp;&nbsp;"+"<span onclick=\"$$._onImgEditButtonClick('"+a+'\');" class="edui-clickable">'+e.getLang("modify")+"</span></nobr>",!r&&(r=u.formatHtml(i))}if(e.ui._dialogs.linkDialog){var f=e.queryCommandValue("link"),l;if(f&&(l=f.getAttribute("_href")||f.getAttribute("href",2))){var c=l;l.length>30&&(c=l.substring(0,20)+"..."),r&&(r+='<div style="height:5px;"></div>'),r+=u.formatHtml("<nobr>"+e.getLang("anthorMsg")+': <a target="_blank" href="'+l+'" title="'+l+'" >'+c+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+e.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+e.getLang("clear")+"</span></nobr>"),u.showAnchor(f)}}r?(u.getDom("content").innerHTML=r,u.anchorEl=s||f,u.showAnchor(u.anchorEl)):u.hide()}))},_initToolbars:function(){var e=this.editor,t=this.toolbars||[],n=[];for(var r=0;r<t.length;r++){var i=t[r],s=new baidu.editor.ui.Toolbar({theme:e.options.theme});for(var o=0;o<i.length;o++){var u=i[o],a=null;if(typeof u=="string"){u=u.toLowerCase(),u=="|"&&(u="Separator"),u=="||"&&(u="Breakline"),baidu.editor.ui[u]&&(a=new baidu.editor.ui[u](e));if(u=="fullscreen"){n&&n[0]?n[0].items.splice(0,0,a):a&&s.items.splice(0,0,a);continue}}else a=u;a&&a.id&&s.add(a)}n[r]=s}this.toolbars=n},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder"></div>'+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>"},showWordImageDialog:function(){this.editor.execCommand("wordimage","word_img"),this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){var e=[];for(var t=0;t<this.toolbars.length;t++)e.push(this.toolbars[t].renderHtml());return e.join("")},setFullScreen:function(e){var t=this.editor,n=t.container.parentNode.parentNode;if(this._fullscreen!=e){this._fullscreen=e,this.editor.fireEvent("beforefullscreenchange",e);if(baidu.editor.browser.gecko)var r=t.selection.getRange().createBookmark();if(e){while(n.tagName!="BODY"){var s=baidu.editor.dom.domUtils.getComputedStyle(n,"position");i.push(s),n.style.position="static",n=n.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow,this._bakBodyOverflow=document.body.style.overflow,this._bakAutoHeight=this.editor.autoHeightEnabled,this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._bakEditorContaninerWidth=t.iframe.parentNode.offsetWidth,this._bakAutoHeight&&(t.autoHeightEnabled=!1,this.editor.disableAutoHeight()),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",this._bakCssText=this.getDom().style.cssText,this._bakCssText1=this.getDom("iframeholder").style.cssText,t.iframe.parentNode.style.width="",this._updateFullScreen()}else{while(n.tagName!="BODY")n.style.position=i.shift(),n=n.parentNode;this.getDom().style.cssText=this._bakCssText,this.getDom("iframeholder").style.cssText=this._bakCssText1,this._bakAutoHeight&&(t.autoHeightEnabled=!0,this.editor.enableAutoHeight()),document.documentElement.style.overflow=this._bakHtmlOverflow,document.body.style.overflow=this._bakBodyOverflow,t.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px",window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&t.body.contentEditable==="true"){var o=document.createElement("input");document.body.appendChild(o),t.body.contentEditable=!1,setTimeout(function(){o.focus(),setTimeout(function(){t.body.contentEditable=!0,t.fireEvent("fullscreenchanged",e),t.selection.getRange().moveToBookmark(r).select(!0),baidu.editor.dom.domUtils.remove(o),e&&window.scroll(0,0)},0)},0)}t.body.contentEditable==="true"&&(this.editor.fireEvent("fullscreenchanged",e),this.triggerLayout())}},_updateFullScreen:function(){if(this._fullscreen){var e=t.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+e.width+"px;height:"+e.height+"px;z-index:"+(this.getDom().style.zIndex*1+100),t.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(e.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0));if(browser.gecko)try{window.onresize()}catch(n){}}},_updateElementPath:function(){var e=this.getDom("elementpath"),t;if(this.elementPathEnabled&&(t=this.editor.queryCommandValue("elementpath"))){var n=[];for(var r=0,i;i=t[r];r++)n[r]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+r+'&quot;);">'+i+"</span>");e.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+n.join(" &gt; ")+"</div>"}else e.style.display="none"},disableElementPath:function(){var e=this.getDom("elementpath");e.innerHTML="",e.style.display="none",this.elementPathEnabled=!1},enableElementPath:function(){var e=this.getDom("elementpath");e.style.display="",this.elementPathEnabled=!0,this._updateElementPath()},_scale:function(){function g(){l=r.getXY(n),c||(c=t.options.minFrameHeight+s.offsetHeight+o.offsetHeight),a.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+n.offsetWidth+"px;height:"+n.offsetHeight+"px;z-index:"+(t.options.zIndex+1),r.on(e,"mousemove",b),r.on(i,"mouseup",w),r.on(e,"mouseup",w)}function b(t){E();var n=t||window.event;p=n.pageX||e.documentElement.scrollLeft+n.clientX,d=n.pageY||e.documentElement.scrollTop+n.clientY,v=p-l.x,m=d-l.y,v>=h&&(f=!0,a.style.width=v+"px"),m>=c&&(f=!0,a.style.height=m+"px")}function w(){f&&(f=!1,t.ui._actualFrameWidth=a.offsetWidth-2,n.style.width=t.ui._actualFrameWidth+"px",t.setHeight(a.offsetHeight-o.offsetHeight-s.offsetHeight-2)),a&&(a.style.display="none"),E(),r.un(e,"mousemove",b),r.un(i,"mouseup",w),r.un(e,"mouseup",w)}function E(){browser.ie?e.selection.clear():window.getSelection().removeAllRanges()}var e=document,t=this.editor,n=t.container,i=t.document,s=this.getDom("toolbarbox"),o=this.getDom("bottombar"),u=this.getDom("scale"),a=this.getDom("scalelayer"),f=!1,l=null,c=0,h=t.options.minFrameWidth,p=0,d=0,v=0,m=0,y=this;this.editor.addListener("fullscreenchanged",function(e,t){if(t)y.disableScale();else if(y.editor.options.scaleEnabled){y.enableScale();var n=y.editor.document.createElement("span");y.editor.body.appendChild(n),y.editor.body.style.height=Math.max(r.getXY(n).y,y.editor.iframe.offsetHeight-20)+"px",r.remove(n)}}),this.enableScale=function(){if(t.queryCommandState("source")==1)return;u.style.display="",this.scaleEnabled=!0,r.on(u,"mousedown",g)},this.disableScale=function(){u.style.display="none",this.scaleEnabled=!1,r.un(u,"mousedown",g)}},isFullScreen:function(){return this._fullscreen},postRender:function(){n.prototype.postRender.call(this);for(var e=0;e<this.toolbars.length;e++)this.toolbars[e].postRender();var t=this,r,i=baidu.editor.dom.domUtils,s=function(){clearTimeout(r),r=setTimeout(function(){t._updateFullScreen()})};i.on(window,"resize",s),t.addListener("destroy",function(){i.un(window,"resize",s),clearTimeout(r)})},showToolbarMsg:function(e,t){this.getDom("toolbarmsg_label").innerHTML=e,this.getDom("toolbarmsg").style.display="";if(!t){var n=this.getDom("upload_dialog");n.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(e){return e?e.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var e=this.getDom();e.style.zoom=="1"?e.style.zoom="100%":e.style.zoom="1"}},e.inherits(s,baidu.editor.ui.UIBase);var o={};UE.ui.Editor=function(t){var n=new UE.Editor(t);n.options.editor=n,e.loadFile(document,{href:n.options.themePath+n.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var i=n.render;return n.render=function(t){t.constructor===String&&(n.key=t,o[t]=n),e.domReady(function(){function e(){n.setOpt({labelMap:n.options.labelMap||n.getLang("labelMap")}),new s(n.options);if(t){t.constructor===String&&(t=document.getElementById(t)),t&&t.getAttribute("name")&&(n.options.textarea=t.getAttribute("name"));if(t&&/script|textarea/ig.test(t.tagName)){var e=document.createElement("div");t.parentNode.insertBefore(e,t);var o=t.value||t.innerHTML;n.options.initialContent=/^[\t\r\n ]*$/.test(o)?n.options.initialContent:o.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),t.className&&(e.className=t.className),t.style.cssText&&(e.style.cssText=t.style.cssText),/textarea/i.test(t.tagName)?(n.textarea=t,n.textarea.style.display="none"):(t.parentNode.removeChild(t),t.id&&(e.id=t.id)),t=e,t.innerHTML=""}}r.addClass(t,"edui-"+n.options.theme),n.ui.render(t);var u=n.options;n.container=n.ui.getDom();var a=r.findParents(t,!0),f=[];for(var l=0,c;c=a[l];l++)f[l]=c.style.display,c.style.display="block";u.initialFrameWidth?
u.minFrameWidth=u.initialFrameWidth:u.minFrameWidth=u.initialFrameWidth=t.offsetWidth,u.initialFrameHeight?u.minFrameHeight=u.initialFrameHeight:u.initialFrameHeight=u.minFrameHeight=t.offsetHeight;for(var l=0,c;c=a[l];l++)c.style.display=f[l];t.style.height&&(t.style.height=""),n.container.style.width=u.initialFrameWidth+(/%$/.test(u.initialFrameWidth)?"":"px"),n.container.style.zIndex=u.zIndex,i.call(n,n.ui.getDom("iframeholder"))}n.langIsReady?e():n.addListener("langReady",e)})},n},UE.getEditor=function(e,t){var n=o[e];return n||(n=o[e]=new UE.ui.Editor(t),n.render(e)),n},UE.delEditor=function(e){var t;if(t=o[e])t.key&&t.destroy(),delete o[e]}}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,n=baidu.editor.ui.SplitButton,r=baidu.editor.ui.MultiMenuPop=function(e){this.initOptions(e),this.initMultiMenu()};r.prototype={initMultiMenu:function(){var e=this;this.popup=new t({content:"",editor:e.editor,iframe_rendered:!1,onshow:function(){this.iframe_rendered||(this.iframe_rendered=!0,this.getDom("content").innerHTML='<iframe id="'+e.id+'_iframe" src="'+e.iframeUrl+'" frameborder="0"></iframe>',e.editor.container.style.zIndex&&(this.getDom().style.zIndex=e.editor.container.style.zIndex*1+1))}}),this.onbuttonclick=function(){this.showPopup()},this.initSplitButton()}},e.inherits(r,n)}(),function(){function f(e){var t=e.target||e.srcElement,n=i.findParent(t,function(e){return i.hasClass(e,"edui-shortcutmenu")||i.hasClass(e,"edui-popup")},!0);if(!n)for(var r=0,o;o=s[r++];)o.hide()}var e=baidu.editor.ui,t=e.UIBase,n=e.uiUtils,r=baidu.editor.utils,i=baidu.editor.dom.domUtils,s=[],o,u=!1,a=e.ShortCutMenu=function(e){this.initOptions(e),this.initShortCutMenu()};a.postHide=f,a.prototype={isHidden:!0,SPACE:5,initShortCutMenu:function(){this.items=this.items||[],this.initUIBase(),this.initItems(),this.initEvent(),s.push(this)},initEvent:function(){var e=this,t=e.editor.document;i.on(t,"mousemove",function(t){if(e.isHidden===!1){if(e.getSubMenuMark()||e.eventType=="contextmenu")return;var n=!0,r=e.getDom(),i=r.offsetWidth,s=r.offsetHeight,u=i/2+e.SPACE,a=s/2,f=Math.abs(t.screenX-e.left),l=Math.abs(t.screenY-e.top);clearTimeout(o),o=setTimeout(function(){l>0&&l<a?e.setOpacity(r,"1"):l>a&&l<a+70?(e.setOpacity(r,"0.5"),n=!1):l>a+70&&l<a+140&&e.hide(),n&&f>0&&f<u?e.setOpacity(r,"1"):f>u&&f<u+70?e.setOpacity(r,"0.5"):f>u+70&&f<u+140&&e.hide()})}}),browser.chrome&&i.on(t,"mouseout",function(t){var n=t.relatedTarget||t.toElement;(n==null||n.tagName=="HTML")&&e.hide()}),e.editor.addListener("afterhidepop",function(){e.isHidden||(u=!0)})},initItems:function(){if(r.isArray(this.items))for(var t=0,n=this.items.length;t<n;t++){var i=this.items[t].toLowerCase();e[i]&&(this.items[t]=new e[i](this.editor),this.items[t].className+=" edui-shortcutsubmenu ")}},setOpacity:function(e,t){browser.ie&&browser.version<9?e.style.filter="alpha(opacity = "+parseFloat(t)*100+");":e.style.opacity=t},getSubMenuMark:function(){u=!1;var e=n.getFixedLayer(),t=i.getElementsByTagName(e,"div",function(e){return i.hasClass(e,"edui-shortcutsubmenu edui-popup")});for(var r=0,s;s=t[r++];)s.style.display!="none"&&(u=!0);return u},show:function(e,t){function a(e){e.left<0&&(e.left=0),e.top<0&&(e.top=0),o.style.cssText="position:absolute;left:"+e.left+"px;top:"+e.top+"px;"}function f(e){e.tagName||(e=e.getDom()),s.left=parseInt(e.style.left),s.top=parseInt(e.style.top),s.top-=o.offsetHeight+15,a(s)}var r=this,s={},o=this.getDom(),u=n.getFixedLayer();r.eventType=e.type,o.style.cssText="display:block;left:-9999px";if(e.type=="contextmenu"&&t){var l=i.getElementsByTagName(u,"div","edui-contextmenu")[0];l?f(l):r.editor.addListener("aftershowcontextmenu",function(e,t){f(t)})}else s=n.getViewportOffsetByEvent(e),s.top-=o.offsetHeight+r.SPACE,s.left+=r.SPACE+20,a(s),r.setOpacity(o,.2);r.isHidden=!1,r.left=e.screenX+o.offsetWidth/2-r.SPACE,r.top=e.screenY-o.offsetHeight/2-r.SPACE,r.editor&&(o.style.zIndex=r.editor.container.style.zIndex*1+10,u.style.zIndex=o.style.zIndex-1)},hide:function(){this.getDom()&&(this.getDom().style.display="none"),this.isHidden=!0},postRender:function(){if(r.isArray(this.items))for(var e=0,t;t=this.items[e++];)t.postRender()},getHtmlTpl:function(){var e;if(r.isArray(this.items)){e=[];for(var t=0;t<this.items.length;t++)e[t]=this.items[t].renderHtml();e=e.join("")}else e=this.items;return'<div id="##" class="%% edui-toolbar" data-src="shortcutmenu" onmousedown="return false;" onselectstart="return false;" >'+e+"</div>"}},r.inherits(a,t),i.on(document,"mousedown",function(e){f(e)}),i.on(window,"scroll",function(e){f(e)})}(),function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Breakline=function(e){this.initOptions(e),this.initSeparator()};n.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}},e.inherits(n,t)}()})()